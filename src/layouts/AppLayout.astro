---
import { ViewTransitions } from "astro:transitions";
import { apps } from "../data/apps/index";
import type { Application } from "../types/apps";

interface Props {
    title: string;
    description: string;
    image?: string;
    color?: string;
    favicon?: string;
    currentSlug?: string;
}

const {
    title,
    description,
    image,
    color = "#000000",
    favicon = "/favicon.svg",
    currentSlug,
} = Astro.props;

const otherApps = apps.filter((a) => a.slug !== currentSlug).slice(0, 5);
---

<!doctype html>
<html lang="es" class="scroll-smooth">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" href={favicon} />
        <meta name="generator" content={Astro.generator} />

        <title>{title}</title>
        <meta name="description" content={description} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        {image && <meta property="og:image" content={image} />}
        {image && <meta property="twitter:image" content={image} />}
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="theme-color" content={color} />

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;800;900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Exo+2:ital,wght@0,100..900;1,100..900&family=Outfit:wght@100..900&display=swap"
            rel="stylesheet"
        />

        <ViewTransitions />

        {
            currentSlug &&
                (() => {
                    const app = apps.find((a) => a.slug === currentSlug);
                    if (!app) return null;
                    const site = Astro.site?.origin || "https://www.jjlmoya.es";

                    const schema = {
                        "@context": "https://schema.org",
                        "@type": app.category === "Juegos" ? "VideoGame" : "SoftwareApplication",
                        name: app.title,
                        description: app.description,
                        applicationCategory:
                            app.category === "Juegos" ? "GameApplication" : "MultimediaApplication",
                        operatingSystem: "ANDROID",
                        author: {
                            "@type": "Person",
                            name: "jjlmoya",
                            url: site,
                        },
                        publisher: {
                            "@type": "Organization",
                            name: "GameBob",
                            logo: {
                                "@type": "ImageObject",
                                url: `${site}${app.media.icon}`,
                            },
                        },
                        offers: {
                            "@type": "Offer",
                            price: "0",
                            priceCurrency: "EUR",
                        },
                        image: `${site}${app.media.icon}`,
                    };

                    return <script type="application/ld+json" set:html={JSON.stringify(schema)} />;
                })()
        }
    </head>
    <body
        class="bg-white dark:bg-[#050505] text-slate-900 dark:text-neutral-100 antialiased selection:bg-black selection:text-white dark:selection:bg-white dark:selection:text-black min-h-screen flex flex-col"
    >
        <header class="fixed top-0 left-0 w-full z-50 transition-all duration-500" id="main-header">
            <div class="max-w-7xl mx-auto px-6 py-4 md:py-6 flex justify-between items-center">
                <a href="/apps/" class="group flex items-center gap-3 no-underline">
                    <div
                        class="w-10 h-10 rounded-xl bg-white flex items-center justify-center text-black shadow-lg transition-all duration-300 group-hover:scale-110 group-hover:rotate-[-5deg]"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="3"
                            stroke-linecap="round"
                            stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg
                        >
                    </div>
                    <div class="flex flex-col text-white">
                        <span
                            class="text-[10px] font-black uppercase tracking-[0.2em] opacity-60 leading-none mb-1"
                            >Volver al</span
                        >
                        <span
                            class="text-sm font-black tracking-tight leading-none group-hover:translate-x-1 transition-transform opacity-90"
                            >Marketplace</span
                        >
                    </div>
                </a>
            </div>
        </header>

        <main class="flex-grow">
            <slot />
        </main>

        <footer
            class="py-24 px-6 bg-slate-50 dark:bg-neutral-950 border-t border-slate-100 dark:border-neutral-900"
        >
            <div class="max-w-7xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-12 gap-16 mb-20">
                    <div class="md:col-span-4">
                        <span class="text-lg font-black tracking-tight mb-6 block uppercase"
                            >jjlmoya<span class="text-slate-400">.es</span></span
                        >
                        <p
                            class="text-slate-500 dark:text-neutral-400 font-light leading-relaxed mb-8 max-w-xs"
                        >
                            Diseñando y desarrollando herramientas digitales que priorizan la
                            utilidad y la experiencia de usuario.
                        </p>
                        <div class="flex gap-4">
                            <a
                                href="https://x.com/jjlmoya"
                                target="_blank"
                                class="social-circle group"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    width="18"
                                    height="18"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    class="transition-transform group-hover:scale-110"
                                    ><path
                                        d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"
                                    ></path></svg
                                >
                            </a>
                            <a
                                href="https://github.com/jjlmoya"
                                target="_blank"
                                class="social-circle group"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    width="18"
                                    height="18"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    class="transition-transform group-hover:scale-110"
                                    ><path
                                        d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"
                                    ></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg
                                >
                            </a>
                        </div>
                    </div>

                    <div class="md:col-span-8 grid grid-cols-2 md:grid-cols-3 gap-10">
                        <div>
                            <span
                                class="text-[10px] font-black uppercase tracking-[0.3em] opacity-30 mb-6 block"
                                >Marketplace</span
                            >
                            <ul class="space-y-4">
                                <li>
                                    <a href="/apps/" class="footer-link font-bold">Ver todos</a>
                                </li>
                                {
                                    otherApps.map((otherApp) => (
                                        <li>
                                            <a href={`/apps/${otherApp.slug}/`} class="footer-link">
                                                {otherApp.title}
                                            </a>
                                        </li>
                                    ))
                                }
                            </ul>
                        </div>
                        <div>
                            <span
                                class="text-[10px] font-black uppercase tracking-[0.3em] opacity-30 mb-6 block"
                                >Contacto</span
                            >
                            <ul class="space-y-4">
                                <li>
                                    <a href="mailto:juanjo1989@gmail.com" class="footer-link"
                                        >Email</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://x.com/jjlmoya"
                                        target="_blank"
                                        class="footer-link">Twitter</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://github.com/jjlmoya"
                                        target="_blank"
                                        class="footer-link">GitHub</a
                                    >
                                </li>
                            </ul>
                        </div>
                        <div>
                            <span
                                class="text-[10px] font-black uppercase tracking-[0.3em] opacity-30 mb-6 block"
                                >Legal</span
                            >
                            <ul class="space-y-4">
                                <li>
                                    <a
                                        href="https://www.jjlmoya.es/gamebob/privacidad/"
                                        target="_blank"
                                        class="footer-link">Privacidad</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="https://www.jjlmoya.es/gamebob/terminos-y-condiciones/"
                                        target="_blank"
                                        class="footer-link">Términos</a
                                    >
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div
                    class="pt-10 border-t border-slate-200 dark:border-neutral-900 flex justify-center md:justify-start"
                >
                    <p class="text-[10px] uppercase font-bold tracking-widest opacity-60">
                        © {new Date().getFullYear()} JUAN JOSÉ LÓPEZ MOYA. HECHO EN ESPAÑA.
                    </p>
                </div>
            </div>
        </footer>

        <style is:global>
            @import "tailwindcss";

            @theme {
                --font-sans: "Inter", system-ui, sans-serif;
            }

            :root {
                --accent: #000000;
            }

            body {
                font-family: "Inter", system-ui, sans-serif;
            }

            #main-header {
                background: transparent;
            }

            .theme-pizzametrics.light-theme {
                --bg-app: hsl(38, 50%, 98%);
                --bg-surface: hsl(0, 0%, 100%);
                --bg-card: hsl(0, 0%, 100%);
                --text-main: hsl(235, 19%, 21%);
                --text-dim: hsl(234, 10%, 40%);
                --glass: hsla(38, 50%, 98%, 0.85);
                --glass-border-color: hsla(235, 19%, 21%, 0.08);

                --shadow-card: 0 8px 24px hsla(235, 19%, 21%, 0.08);
                --shadow-primary: 0 8px 20px -4px hsla(0, 69%, 50%, 0.2);
            }

            #main-header.scrolled {
                background: var(--glass, rgba(5, 5, 5, 0.95));
                backdrop-filter: blur(20px);
                border-bottom: 1px solid var(--glass-border-color, rgba(255, 255, 255, 0.1));
                padding-top: 0.75rem;
                padding-bottom: 0.75rem;
            }

            .nav-link {
                font-size: 11px;
                font-weight: 800;
                text-transform: uppercase;
                letter-spacing: 0.2em;
                text-decoration: none;
                transition: all 0.3s ease;
            }

            .nav-link:hover {
                opacity: 1;
                transform: translateY(-1px);
            }

            .footer-link {
                font-size: 13px;
                font-weight: 500;
                text-decoration: none;
                color: inherit;
                opacity: 0.7;
                transition: all 0.3s ease;
            }

            .footer-link:hover {
                opacity: 1;
                padding-left: 4px;
            }

            .social-circle {
                width: 40px;
                height: 40px;
                border-radius: 9999px;
                border: 1px solid rgba(0, 0, 0, 0.05);
                display: flex;
                align-items: center;
                justify-content: center;
                color: inherit;
                transition: all 0.3s ease;
            }

            .dark .social-circle {
                border-color: rgba(255, 255, 255, 0.05);
            }

            .social-circle:hover {
                background: black;
                color: white;
                transform: translateY(-3px);
            }

            .dark .social-circle:hover {
                background: white;
                color: black;
            }
        </style>

        <script>
            const updateHeader = () => {
                const header = document.getElementById("main-header");
                if (window.scrollY > 20) {
                    header?.classList.add("scrolled");
                } else {
                    header?.classList.remove("scrolled");
                }
            };

            window.addEventListener("scroll", updateHeader);

            updateHeader();

            document.addEventListener("astro:after-swap", () => {
                updateHeader();
            });
        </script>
    </body>
</html>
