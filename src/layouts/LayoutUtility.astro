---
import Layout from "./Layout.astro";
import BackToUtilities from "../components/ui/BackToUtilities.astro";
import RelatedUtilities from "../components/utilidades/RelatedUtilities.astro";
import AppLinksBanner from "../components/utilidades/AppLinksBanner.astro";
import UtilityStructuredData from "../components/utilidades/UtilityStructuredData.astro";
import FAQSection from "../components/utilidades/FAQSection.astro";
import { sections } from "../data/utilities";

interface AppLinks {
    android?: string;
    ios?: string;
}

interface FAQItem {
    question: string;
    answer: string;
}

interface HowToStep {
    name: string;
    text: string;
    url?: string;
    image?: string;
}

interface Props {
    title: string;
    description: string;
    image?: string;
    category?: string;
    gradientFrom?: string;
    gradientTo?: string;
    appLinks?: AppLinks;
    faqItems?: FAQItem[];
    howToSteps?: HowToStep[];
}

const {
    title,
    description,
    image,
    category: propCategory,
    gradientFrom = "from-slate-100",
    gradientTo = "to-white",
    appLinks,
    faqItems,
    howToSteps,
} = Astro.props;

const currentPath = Astro.url.pathname;

const normalize = (path: string) => path.replace(/\/+$/, "");
const targetPath = normalize(currentPath);

let category = propCategory;

if (!category) {
    const foundSection = sections.find((section) =>
        section.utilities.some((u) => normalize(u.href) === targetPath)
    );
    if (foundSection) {
        category = foundSection.title;
    }
}
---

<Layout title={title} description={description} image={image}>
    <UtilityStructuredData
        title={title}
        description={description}
        url={currentPath}
        category={category}
        faqItems={faqItems}
        howToSteps={howToSteps}
        slot="head"
    />
    <div class="relative min-h-screen pt-16 overflow-x-clip">
        <div
            class={`absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] ${gradientFrom} via-white ${gradientTo} dark:from-slate-900/40 dark:via-zinc-950 dark:to-black -z-10`}
        >
        </div>

        <div class="max-w-6xl mx-auto px-4 sm:px-6">
            <div class="mb-12 text-center animate-in fade-in slide-in-from-bottom-8 duration-1000">
                {appLinks && <AppLinksBanner android={appLinks.android} ios={appLinks.ios} />}
                <BackToUtilities class="mb-8" />
                <slot name="header">
                    <h1 class="text-5xl md:text-7xl font-black tracking-tighter mb-6">
                        {title}
                    </h1>
                    <p
                        class="text-xl text-slate-600 dark:text-slate-400 max-w-2xl mx-auto font-light"
                    >
                        {description}
                    </p>
                </slot>
            </div>

            <div>
                <slot />
            </div>

            {faqItems && faqItems.length > 0 && <FAQSection items={faqItems} />}

            <div
                class="prose prose-lg dark:prose-invert mx-auto mb-20 prose-headings:font-bold prose-a:text-indigo-600 dark:prose-a:text-indigo-400"
            >
                <slot name="seo" />
            </div>

            <div class="max-w-4xl mx-auto mb-16">
                <slot name="bibliography" />
            </div>

            <RelatedUtilities category={category ?? ""} currentPath={currentPath} />
        </div>
    </div>
</Layout>
