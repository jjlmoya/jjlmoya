---
import "../styles/global.css";
import SEO from "../components/SEO.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Toast from "../components/ui/Toast.astro";

import { ClientRouter } from "astro:transitions";
import "@fontsource/inter/300.css";
import "@fontsource/inter/400.css";
import "@fontsource/inter/600.css";
import "@fontsource/inter/900.css";
import "@fontsource/fredoka-one";

interface Props {
    title: string;
    description?: string;
    bodyClass?: string;
    showBackground?: boolean;
    mainClass?: string;
    headerClass?: string;
    footerClass?: string;
}

const {
    title,
    description,
    bodyClass = "",
    showBackground = true,
    mainClass = "pt-20 px-4",
    headerClass = "",
    footerClass = "",
} = Astro.props;
---

<!doctype html>
<html lang="es">
    <head>
        <SEO title={title} description={description} />
        <ClientRouter />
        <script is:inline>
            // Theme initialization
            const theme = (() => {
                if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
                    return localStorage.getItem("theme");
                }
                if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    return "dark";
                }
                return "light";
            })();

            if (theme === "dark") {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }

            window.localStorage.setItem("theme", theme);

            // Listener for toggle button (runs on every page navigation)
            document.addEventListener("astro:page-load", () => {
                const themeToggle = document.getElementById("theme-toggle");
                themeToggle?.addEventListener("click", () => {
                    const html = document.documentElement;
                    html.classList.toggle("dark");
                    const isDark = html.classList.contains("dark");
                    localStorage.setItem("theme", isDark ? "dark" : "light");
                });
            });
        </script>
    </head>
    <body
        class={`min-h-screen flex flex-col antialiased text-slate-900 bg-slate-50 transition-colors duration-300 ${bodyClass}`}
    >
        {
            showBackground && (
                <>
                    <div class="fixed inset-0 -z-10 h-full w-full bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:14px_24px]" />
                    <div class="fixed inset-0 -z-10 h-full w-full bg-[radial-gradient(circle_800px_at_100%_200px,rgba(29,78,216,0.15),transparent)]" />
                </>
            )
        }

        <Header className={headerClass} />

        <main class={`flex-grow ${mainClass}`}>
            <slot />
        </main>

        <Toast />
        <Footer className={footerClass} />
    </body>
</html>
