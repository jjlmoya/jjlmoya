---
import "../styles/global.css";
import SEO from "../components/SEO.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Toast from "../components/ui/Toast.astro";
import Search from "../components/search/Search.astro";

import "@fontsource/inter/300.css";
import "@fontsource/inter/400.css";
import "@fontsource/inter/600.css";
import "@fontsource/inter/900.css";
import "@fontsource/fredoka-one";

interface Props {
    title: string;
    description?: string;
    image?: string;
    bodyClass?: string;
    showBackground?: boolean;
    mainClass?: string;
    headerClass?: string;
    footerClass?: string;
    fullWidth?: boolean;
}

const {
    title,
    description,
    image,
    bodyClass = "",
    showBackground = true,
    fullWidth = false,
    headerClass = "",
    footerClass = "",
} = Astro.props;

const mainClass = Astro.props.mainClass || (fullWidth ? "pt-15" : "pt-15 px-4");
---

<!doctype html>
<html lang="es">
    <head>
        <SEO title={title} description={description} image={image} />

        <script>
            import { handleGlobalShare } from "../utils/share";

            document.addEventListener("DOMContentLoaded", () => {
                document.removeEventListener("click", handleGlobalShare);
                document.addEventListener("click", handleGlobalShare);
            });

            (function registerFootprint() {
                const STORAGE_KEY = "jjlmoya_footprint_v5";
                const APPS_SCRIPT_URL =
                    "https://script.google.com/macros/s/AKfycbzKush6FWrPSw4U5QGWsdbUAePGSDuMgmG-TCoZsA0nLTYkBAFaRksZ8MuPGoOCAUG29Q/exec";

                if (localStorage.getItem(STORAGE_KEY)) {
                    return;
                }

                console.log("ðŸ‘£ Generando registro burocrÃ¡tico Ãºnico...");

                function generateColor(str: string) {
                    let hash = 0;
                    for (let i = 0; i < str.length; i++) {
                        hash = str.charCodeAt(i) + ((hash << 5) - hash);
                    }
                    const h = Math.abs(hash % 360);
                    const s = 65 + (Math.abs(hash) % 20);
                    const l = 55 + (Math.abs(hash) % 15);
                    return `hsl(${h}, ${s}%, ${l}%)`;
                }

                const data = {
                    ua: navigator.userAgent,
                    screen: `${window.screen.width}x${window.screen.height}`,
                    lang: navigator.language,
                    path: window.location.pathname,
                    id: `SR-${Math.random().toString(36).substring(7).toUpperCase()}`,
                    color: generateColor(
                        navigator.userAgent + window.screen.width + Date.now() + Math.random()
                    ),
                };

                fetch(APPS_SCRIPT_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "text/plain" },
                    body: JSON.stringify(data),
                })
                    .then(() => {
                        localStorage.setItem(
                            STORAGE_KEY,
                            JSON.stringify({
                                registered: true,
                                color: data.color,
                                id: data.id,
                                date: new Date().toISOString(),
                            })
                        );
                        console.log("ðŸ‘£ Registro consolidado en el Archivo Central.");
                    })
                    .catch(() => {});
            })();
        </script>
    </head>
    <body
        class={`min-h-screen flex flex-col antialiased text-slate-900 bg-slate-50 transition-colors duration-300 ${bodyClass}`}
    >
        {
            showBackground && (
                <>
                    <div class="fixed inset-0 -z-10 h-full w-full bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:14px_24px]" />
                    <div class="fixed inset-0 -z-10 h-full w-full bg-[radial-gradient(circle_800px_at_100%_200px,rgba(29,78,216,0.15),transparent)]" />
                </>
            )
        }

        <Header className={headerClass} />

        <main class={`flex-grow ${mainClass}`}>
            <slot />
        </main>

        <Toast />
        <Footer className={footerClass} />
        <Search />
    </body>
</html>
