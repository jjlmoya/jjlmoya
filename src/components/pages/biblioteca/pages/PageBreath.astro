---
interface Props {
    side: 'left' | 'right';
}
const { side } = Astro.props;
---

{side === 'left' ? (
    <div class="flex items-center justify-center h-full w-full relative overflow-hidden bg-[#0c0a09]">
        <!-- Breath Visual: Ethereal Mist -->
        <div class="relative w-full h-full flex items-center justify-center">
             
             <!-- The "Cold" Atmosphere -->
             <div class="absolute inset-0 bg-gradient-to-b from-transparent via-blue-900/5 to-transparent pointer-events-none"></div>

             <!-- Living Breath Entity -->
             <div class="relative flex items-center justify-center">
                <!-- Core Essence (The Warmth) -->
                <div class="w-16 h-16 bg-blue-100/30 rounded-full blur-xl animate-pulse-slow mix-blend-screen"></div>
                
                <!-- Mist Layers (The Breath) -->
                <!-- Layer 1: Expansion -->
                <div class="absolute w-32 h-32 bg-gradient-to-tr from-cyan-200/10 to-blue-300/5 rounded-full blur-2xl animate-mist-expand mix-blend-screen"></div>
                
                <!-- Layer 2: Drift -->
                <div class="absolute w-40 h-40 bg-blue-100/5 rounded-full blur-3xl animate-mist-drift mix-blend-screen" style="animation-delay: -2s"></div>
                
                <!-- Layer 3: Dissipation -->
                <div class="absolute w-48 h-48 border-[20px] border-blue-200/5 rounded-full blur-3xl animate-mist-fade mix-blend-screen"></div>
                
                <!-- Subtle Particles -->
                <div class="absolute inset-0 w-64 h-64 animate-spin-super-slow opacity-20">
                    <div class="absolute top-10 left-1/2 w-2 h-2 bg-white rounded-full blur-[2px]"></div>
                    <div class="absolute bottom-20 left-1/3 w-3 h-3 bg-blue-200 rounded-full blur-[4px]"></div>
                    <div class="absolute top-1/2 right-10 w-1 h-1 bg-cyan-100 rounded-full blur-[1px]"></div>
                </div>
             </div>
        </div>
    </div>
) : (
    <div class="flex flex-col items-center justify-center h-full text-center space-y-6 max-w-md mx-auto">
        <h3 class="font-serif text-3xl text-blue-200/60 uppercase tracking-widest">El Aliento</h3>
        
        <div class="space-y-2">
            <div class="font-variant-numeric tabular-nums text-4xl md:text-5xl font-bold text-[#e7e5e4]" id="breath-counter">
                0
            </div>
            <div class="text-sm text-[#e7e5e4]/40 uppercase tracking-wider">Respiraciones</div>
        </div>
        
        <p class="text-xl leading-relaxed text-[#e7e5e4]" style="font-family: 'Cinzel', serif; font-variant: small-caps;">
            TOMÁIS PRESTADO EL AIRE Y LO DEVOLVÉIS. UNA Y OTRA VEZ. MANTENÉIS LA CALDERA ENCENDIDA CONTRA EL FRÍO DEL UNIVERSO. BIEN HECHO.
        </p>
    </div>
)}

<style>
    @keyframes mist-expand {
        0%, 100% { transform: scale(1) translate(0, 0); opacity: 0.3; }
        50% { transform: scale(1.5) translate(-10px, -10px); opacity: 0.6; }
    }
    
    @keyframes mist-drift {
        0%, 100% { transform: scale(1.2) translate(0, 0) rotate(0deg); opacity: 0.2; }
        50% { transform: scale(1.4) translate(15px, 10px) rotate(10deg); opacity: 0.4; }
    }

    @keyframes mist-fade {
        0% { transform: scale(0.8); opacity: 0; }
        50% { opacity: 0.2; }
        100% { transform: scale(2); opacity: 0; }
    }

    @keyframes pulse-slow {
        0%, 100% { transform: scale(1); opacity: 0.5; }
        50% { transform: scale(1.1); opacity: 0.8; }
    }

    @keyframes spin-super-slow {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .animate-mist-expand {
        animation: mist-expand 6s ease-in-out infinite;
    }
    .animate-mist-drift {
        animation: mist-drift 8s ease-in-out infinite;
    }
    .animate-mist-fade {
        animation: mist-fade 5s ease-out infinite;
    }
    .animate-pulse-slow {
        animation: pulse-slow 4s ease-in-out infinite;
    }
    .animate-spin-super-slow {
        animation: spin-super-slow 60s linear infinite;
    }
</style>

<script>
    const counter = document.getElementById('breath-counter');
    let animationFrame: number;

    document.addEventListener('update-life-stats', (e: any) => {
        const { birthdate } = e.detail;
        if (!counter) return;

        const start = () => {
            const now = new Date();
            // Avg breath rate ~16 bpm (adult average)
            const msAlive = now.getTime() - new Date(birthdate).getTime();
            const preciseBreaths = msAlive * (16 / 60000);
            
            counter.innerText = Math.floor(preciseBreaths).toLocaleString();
            animationFrame = requestAnimationFrame(start);
        };
        
        if (animationFrame) cancelAnimationFrame(animationFrame);
        start();
    });
</script>
