---

---

<div class="grid lg:grid-cols-2 gap-8 lg:gap-12 max-w-6xl mx-auto">
    <div class="space-y-8">
        <div
            class="bg-white dark:bg-slate-900 rounded-2xl p-6 shadow-sm border border-slate-200 dark:border-slate-800 relative overflow-hidden group"
        >
            <div class="absolute top-0 left-0 w-1 h-full bg-rose-500"></div>
            <h2
                class="text-lg font-bold text-slate-800 dark:text-white mb-6 flex items-center gap-2"
            >
                <span
                    class="w-6 h-6 rounded-full bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400 flex items-center justify-center text-xs"
                    >1</span
                >
                Receta Original
            </h2>

            <div class="space-y-6">
                <div class="grid grid-cols-3 gap-3">
                    <button
                        class="shape-btn active flex flex-col items-center justify-center p-3 rounded-xl border transition-all duration-200 bg-slate-900 dark:bg-white text-white dark:text-slate-900 border-transparent shadow-md transform scale-105"
                        data-target="original"
                        data-shape="round"
                    >
                        <div class="w-8 h-8 rounded-full border-2 border-current mb-1"></div>
                        <span class="text-xs font-medium">Redondo</span>
                    </button>
                    <button
                        class="shape-btn flex flex-col items-center justify-center p-3 rounded-xl border transition-all duration-200 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:border-slate-300 dark:hover:border-slate-600"
                        data-target="original"
                        data-shape="square"
                    >
                        <div class="w-8 h-8 border-2 border-current mb-1"></div>
                        <span class="text-xs font-medium">Cuadrado</span>
                    </button>
                    <button
                        class="shape-btn flex flex-col items-center justify-center p-3 rounded-xl border transition-all duration-200 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:border-slate-300 dark:hover:border-slate-600"
                        data-target="original"
                        data-shape="rectangular"
                    >
                        <div class="w-10 h-6 border-2 border-current mb-1"></div>
                        <span class="text-xs font-medium">Rectangular</span>
                    </button>
                </div>

                <div id="original-inputs" class="space-y-4"></div>
            </div>
        </div>

        <div
            class="bg-white dark:bg-slate-900 rounded-2xl p-6 shadow-sm border border-slate-200 dark:border-slate-800 relative overflow-hidden group"
        >
            <div class="absolute top-0 left-0 w-1 h-full bg-emerald-500"></div>
            <h2
                class="text-lg font-bold text-slate-800 dark:text-white mb-6 flex items-center gap-2"
            >
                <span
                    class="w-6 h-6 rounded-full bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 flex items-center justify-center text-xs"
                    >2</span
                >
                Tu Molde
            </h2>

            <div class="space-y-6">
                <div class="grid grid-cols-3 gap-3">
                    <button
                        class="shape-btn active flex flex-col items-center justify-center p-3 rounded-xl border transition-all duration-200 bg-slate-900 dark:bg-white text-white dark:text-slate-900 border-transparent shadow-md transform scale-105"
                        data-target="target"
                        data-shape="round"
                    >
                        <div class="w-8 h-8 rounded-full border-2 border-current mb-1"></div>
                        <span class="text-xs font-medium">Redondo</span>
                    </button>
                    <button
                        class="shape-btn flex flex-col items-center justify-center p-3 rounded-xl border transition-all duration-200 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:border-slate-300 dark:hover:border-slate-600"
                        data-target="target"
                        data-shape="square"
                    >
                        <div class="w-8 h-8 border-2 border-current mb-1"></div>
                        <span class="text-xs font-medium">Cuadrado</span>
                    </button>
                    <button
                        class="shape-btn flex flex-col items-center justify-center p-3 rounded-xl border transition-all duration-200 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:border-slate-300 dark:hover:border-slate-600"
                        data-target="target"
                        data-shape="rectangular"
                    >
                        <div class="w-10 h-6 border-2 border-current mb-1"></div>
                        <span class="text-xs font-medium">Rectangular</span>
                    </button>
                </div>

                <div id="target-inputs" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <div class="lg:sticky lg:top-8 space-y-6 h-fit">
        <div
            class="bg-gradient-to-br from-slate-900 to-slate-800 text-white rounded-3xl p-8 shadow-xl relative overflow-hidden"
        >
            <div
                class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"
            >
            </div>

            <div class="relative z-10 text-center">
                <p class="text-slate-300 text-sm font-medium uppercase tracking-wider mb-2">
                    Factor Multiplicador
                </p>
                <div class="flex items-baseline justify-center gap-1 mb-4">
                    <span class="text-6xl font-bold font-display tracking-tight" id="result-factor"
                        >x1.00</span
                    >
                </div>
                <p class="text-slate-300 text-lg" id="result-text">Usa las mismas cantidades.</p>
            </div>
        </div>

        <div
            class="bg-slate-100 dark:bg-slate-950/50 rounded-2xl p-8 border border-slate-200 dark:border-slate-800 flex items-center justify-center min-h-[300px] relative overflow-hidden"
        >
            <div class="absolute inset-0 grid-bg opacity-10 pointer-events-none"></div>

            <svg
                id="visualizer"
                width="100%"
                height="300"
                viewBox="0 0 400 300"
                class="w-full h-full"
            >
                <g id="viz-container" transform="translate(200, 150)">
                    <path
                        id="shape-original"
                        d=""
                        fill="rgba(244, 63, 94, 0.2)"
                        stroke="#f43f5e"
                        stroke-width="2"
                        stroke-dasharray="4 4"></path>
                    <path
                        id="shape-target"
                        d=""
                        fill="rgba(16, 185, 129, 0.2)"
                        stroke="#10b981"
                        stroke-width="2"></path>
                </g>
            </svg>

            <div class="absolute bottom-4 left-4 flex gap-4 text-xs font-medium">
                <div class="flex items-center gap-2 text-rose-600 dark:text-rose-400">
                    <div class="w-3 h-3 border border-current bg-rose-500/20 rounded-sm"></div>
                    Original
                </div>
                <div class="flex items-center gap-2 text-emerald-600 dark:text-emerald-400">
                    <div class="w-3 h-3 border border-current bg-emerald-500/20 rounded-sm"></div>
                    Tuyo
                </div>
            </div>
        </div>

        <div
            class="bg-white dark:bg-slate-900 rounded-2xl p-6 shadow-sm border border-slate-200 dark:border-slate-800"
        >
            <h3
                class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-6 flex items-center gap-2"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-5 h-5"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><path d="M3 3v18h18"></path><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"
                    ></path></svg
                >
                Calculadora de Ingredientes
            </h3>

            <div id="ingredients-list" class="space-y-4 mb-6"></div>

            <button
                id="add-ingredient-btn"
                class="w-full py-3 rounded-xl text-cyan-600 dark:text-cyan-400 hover:bg-cyan-50 dark:hover:bg-cyan-900/20 transition-colors text-sm font-bold flex items-center justify-center gap-2"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-4 h-4"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><line x1="12" y1="5" x2="12" y2="19"></line><line
                        x1="5"
                        y1="12"
                        x2="19"
                        y2="12"></line></svg
                >
                Añadir Ingrediente
            </button>
        </div>
    </div>
</div>

<style>
    .grid-bg {
        background-image: radial-gradient(currentColor 1px, transparent 1px);
        background-size: 20px 20px;
    }
</style>

<script>
    type Shape = "round" | "square" | "rectangular";

    interface MoldState {
        shape: Shape;
        dim1: number;
        dim2: number;
    }

    interface Ingredient {
        id: string;
        name: string;
        weight: number;
    }

    const state = {
        original: { shape: "round", dim1: 20, dim2: 20 } as MoldState,
        target: { shape: "round", dim1: 20, dim2: 20 } as MoldState,
        ingredients: [
            { id: "1", name: "Harina", weight: 0 },
            { id: "2", name: "Azúcar", weight: 0 },
        ] as Ingredient[],
        currentFactor: 1,
    };

    const els = {
        originalInputs: document.getElementById("original-inputs"),
        targetInputs: document.getElementById("target-inputs"),
        resultFactor: document.getElementById("result-factor"),
        resultText: document.getElementById("result-text"),
        shapeOriginal: document.getElementById("shape-original"),
        shapeTarget: document.getElementById("shape-target"),
        ingredientsList: document.getElementById("ingredients-list"),
        addIngredientBtn: document.getElementById("add-ingredient-btn"),
    };

    const getInputsHTML = (type: "original" | "target", shape: Shape, values: MoldState) => {
        const labelClass =
            "block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1.5 uppercase tracking-wide";
        const inputClass =
            "w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-900 dark:text-white font-medium focus:ring-2 focus:ring-cyan-500 focus:border-transparent outline-none transition-all";

        if (shape === "round") {
            return `
                <div class="input-group">
                    <label class="${labelClass}">Diámetro (cm)</label>
                    <input class="${inputClass}" type="number" value="${values.dim1}" min="1" step="0.5" data-type="${type}" data-key="dim1">
                </div>
            `;
        } else if (shape === "square") {
            return `
                <div class="input-group">
                    <label class="${labelClass}">Lado (cm)</label>
                    <input class="${inputClass}" type="number" value="${values.dim1}" min="1" step="0.5" data-type="${type}" data-key="dim1">
                </div>
            `;
        } else {
            return `
                <div class="grid grid-cols-2 gap-4">
                    <div class="input-group">
                        <label class="${labelClass}">Ancho (cm)</label>
                        <input class="${inputClass}" type="number" value="${values.dim1}" min="1" step="0.5" data-type="${type}" data-key="dim1">
                    </div>
                    <div class="input-group">
                        <label class="${labelClass}">Largo (cm)</label>
                        <input class="${inputClass}" type="number" value="${values.dim2}" min="1" step="0.5" data-type="${type}" data-key="dim2">
                    </div>
                </div>
            `;
        }
    };

    const getArea = (s: MoldState) => {
        if (s.shape === "round") {
            return Math.PI * Math.pow(s.dim1 / 2, 2);
        } else if (s.shape === "square") {
            return s.dim1 * s.dim1;
        } else {
            return s.dim1 * s.dim2;
        }
    };

    const getPath = (s: MoldState, scale = 5) => {
        if (s.shape === "round") {
            const r = (s.dim1 / 2) * scale;

            return `M 0,${-r} A ${r},${r} 0 1,1 0,${r} A ${r},${r} 0 1,1 0,${-r}`;
        } else {
            const w = s.dim1 * scale;
            const h = (s.shape === "square" ? s.dim1 : s.dim2) * scale;
            const x = -w / 2;
            const y = -h / 2;
            return `M ${x},${y} h ${w} v ${h} h ${-w} Z`;
        }
    };

    const update = () => {
        const areaOriginal = getArea(state.original);
        const areaTarget = getArea(state.target);

        let factor = areaTarget / areaOriginal;

        factor = Math.round(factor * 100) / 100;

        if (els.resultFactor) els.resultFactor.textContent = `x${factor.toFixed(2)}`;

        if (els.resultText) {
            if (factor === 1) {
                els.resultText.textContent =
                    "Los moldes son equivalentes. Usa las mismas cantidades.";
            } else if (factor < 1) {
                els.resultText.innerHTML = `Tu molde es más pequeño. <br><span class="text-rose-400 font-bold">Reduce</span> los ingredientes multiplicándolos por <span class="font-bold text-white">${factor}</span>.`;
            } else {
                els.resultText.innerHTML = `Tu molde es más grande. <br><span class="text-emerald-400 font-bold">Aumenta</span> los ingredientes multiplicándolos por <span class="font-bold text-white">${factor}</span>.`;
            }
        }

        const scale = 6;

        if (els.shapeOriginal) els.shapeOriginal.setAttribute("d", getPath(state.original, scale));
        if (els.shapeTarget) els.shapeTarget.setAttribute("d", getPath(state.target, scale));

        state.currentFactor = factor;
        renderIngredients();
    };

    const renderIngredients = () => {
        if (!els.ingredientsList) return;

        els.ingredientsList.innerHTML = state.ingredients
            .map((ing) => {
                const finalWeight = Math.round(ing.weight * state.currentFactor);
                const isCalculated = ing.weight > 0;

                return `
                <div class="flex flex-col md:flex-row gap-4 items-start md:items-end p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl group relative border border-slate-100 dark:border-slate-700/50">
                    
                    <div class="w-full md:flex-1 space-y-1.5">
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Ingrediente</label>
                        <input 
                            type="text" 
                            value="${ing.name}" 
                            class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2.5 text-sm text-slate-700 dark:text-slate-200 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-all shadow-sm"
                            onchange="updateIngredient('${ing.id}', 'name', this.value)"
                            placeholder="Ej. Harina"
                        >
                    </div>

                    <div class="w-full md:w-32 space-y-1.5">
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Original</label>
                        <input 
                            type="number" 
                            value="${ing.weight || ""}" 
                            class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2.5 text-sm text-slate-700 dark:text-slate-200 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-all shadow-sm"
                            onchange="updateIngredient('${ing.id}', 'weight', parseFloat(this.value))"
                            placeholder="0"
                        >
                    </div>

                    <div class="w-full md:w-32 space-y-1.5">
                        <label class="text-[10px] font-bold text-emerald-600 dark:text-emerald-400 uppercase tracking-wider">Final</label>
                        <div class="w-full bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-800/30 rounded-lg px-3 py-2.5 text-sm font-bold text-emerald-700 dark:text-emerald-400 h-[42px] flex items-center shadow-sm">
                            ${isCalculated ? finalWeight : "-"}
                        </div>
                    </div>

                    <div class="absolute top-2 right-2 md:static md:h-[42px] md:flex md:items-center">
                        <button 
                            onclick="removeIngredient('${ing.id}')"
                            class="text-slate-400 hover:text-rose-500 transition-colors p-2 rounded-lg hover:bg-rose-50 dark:hover:bg-rose-900/20"
                            title="Eliminar"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                    </div>
                </div>
            `;
            })
            .join("");
    };

    (window as any).updateIngredient = (id: string, field: "name" | "weight", value: any) => {
        const ing = state.ingredients.find((i) => i.id === id);
        if (ing) {
            if (field === "weight") ing.weight = value || 0;
            else ing.name = value;
            renderIngredients();
        }
    };

    (window as any).removeIngredient = (id: string) => {
        state.ingredients = state.ingredients.filter((i) => i.id !== id);
        renderIngredients();
    };

    const setupListeners = () => {
        document.querySelectorAll(".shape-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
                const target = (e.currentTarget as HTMLElement).dataset.target as
                    | "original"
                    | "target";
                const shape = (e.currentTarget as HTMLElement).dataset.shape as Shape;

                state[target].shape = shape;

                if (shape === "rectangular" && state[target].dim2 === state[target].dim1) {
                    state[target].dim2 = state[target].dim1 + 5;
                }

                const activeClasses = [
                    "bg-slate-900",
                    "dark:bg-white",
                    "text-white",
                    "dark:text-slate-900",
                    "border-transparent",
                    "shadow-md",
                    "transform",
                    "scale-105",
                ];
                const inactiveClasses = [
                    "border-slate-200",
                    "dark:border-slate-700",
                    "text-slate-500",
                    "dark:text-slate-400",
                    "hover:bg-slate-50",
                    "dark:hover:bg-slate-800",
                    "hover:border-slate-300",
                    "dark:hover:border-slate-600",
                ];

                document.querySelectorAll(`.shape-btn[data-target="${target}"]`).forEach((b) => {
                    b.classList.remove("active");
                    b.classList.remove(...activeClasses);
                    b.classList.add(...inactiveClasses);
                });

                const currentBtn = e.currentTarget as HTMLElement;
                currentBtn.classList.add("active");
                currentBtn.classList.remove(...inactiveClasses);
                currentBtn.classList.add(...activeClasses);

                renderInputs(target);
                update();
            });
        });

        const handleInput = (e: Event) => {
            const input = e.target as HTMLInputElement;
            const type = input.dataset.type as "original" | "target";
            const key = input.dataset.key as "dim1" | "dim2";

            if (type && key) {
                state[type][key] = parseFloat(input.value) || 0;
                update();
            }
        };

        els.originalInputs?.addEventListener("input", handleInput);
        els.targetInputs?.addEventListener("input", handleInput);

        els.addIngredientBtn?.addEventListener("click", () => {
            const newId = Math.random().toString(36).slice(2, 11);
            state.ingredients.push({ id: newId, name: "", weight: 0 });
            renderIngredients();
        });
    };

    const renderInputs = (target: "original" | "target") => {
        const container = target === "original" ? els.originalInputs : els.targetInputs;
        if (container) {
            container.innerHTML = getInputsHTML(target, state[target].shape, state[target]);
        }
    };

    renderInputs("original");
    renderInputs("target");
    setupListeners();
    update();
</script>
