<div
    class="chart-container relative w-full my-8 p-6 bg-white/5 rounded-lg border border-white/10 backdrop-blur-sm"
>
    <h3 class="text-xl font-bold text-white text-center mb-2">La Trampa del "Aumento" de Sueldo</h3>
    <p class="text-slate-300 text-center mb-6 text-sm">
        Imagina que en el año 2000 ganabas <strong class="text-emerald-400">1.000€</strong>. Así ha
        evolucionado tu vida:
    </p>

    <div class="relative w-full h-[300px] md:h-[400px]">
        <canvas id="moneyIllusionChart"></canvas>
    </div>

    <p class="text-sm text-slate-400 text-center mt-6 italic bg-black/20 p-4 rounded-lg">
        <span class="text-emerald-400 font-bold">Línea Verde:</span> Tu jefe te dice "¡Te hemos subido
        el sueldo a 1.780€!".<br />
        <span class="text-rose-400 font-bold">Línea Roja:</span> Vas al súper y descubres que compras
        menos cosas que cuando ganabas 1.000€.
    </p>

    <div class="mt-8 pt-6 border-t border-white/5 max-w-2xl mx-auto">
        <p class="text-[10px] uppercase tracking-widest text-slate-500 text-center mb-2 font-bold">
            Nota del Autor
        </p>
        <p class="text-sm text-slate-400 text-center italic leading-relaxed">
            "Como la gráfica me dio bastante susto cuando la vi, pensé que había cometido un error y
            fui a doble-checkear con la IA: <span class="text-white not-italic font-medium"
                >«A ver crack, que no es un error, Tienes más pavinis, pero valen mucho menos.
                Espabila que la vida te va a comer».</span
            > Menudo bicho sin sentimientos"
        </p>
    </div>
</div>

<script>
    import { Chart, registerables } from "chart.js";
    Chart.register(...registerables);

    document.addEventListener("DOMContentLoaded", () => {
        const canvas = document.getElementById("moneyIllusionChart") as HTMLCanvasElement;
        if (!canvas) return;

        const existingChart = Chart.getChart(canvas);
        if (existingChart) {
            existingChart.destroy();
        }

        const initChart = () => {
            new Chart(canvas, {
                type: "line",
                data: {
                    labels: ["2000", "2004", "2008", "2012", "2016", "2020", "2024"],
                    datasets: [
                        {
                            label: "  Lo que ingresas",

                            data: [1000, 1150, 1320, 1380, 1420, 1550, 1780],
                            borderColor: "#34d399",
                            backgroundColor: "#34d399",
                            tension: 0.3,
                            borderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: "#34d399",
                        },
                        {
                            label: "  Para lo que te da",

                            data: [1000, 1010, 1020, 980, 990, 970, 950],
                            borderColor: "#fb7185",
                            backgroundColor: "#fb7185",
                            tension: 0.3,
                            borderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBackgroundColor: "#fb7185",
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: "index",
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: "top",
                            labels: {
                                color: "#e2e8f0",
                                font: {
                                    family: "'Inter', sans-serif",
                                    size: 14,
                                },
                                usePointStyle: true,
                                boxWidth: 10,
                                padding: 20,
                            },
                        },
                        tooltip: {
                            backgroundColor: "rgba(15, 23, 42, 0.95)",
                            titleColor: "#f8fafc",
                            bodyColor: "#e2e8f0",
                            borderColor: "rgba(255, 255, 255, 0.1)",
                            borderWidth: 1,
                            padding: 12,
                            usePointStyle: true,
                            titleFont: {
                                size: 14,
                                weight: "bold",
                            },
                            bodyFont: {
                                size: 13,
                            },
                            displayColors: true,
                            callbacks: {
                                title: function (context) {
                                    return "Año " + context[0].label;
                                },
                                label: function (context) {
                                    let label = context.dataset.label || "";
                                    if (label) {
                                        label += ": ";
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y + "€";
                                    }
                                    return label;
                                },
                            },
                        },
                    },
                    scales: {
                        x: {
                            border: {
                                display: false,
                            },
                            grid: {
                                display: false,
                            },
                            ticks: {
                                color: "#94a3b8",
                                font: {
                                    size: 12,
                                },
                            },
                        },
                        y: {
                            border: {
                                display: false,
                            },
                            grid: {
                                color: "rgba(255, 255, 255, 0.05)",
                            },
                            ticks: {
                                color: "#94a3b8",
                                font: {
                                    size: 12,
                                },
                                callback: function (value) {
                                    return value + "€";
                                },
                            },
                            suggestedMin: 800,
                            suggestedMax: 1900,
                        },
                    },
                    animation: {
                        duration: 1500,
                        easing: "easeOutQuart",
                    },
                },
            });
        };

        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        initChart();
                        observer.disconnect();
                    }
                });
            },
            { threshold: 0.2 }
        );

        observer.observe(canvas);
    });
</script>
