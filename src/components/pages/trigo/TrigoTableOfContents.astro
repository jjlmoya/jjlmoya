---
const sections = [
    { id: "positive-documentation", label: "Referencias", theme: "emerald" },
    { id: "positive-expansion", label: "IX. La Expansión", theme: "emerald" },
    { id: "positive-knowledge", label: "VIII. La Ciencia", theme: "emerald" },
    { id: "positive-specialization", label: "VII. El Genio", theme: "emerald" },
    { id: "positive-law", label: "VI. La Ley", theme: "emerald" },
    { id: "positive-beer", label: "V. La Fiesta", theme: "emerald" },
    { id: "positive-trade", label: "IV. El Comercio", theme: "emerald" },
    { id: "positive-writing", label: "III. La Escritura", theme: "emerald" },
    { id: "positive-city", label: "II. La Ciudad", theme: "emerald" },
    { id: "positive-security", label: "I. La Seguridad", theme: "emerald" },
    { id: "intro", label: "Inicio", theme: "neutral" },
    { id: "tiempo-profundo", label: "I. Tiempo Profundo", theme: "amber" },
    { id: "raquis", label: "II. El Raquis", theme: "amber" },
    { id: "trampa", label: "III. La Trampa", theme: "amber" },
    { id: "rutina", label: "IV. La Rutina", theme: "amber" },
    { id: "cuerpos-rotos", label: "V. Cuerpos Rotos", theme: "amber" },
    { id: "calorias-cazador", label: "VI. Calorías (Cazador)", theme: "amber" },
    { id: "calorias-agricultor", label: "VII. Calorías (Agricultor)", theme: "amber" },
    { id: "excedente", label: "VIII. El Excedente", theme: "amber" },
    { id: "contrato-social", label: "IX. Contrato Social", theme: "amber" },
    { id: "demografia", label: "X. Demografía", theme: "amber" },
    { id: "jornada-laboral", label: "XI. Jornada Laboral", theme: "amber" },
    { id: "mapa-moderno", label: "XII. Mapa Moderno", theme: "amber" },
    { id: "futuro", label: "XIII. El Futuro", theme: "amber" },
    { id: "epilogo", label: "Epílogo", theme: "neutral" },
    { id: "documentacion", label: "Referencias", theme: "neutral" },
];
---

<nav
    class="fixed right-4 top-1/2 -translate-y-1/2 z-50 hidden lg:flex flex-col gap-4"
    aria-label="Table of Contents"
>
    {
        sections.map((section) => (
            <a
                href={`#${section.id}`}
                class="group flex items-center justify-end gap-3"
                aria-label={`Ir a ${section.label}`}
                data-theme={section.theme}
            >
                <span
                    class:list={[
                        "text-[10px] uppercase tracking-widest opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300 bg-black/50 backdrop-blur-sm px-2 py-1 rounded",
                        section.theme === "emerald"
                            ? "text-emerald-400"
                            : section.theme === "amber"
                              ? "text-amber-400"
                              : "text-stone-400",
                    ]}
                >
                    {section.label}
                </span>
                <div
                    class:list={[
                        "w-2 h-2 rounded-full border transition-all duration-300 group-hover:scale-125",
                        "bg-stone-800 border-stone-700", // Default state
                        `group-hover:bg-${section.theme === "neutral" ? "stone" : section.theme}-500`,
                        `group-hover:border-${section.theme === "neutral" ? "stone" : section.theme}-500`,
                    ]}
                />
            </a>
        ))
    }
</nav>

<script>
    const observerOptions = {
        root: null,
        rootMargin: "-50% 0px",
        threshold: 0,
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                const id = entry.target.id;
                const link = document.querySelector(`a[href="#${id}"]`);
                const navDot = link?.querySelector("div");

                if (!link || !navDot) return;

                const theme = link.getAttribute("data-theme");

                // Reset all dots
                document.querySelectorAll("nav a div").forEach((dot) => {
                    dot.className =
                        "w-2 h-2 rounded-full border transition-all duration-300 group-hover:scale-125 bg-stone-800 border-stone-700";
                });

                // Highlight active
                let activeClass = "";
                if (theme === "emerald")
                    activeClass = "bg-emerald-500 border-emerald-500 scale-125";
                else if (theme === "amber") activeClass = "bg-amber-500 border-amber-500 scale-125";
                else activeClass = "bg-stone-500 border-stone-500 scale-125";

                navDot.className = `w-2 h-2 rounded-full border transition-all duration-300 ${activeClass}`;
            }
        });
    }, observerOptions);

    document.querySelectorAll("section[id]").forEach((section) => {
        observer.observe(section);
    });
</script>
