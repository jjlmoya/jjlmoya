---

---

<section
    id="demografia"
    class="relative text-[#e7e5e4] font-serif min-h-screen flex items-center justify-center py-12 md:py-24 overflow-hidden"
>
    <div class="max-w-6xl mx-auto px-6 w-full">
        <div class="text-center mb-12">
            <span
                class="trigo-chapter text-amber-600/60 text-xs md:text-sm tracking-[0.2em] uppercase block mb-4"
                >Demografía</span
            >
            <h2 class="text-3xl md:text-5xl font-bold mb-6">La Explosión</h2>
            <p class="text-[#a8a29e] max-w-2xl mx-auto">
                Durante 200.000 años fuimos pocos. Luego llegó el trigo.
            </p>
        </div>

        <div
            class="relative w-full h-[400px] md:h-[500px] bg-[#1c1917] border border-amber-900/20 p-4 md:p-8 rounded-lg"
        >
            <canvas id="populationChart"></canvas>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-12">
            <div class="text-center p-6 bg-[#1c1917] rounded border border-amber-900/10">
                <div class="text-3xl font-bold text-amber-500 mb-2">~5 Millones</div>
                <div class="text-sm text-[#a8a29e] uppercase tracking-widest">
                    Población Paleolítica
                </div>
            </div>
            <div class="text-center p-6 bg-[#1c1917] rounded border border-amber-900/10">
                <div class="text-3xl font-bold text-amber-500 mb-2">~200 Millones</div>
                <div class="text-sm text-[#a8a29e] uppercase tracking-widest">Imperio Romano</div>
            </div>
            <div class="text-center p-6 bg-[#1c1917] rounded border border-amber-900/10">
                <div class="text-3xl font-bold text-amber-500 mb-2">8.200 Millones</div>
                <div class="text-sm text-[#a8a29e] uppercase tracking-widest">Población 2025</div>
            </div>
        </div>
    </div>
</section>

<script>
    import { Chart, registerables } from "chart.js";
    Chart.register(...registerables);

    document.addEventListener("astro:page-load", () => {
        const canvas = document.getElementById("populationChart") as HTMLCanvasElement;
        if (!canvas) return;

        // Destroy existing chart if it exists
        const existingChart = Chart.getChart(canvas);
        if (existingChart) {
            existingChart.destroy();
        }

        const initChart = () => {
            new Chart(canvas, {
                type: "line",
                data: {
                    labels: [
                        "200.000 a.C.",
                        "100.000 a.C.",
                        "10.000 a.C.",
                        "0",
                        "1000 d.C.",
                        "1800 d.C.",
                        "2025",
                    ],
                    datasets: [
                        {
                            label: "Población Humana (Millones)",
                            data: [0.5, 1, 4, 200, 300, 1000, 8200],
                            borderColor: "#f59e0b", // amber-500
                            backgroundColor: (context) => {
                                const ctx = context.chart.ctx;
                                const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                                gradient.addColorStop(0, "rgba(245, 158, 11, 0.5)");
                                gradient.addColorStop(1, "rgba(245, 158, 11, 0)");
                                return gradient;
                            },
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 4,
                            pointHoverRadius: 8,
                            pointBackgroundColor: "#f59e0b",
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: "index",
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: false,
                        },
                        tooltip: {
                            backgroundColor: "rgba(28, 25, 23, 0.95)",
                            titleColor: "#f59e0b",
                            bodyColor: "#e7e5e4",
                            borderColor: "rgba(245, 158, 11, 0.2)",
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function (context) {
                                    const value = context.parsed.y ?? 0;
                                    return value.toLocaleString() + " Millones";
                                },
                            },
                        },
                    },
                    scales: {
                        x: {
                            grid: {
                                color: "rgba(120, 113, 108, 0.1)",
                            },
                            ticks: {
                                color: "#a8a29e",
                                maxRotation: 45,
                                minRotation: 45,
                            },
                        },
                        y: {
                            grid: {
                                color: "rgba(120, 113, 108, 0.1)",
                            },
                            ticks: {
                                color: "#a8a29e",
                                callback: function (value) {
                                    return value.toLocaleString() + " M";
                                },
                            },
                        },
                    },
                    animation: {
                        duration: 2000,
                        easing: "easeOutQuart",
                    },
                },
            });
        };

        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        initChart();
                        observer.disconnect();
                    }
                });
            },
            { threshold: 0.2 }
        );

        observer.observe(canvas);
    });
</script>
