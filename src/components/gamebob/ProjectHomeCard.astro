---
import { Icon } from "astro-icon/components";
import type { Project } from "../../data/gamebob/roadmap/types";
import type { Application } from "../../types/apps";

interface Props {
    project: Project | Application;
    index: number;
}

const { project, index } = Astro.props;

const name = "title" in project ? project.title : project.name;
const description = project.description;
const homeDescription =
    "homeDescription" in project ? project.homeDescription : project.description;
const image = "media" in project ? project.media.showcase : project.image;
const statusLabel = "roadmap" in project ? project.roadmap.statusLabel : project.statusLabel;
const statusType = "roadmap" in project ? project.roadmap.statusType : project.statusType;
const color = "theme" in project ? project.theme.primary : project.color;
const links =
    "stores" in project
        ? {
              googlePlay: project.stores.googlePlay,
              appStore: project.stores.appStore,
          }
        : project.links;

const isEven = index % 2 === 0;

const statusColors = {
    released: "bg-emerald-500/10 border-emerald-500/30 text-emerald-400",
    developing: "bg-blue-500/10 border-blue-300/30 text-blue-400",
    qa: "bg-amber-500/10 border-amber-500/30 text-amber-400",
    planning: "bg-blue-500/10 border-blue-500/30 text-blue-400",
};

const statusClasses = statusColors[statusType] || statusColors.developing;

const nameParts = name.includes(":") ? [name.split(":")[0], name.split(":")[1]] : [name, ""];
---

<div
    class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center mt-24 pt-24 border-t border-white/5 first:mt-0 first:pt-0 first:border-0"
>
    <div class:list={["space-y-6", { "order-2": !isEven, "order-2 md:order-1": isEven }]}>
        <h3
            class="text-5xl font-black tracking-tighter text-[var(--color-gamebob-text)] uppercase leading-none"
        >
            {nameParts[0]}<br />
            <span style={`color: ${color}`}>{nameParts[1].trim()}</span>
        </h3>
        <p class="text-gray-400 text-lg leading-relaxed lowercase">
            {homeDescription}
        </p>

        <div class="flex items-center gap-4 pt-4">
            <div
                class:list={[
                    "px-4 py-2 border rounded-lg text-sm font-medium",
                    statusClasses,
                    { "animate-pulse": statusType !== "released" },
                ]}
            >
                {statusLabel}
            </div>
        </div>

        <div class="flex gap-4 pt-4">
            {
                links?.googlePlay ? (
                    <a
                        href={links.googlePlay}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="h-12 px-6 bg-white text-black hover:bg-[var(--color-gamebob-primary)] transition-colors rounded-lg flex items-center gap-3 shadow-lg"
                    >
                        <Icon name="mdi:google-play" class="w-6 h-6" />
                        <div class="text-left">
                            <div class="text-[10px] leading-none">DISPONIBLE EN</div>
                            <div class="text-sm font-bold leading-none">Google Play</div>
                        </div>
                    </a>
                ) : (
                    <div class="flex gap-4 opacity-50 grayscale">
                        <div class="h-12 px-6 bg-white/10 rounded-lg flex items-center gap-3 text-white">
                            <Icon name="mdi:google-play" class="w-6 h-6" />
                            <div class="text-left">
                                <div class="text-[10px] leading-none">PRÓXIMAMENTE EN</div>
                                <div class="text-sm font-bold leading-none">Google Play</div>
                            </div>
                        </div>
                    </div>
                )
            }

            <button
                class="h-12 px-6 bg-white/10 rounded-lg flex items-center gap-3 cursor-not-allowed text-white opacity-50 grayscale"
                title="Próximamente en App Store"
            >
                <Icon name="mdi:apple" class="w-6 h-6" />
                <div class="text-left">
                    <div class="text-[10px] leading-none text-gray-400">Descárgalo en el</div>
                    <div class="text-sm font-bold leading-none text-gray-400">App Store</div>
                </div>
            </button>
        </div>
    </div>

    <div
        class:list={[
            "relative group rounded-2xl overflow-hidden shadow-2xl border border-white/10",
            { "order-1": !isEven, "order-1 md:order-2": isEven },
        ]}
        style={`--tw-shadow-color: ${color}33; shadow-color: var(--tw-shadow-color)`}
    >
        <div
            class:list={[
                "bg-slate-900 flex items-center justify-center relative overflow-hidden",
                "aspect-[2/3] md:aspect-[3/4]",
            ]}
        >
            {
                image ? (
                    <img
                        src={image}
                        alt={`${name} Cover`}
                        class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                    />
                ) : (
                    <div class="text-white/10 font-black text-6xl uppercase tracking-widest text-center px-4">
                        {name}
                    </div>
                )
            }
            <div
                class="absolute inset-0 bg-gradient-to-br from-black/20 to-transparent z-10"
                style={`background-image: linear-gradient(to bottom right, ${color}33, transparent)`}
            >
            </div>
            <div
                class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-60 z-20"
            >
            </div>
        </div>
    </div>
</div>
