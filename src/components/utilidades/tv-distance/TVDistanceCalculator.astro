---
import { Icon } from "astro-icon/components";
---

<section class="max-w-5xl mx-auto px-4 py-12 relative">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 items-start">
        <div class="lg:col-span-4 space-y-6">
            <div
                class="bg-white/80 dark:bg-zinc-900/80 backdrop-blur-xl border border-slate-200 dark:border-zinc-800 rounded-3xl p-8 shadow-xl"
            >
                <h3
                    class="text-lg font-bold text-slate-900 dark:text-white mb-8 flex items-center gap-2"
                >
                    <Icon
                        name="mdi:television-classic"
                        class="w-5 h-5 text-blue-600 dark:text-blue-400"
                    />
                    Especificaciones
                </h3>

                <div class="space-y-8">
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <label
                                class="text-xs font-bold uppercase tracking-widest text-slate-500 dark:text-zinc-400"
                                >Tamaño Diagonal</label
                            >
                            <span
                                id="diagonal-value"
                                class="text-sm font-mono font-bold text-blue-600 dark:text-blue-400"
                                >55"</span
                            >
                        </div>
                        <input
                            type="range"
                            id="diagonal-slider"
                            min="32"
                            max="100"
                            step="1"
                            value="55"
                            class="w-full h-1.5 bg-slate-200 dark:bg-zinc-800 rounded-full appearance-none cursor-pointer accent-blue-600"
                        />
                    </div>

                    <div class="space-y-4">
                        <label
                            class="text-xs font-bold uppercase tracking-widest text-slate-500 dark:text-zinc-400"
                            >Resolución</label
                        >
                        <div class="grid grid-cols-3 gap-2">
                            {
                                ["1080p", "4K", "8K"].map((res) => (
                                    <button
                                        data-res={res.toLowerCase()}
                                        class={`res-btn py-3 rounded-xl border text-xs font-bold transition-all ${res === "4K" ? "bg-blue-600 text-white border-blue-600 shadow-lg shadow-blue-600/20" : "bg-white dark:bg-zinc-950 text-slate-600 dark:text-zinc-400 border-slate-200 dark:border-zinc-800 hover:border-blue-500/50"}`}
                                    >
                                        {res}
                                    </button>
                                ))
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-6 bg-blue-500/5 border border-blue-500/10 rounded-2xl space-y-4">
                <div class="flex items-center gap-3">
                    <Icon name="mdi:information-outline" class="w-5 h-5 text-blue-500" />
                    <span class="text-sm font-bold text-blue-700 dark:text-blue-400"
                        >Recomendación THX</span
                    >
                </div>
                <p class="text-xs leading-relaxed text-blue-600 dark:text-blue-400/80">
                    THX recomienda una distancia que cubra un ángulo de visión de 40 grados para una
                    experiencia cinematográfica inmersiva.
                </p>
            </div>
        </div>

        <div class="lg:col-span-8 space-y-8">
            <div
                class="bg-white dark:bg-zinc-950 border border-slate-200 dark:border-zinc-800 rounded-3xl p-8 shadow-2xl relative min-h-[600px] flex flex-col items-center justify-start overflow-hidden group"
            >
                <div
                    class="absolute inset-0 bg-[radial-gradient(circle_at_50%_0%,rgba(59,130,246,0.05),transparent)] pointer-events-none"
                >
                </div>

                <div class="absolute top-6 left-6 z-20">
                    <div
                        class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-100 dark:bg-zinc-900 border border-slate-200 dark:border-zinc-800 shadow-sm"
                    >
                        <div class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></div>
                        <span
                            class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-500 dark:text-zinc-400"
                            >Simulación en Tiempo Real</span
                        >
                    </div>
                </div>

                <div class="w-full flex-1 flex flex-col items-center relative gap-0 pt-20">
                    <div
                        id="room-diagram"
                        class="w-full h-auto relative flex flex-col justify-center items-center z-10"
                    >
                        <div
                            id="tv-visual"
                            class="relative bg-slate-900 rounded-lg border-4 border-slate-800 shadow-[0_20px_50px_rgba(0,0,0,0.3)] transition-all duration-700 ease-out flex flex-col items-center justify-center transform-gpu"
                        >
                            <div
                                class="w-full h-full bg-slate-950 rounded-sm overflow-hidden relative"
                            >
                                <div
                                    class="absolute inset-0 bg-gradient-to-tr from-blue-500/10 to-transparent"
                                >
                                </div>
                                <div
                                    class="absolute inset-0 flex items-center justify-center opacity-30"
                                >
                                    <Icon
                                        name="mdi:television-play"
                                        class="w-1/3 h-1/3 text-blue-400/50"
                                    />
                                </div>

                                <div
                                    class="absolute inset-0 shadow-[inset_0_0_40px_rgba(59,130,246,0.1)]"
                                >
                                </div>
                            </div>

                            <div
                                class="absolute top-full w-1/4 h-3 bg-slate-800 -mt-0.5 rounded-b-sm"
                            >
                            </div>
                            <div
                                class="absolute top-[calc(100%+3px)] w-1/2 h-1.5 bg-slate-900 rounded-sm"
                            >
                            </div>

                            <div
                                class="absolute -top-10 left-1/2 -translate-x-1/2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 text-[10px] font-black px-3 py-1.5 rounded-full whitespace-nowrap opacity-0 group-hover:opacity-100 transition-all duration-300 transform -translate-y-2 group-hover:translate-y-0 shadow-lg border border-slate-800 dark:border-slate-100"
                            >
                                <span id="tv-width-display">0</span> cm de ancho
                            </div>
                        </div>
                    </div>

                    <div
                        id="distance-line-container"
                        class="relative w-px bg-gradient-to-b from-blue-500/40 via-blue-500/20 to-transparent transition-all duration-700 ease-out z-0"
                    >
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="h-full w-px border-l border-dashed border-blue-500/30">
                            </div>
                        </div>
                    </div>

                    <div
                        id="user-visual"
                        class="relative transition-all duration-700 ease-out flex flex-col items-center z-10"
                    >
                        <div class="relative w-24 flex flex-col items-center">
                            <div
                                class="w-10 h-10 rounded-full bg-slate-200 dark:bg-zinc-800 border-2 border-slate-300 dark:border-zinc-700 mb-1 shadow-sm overflow-hidden relative"
                            >
                                <div
                                    class="absolute inset-0 bg-gradient-to-tr from-blue-500/10 to-transparent"
                                >
                                </div>
                            </div>

                            <div
                                class="w-16 h-8 bg-blue-600 dark:bg-blue-500 rounded-t-3xl shadow-lg shadow-blue-500/20 relative"
                            >
                                <div
                                    class="absolute inset-0 bg-gradient-to-b from-white/10 to-transparent rounded-t-3xl"
                                >
                                </div>
                            </div>
                        </div>

                        <div
                            class="mt-6 bg-white dark:bg-zinc-900 border border-slate-200 dark:border-zinc-800 px-5 py-3 rounded-2xl shadow-xl whitespace-nowrap transform group-hover:scale-110 transition-transform duration-500"
                        >
                            <div class="flex flex-col items-center gap-0.5">
                                <span
                                    class="text-[9px] font-black text-slate-400 dark:text-zinc-500 uppercase tracking-[0.2em]"
                                    >Tu Ubicación</span
                                >
                                <span
                                    id="distance-display"
                                    class="text-xl font-mono font-black text-blue-600 dark:text-blue-400 leading-none"
                                    >0.00m</span
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    class="absolute inset-0 pointer-events-none opacity-[0.03] dark:opacity-[0.05]"
                    style="background-image: linear-gradient(90deg, #3b82f6 1px, transparent 1px), linear-gradient(0deg, #3b82f6 1px, transparent 1px); background-size: 30px 30px;"
                >
                </div>
            </div>

            <div
                class="w-full grid grid-cols-3 gap-4 p-2 bg-slate-50 dark:bg-zinc-900/50 rounded-[2rem] border border-slate-200 dark:border-zinc-800 shadow-sm"
            >
                <div
                    class="text-center p-6 rounded-2xl hover:bg-white dark:hover:bg-zinc-900 transition-colors"
                >
                    <span
                        class="block text-[10px] font-black text-slate-400 dark:text-zinc-500 uppercase tracking-widest mb-2"
                        >Límite Mínimo</span
                    >
                    <span id="min-dist" class="text-xl font-black text-slate-900 dark:text-white"
                        >0.00m</span
                    >
                </div>
                <div
                    class="text-center p-6 bg-white dark:bg-zinc-900 rounded-2xl shadow-sm border border-slate-200 dark:border-zinc-800"
                >
                    <span
                        class="block text-[10px] font-black text-blue-600 dark:text-blue-400 uppercase tracking-widest mb-2"
                        >Distancia Óptima</span
                    >
                    <span id="opt-dist" class="text-3xl font-black text-blue-600 dark:text-blue-400"
                        >0.00m</span
                    >
                </div>
                <div
                    class="text-center p-6 rounded-2xl hover:bg-white dark:hover:bg-zinc-900 transition-colors"
                >
                    <span
                        class="block text-[10px] font-black text-slate-400 dark:text-zinc-500 uppercase tracking-widest mb-2"
                        >Límite Máximo</span
                    >
                    <span id="max-dist" class="text-xl font-black text-slate-900 dark:text-white"
                        >0.00m</span
                    >
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background: #2563eb;
        border-radius: 50%;
        cursor: pointer;
        border: 4px solid white;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }
    .dark input[type="range"]::-webkit-slider-thumb {
        border-color: #18181b;
    }
</style>

<script>
    import { ViewingCalculations } from "../../../lib/utilidades/tv-distance/ViewingCalculations";

    const diagonalSlider = document.getElementById("diagonal-slider") as HTMLInputElement;
    const diagonalValue = document.getElementById("diagonal-value");
    const resButtons = document.querySelectorAll(".res-btn");
    const distanceDisplay = document.getElementById("distance-display");
    const minDisplay = document.getElementById("min-dist");
    const optDisplay = document.getElementById("opt-dist");
    const maxDisplay = document.getElementById("max-dist");
    const tvVisual = document.getElementById("tv-visual");
    const userVisual = document.getElementById("user-visual");
    const widthDisplay = document.getElementById("tv-width-display");
    const distanceLine = document.getElementById("distance-line-container");

    let currentRes = "4k";

    function update() {
        const diagonal = parseInt(diagonalSlider.value);
        if (diagonalValue) diagonalValue.textContent = `${diagonal}"`;

        const specs = {
            diagonalInches: diagonal,
            resolution: currentRes as any,
            aspectRatio: 16 / 9,
        };
        const results = ViewingCalculations.calculate(specs);
        const { width: widthCm, height: heightCm } =
            ViewingCalculations.getDimensionsFromDiagonal(diagonal);

        if (minDisplay) minDisplay.textContent = `${results.min.toFixed(2)}m`;
        if (optDisplay) optDisplay.textContent = `${results.optimal.toFixed(2)}m`;
        if (maxDisplay) maxDisplay.textContent = `${results.max.toFixed(2)}m`;
        if (distanceDisplay) distanceDisplay.textContent = `${results.optimal.toFixed(2)}m`;
        if (widthDisplay) widthDisplay.textContent = Math.round(widthCm).toString();

        const scale = 1.8;
        if (tvVisual) {
            tvVisual.style.width = `${widthCm * scale}px`;
            tvVisual.style.height = `${heightCm * scale}px`;
        }

        if (distanceLine) {
            const gapHeight = results.optimal * 80;
            distanceLine.style.height = `${gapHeight}px`;
        }
    }

    diagonalSlider?.addEventListener("input", update);
    resButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
            resButtons.forEach((b) =>
                b.classList.remove(
                    "bg-blue-600",
                    "text-white",
                    "border-blue-600",
                    "shadow-lg",
                    "shadow-blue-600/20"
                )
            );
            resButtons.forEach((b) =>
                b.classList.add(
                    "bg-white",
                    "dark:bg-zinc-950",
                    "text-slate-600",
                    "dark:text-zinc-400",
                    "border-slate-200",
                    "dark:border-zinc-800"
                )
            );

            btn.classList.remove(
                "bg-white",
                "dark:bg-zinc-950",
                "text-slate-600",
                "dark:text-zinc-400",
                "border-slate-200",
                "dark:border-zinc-800"
            );
            btn.classList.add(
                "bg-blue-600",
                "text-white",
                "border-blue-600",
                "shadow-lg",
                "shadow-blue-600/20"
            );

            currentRes = btn.getAttribute("data-res") || "4k";
            update();
        });
    });

    update();
</script>
