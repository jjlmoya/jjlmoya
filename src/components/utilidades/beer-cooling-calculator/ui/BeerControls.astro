---
import { Icon } from "astro-icon/components";
---

<div class="space-y-12 relative z-20">
    <div class="space-y-6">
        <h3 class="text-xl font-bold flex items-center gap-3 text-slate-900 dark:text-white">
            <span
                class="w-8 h-8 rounded-full bg-slate-900 dark:bg-white text-white dark:text-slate-900 flex items-center justify-center text-sm"
                >1</span
            >
            ¿Qué vas a enfriar?
        </h3>

        <div class="grid grid-cols-2 gap-4">
            <button
                class="selector-card w-full text-left p-6 rounded-2xl border-2 border-slate-200 dark:border-slate-800 hover:border-slate-300 dark:hover:border-slate-700 transition-all group relative overflow-hidden bg-white dark:bg-slate-900"
                data-group="container"
                data-value="can"
            >
                <div class="relative z-10 flex flex-col items-center gap-3">
                    <Icon
                        name="mdi:beer-outline"
                        class="w-10 h-10 text-slate-400 group-hover:text-amber-500 transition-colors icon-el"
                    />
                    <div class="font-bold text-lg text-slate-900 dark:text-white mb-1">Lata</div>
                    <div class="text-xs text-slate-500 font-medium uppercase tracking-wide">
                        Aluminio
                    </div>
                </div>
                <div
                    class="absolute inset-0 bg-amber-50 dark:bg-amber-900/20 opacity-0 transition-opacity bg-el"
                >
                </div>
                <div
                    class="absolute top-4 right-4 text-amber-500 opacity-0 scale-0 transition-all check-el"
                >
                    <Icon name="mdi:check-circle" class="w-6 h-6" />
                </div>
            </button>

            <button
                class="selector-card w-full text-left p-6 rounded-2xl border-2 border-slate-200 dark:border-slate-800 hover:border-slate-300 dark:hover:border-slate-700 transition-all group relative overflow-hidden bg-white dark:bg-slate-900"
                data-group="container"
                data-value="bottle"
            >
                <div class="relative z-10 flex flex-col items-center gap-3">
                    <Icon
                        name="mdi:bottle-soda-classic-outline"
                        class="w-10 h-10 text-slate-400 group-hover:text-emerald-500 transition-colors icon-el"
                    />
                    <div class="font-bold text-lg text-slate-900 dark:text-white mb-1">Botella</div>
                    <div class="text-xs text-slate-500 font-medium uppercase tracking-wide">
                        Vidrio
                    </div>
                </div>
                <div
                    class="absolute inset-0 bg-emerald-50 dark:bg-emerald-900/20 opacity-0 transition-opacity bg-el"
                >
                </div>
                <div
                    class="absolute top-4 right-4 text-emerald-500 opacity-0 scale-0 transition-all check-el"
                >
                    <Icon name="mdi:check-circle" class="w-6 h-6" />
                </div>
            </button>
        </div>
    </div>

    <div class="space-y-6">
        <h3 class="text-xl font-bold flex items-center gap-3 text-slate-900 dark:text-white">
            <span
                class="w-8 h-8 rounded-full bg-slate-900 dark:bg-white text-white dark:text-slate-900 flex items-center justify-center text-sm"
                >2</span
            >
            ¿Dónde la pones?
        </h3>

        <div class="grid grid-cols-2 gap-4">
            <button
                class="selector-card w-full text-left p-6 rounded-2xl border-2 border-slate-200 dark:border-slate-800 hover:border-slate-300 dark:hover:border-slate-700 transition-all group relative overflow-hidden bg-white dark:bg-slate-900"
                data-group="location"
                data-value="fridge"
            >
                <div class="relative z-10 flex flex-col items-center gap-3">
                    <Icon
                        name="mdi:fridge-outline"
                        class="w-10 h-10 text-slate-400 group-hover:text-cyan-500 transition-colors icon-el"
                    />
                    <div class="font-bold text-lg text-slate-900 dark:text-white mb-1">Nevera</div>
                    <div class="text-xs text-slate-500 font-medium uppercase tracking-wide">
                        4°C
                    </div>
                </div>
                <div
                    class="absolute inset-0 bg-cyan-50 dark:bg-cyan-900/20 opacity-0 transition-opacity bg-el"
                >
                </div>
                <div
                    class="absolute top-4 right-4 text-cyan-500 opacity-0 scale-0 transition-all check-el"
                >
                    <Icon name="mdi:check-circle" class="w-6 h-6" />
                </div>
            </button>

            <button
                class="selector-card w-full text-left p-6 rounded-2xl border-2 border-slate-200 dark:border-slate-800 hover:border-slate-300 dark:hover:border-slate-700 transition-all group relative overflow-hidden bg-white dark:bg-slate-900"
                data-group="location"
                data-value="freezer"
            >
                <div class="relative z-10 flex flex-col items-center gap-3">
                    <Icon
                        name="mdi:snowflake"
                        class="w-10 h-10 text-slate-400 group-hover:text-blue-500 transition-colors icon-el"
                    />
                    <div class="font-bold text-lg text-slate-900 dark:text-white mb-1">
                        Congelador
                    </div>
                    <div class="text-xs text-slate-500 font-medium uppercase tracking-wide">
                        -18°C
                    </div>
                </div>
                <div
                    class="absolute inset-0 bg-blue-50 dark:bg-blue-900/20 opacity-0 transition-opacity bg-el"
                >
                </div>
                <div
                    class="absolute top-4 right-4 text-blue-500 opacity-0 scale-0 transition-all check-el"
                >
                    <Icon name="mdi:check-circle" class="w-6 h-6" />
                </div>
            </button>
        </div>
    </div>

    <div class="space-y-8">
        <h3 class="text-xl font-bold flex items-center gap-3 text-slate-900 dark:text-white">
            <span
                class="w-8 h-8 rounded-full bg-slate-900 dark:bg-white text-white dark:text-slate-900 flex items-center justify-center text-sm"
                >3</span
            >
            Afinar Temperaturas
        </h3>

        <div
            class="p-6 rounded-2xl bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-800 space-y-4"
        >
            <div class="flex justify-between items-center">
                <label class="text-sm font-bold text-slate-500 uppercase tracking-widest"
                    >Temperatura Inicial</label
                >
                <span
                    id="display-temp-start"
                    class="text-lg font-mono font-bold text-slate-900 dark:text-white bg-slate-100 dark:bg-slate-800 px-3 py-1 rounded-lg"
                    >20°C</span
                >
            </div>
            <input
                type="range"
                id="temp-start"
                min="15"
                max="35"
                value="20"
                class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-900 dark:accent-white transition-all slider-custom"
            />
            <div
                class="flex justify-between text-[10px] text-slate-400 font-bold uppercase tracking-wider"
            >
                <span>Fresca (15°)</span>
                <span>Ambiente (20°)</span>
                <span>Verano (35°)</span>
            </div>
        </div>

        <div
            class="p-6 rounded-2xl bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-800 space-y-4"
        >
            <div class="flex justify-between items-center">
                <label class="text-sm font-bold text-slate-500 uppercase tracking-widest"
                    >Meta Fría</label
                >
                <span
                    id="display-temp-target"
                    class="text-lg font-mono font-bold text-slate-900 dark:text-white bg-slate-100 dark:bg-slate-800 px-3 py-1 rounded-lg"
                    >4°C</span
                >
            </div>
            <input
                type="range"
                id="temp-target"
                min="1"
                max="8"
                value="4"
                step="0.5"
                class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500 hover:accent-blue-400 transition-all slider-custom"
            />
            <div
                class="flex justify-between text-[10px] text-slate-400 font-bold uppercase tracking-wider"
            >
                <span>Glacial (1°)</span>
                <span>Perfecta (4°)</span>
                <span>Bodega (8°)</span>
            </div>
        </div>
    </div>
</div>

<style>
    .selector-card.selected {
        border-color: currentColor;
        box-shadow:
            0 4px 6px -1px rgba(0, 0, 0, 0.1),
            0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    /* Specific Colors for Selected States */
    button[data-value="can"].selected {
        border-color: #f59e0b;
    }
    button[data-value="bottle"].selected {
        border-color: #10b981;
    }
    button[data-value="fridge"].selected {
        border-color: #06b6d4;
    }
    button[data-value="freezer"].selected {
        border-color: #3b82f6;
    }

    .selector-card.selected .check-el {
        opacity: 1 !important;
        transform: scale(1) !important;
    }
    .selector-card.selected .bg-el {
        opacity: 1 !important;
    }
    .selector-card.selected .icon-el {
        color: inherit;
    }

    .slider-custom::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: currentColor;
        cursor: pointer;
        margin-top: -6px;
    }
    .slider-custom::-webkit-slider-runnable-track {
        width: 100%;
        height: 8px;
        cursor: pointer;
        background: transparent;
        border-radius: 4px;
    }
</style>

<script>
    import type { CoolingState, ContainerType, LocationType } from "../logic/cooling";

    const state: CoolingState = {
        container: null,
        location: null,
        tempStart: 20,
        tempTarget: 4,
    };

    function emitChange() {
        const event = new CustomEvent("beer-calculator-change", { detail: { ...state } });
        document.dispatchEvent(event);
    }

    function selectOption(btn: HTMLButtonElement) {
        const group = btn.dataset.group;
        const value = btn.dataset.value;

        if (!group || !value) return;

        if (group === "container") {
            state.container = value as ContainerType;
        } else if (group === "location") {
            state.location = value as LocationType;
        } else {
            return;
        }

        document.querySelectorAll(`button[data-group="${group}"]`).forEach((b) => {
            const icon = b.querySelector(".icon-el");
            if (b === btn) {
                b.classList.add("selected");

                const colors: Record<string, string> = {
                    can: "text-amber-500",
                    bottle: "text-emerald-500",
                    fridge: "text-cyan-500",
                    freezer: "text-blue-500",
                };
                if (colors[value] && icon) {
                    icon.classList.remove("text-slate-400");
                    icon.classList.add(colors[value]);
                }
            } else {
                b.classList.remove("selected");
                if (icon) {
                    icon.classList.add("text-slate-400");
                    icon.classList.remove(
                        "text-amber-500",
                        "text-emerald-500",
                        "text-cyan-500",
                        "text-blue-500"
                    );
                }
            }
        });

        emitChange();
    }

    document.querySelectorAll(".selector-card").forEach((btn) => {
        btn.addEventListener("click", () => selectOption(btn as HTMLButtonElement));
    });

    const inputStart = document.getElementById("temp-start");
    const displayStart = document.getElementById("display-temp-start");
    if (inputStart && displayStart) {
        inputStart.addEventListener("input", (e) => {
            state.tempStart = parseFloat((e.target as HTMLInputElement).value);
            displayStart.innerText = `${state.tempStart}°C`;
            emitChange();
        });
    }

    const inputTarget = document.getElementById("temp-target");
    const displayTarget = document.getElementById("display-temp-target");
    if (inputTarget && displayTarget) {
        inputTarget.addEventListener("input", (e) => {
            state.tempTarget = parseFloat((e.target as HTMLInputElement).value);
            displayTarget.innerText = `${state.tempTarget}°C`;
            emitChange();
        });
    }
</script>
