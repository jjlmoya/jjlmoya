---
import { Icon } from "astro-icon/components";
// Import BracketDesktop later when ready

// Initial State (Server Side)
// Starts empty, client-side handles the interactive setup.
---

<div class="tournament-container">
    <div
        id="active-controls"
        class="hidden flex justify-between items-center mb-6 px-2 md:px-4 gap-4"
    >
        <div class="flex-grow">
            <h2 id="tournament-title-display" class="text-xl font-bold text-slate-700">
                Torneo en Curso
            </h2>
            <span id="tournament-date-display" class="text-xs text-slate-400"></span>
        </div>

        <button
            id="next-match-btn"
            class="hidden md:flex bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold px-4 py-2 rounded-lg shadow-md shadow-indigo-200 transition-all items-center gap-2 active:scale-95"
            title="Ir al siguiente partido"
        >
            <span>Siguiente Partido</span>
            <Icon name="mdi:arrow-right-circle" class="text-lg" />
        </button>

        <button
            id="share-tournament-btn"
            class="bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-bold px-3 md:px-4 py-2 rounded-lg shadow-md shadow-emerald-200 transition-all flex items-center gap-2 active:scale-95"
            title="Compartir torneo"
        >
            <Icon name="mdi:share-variant" class="text-lg" />
            <span class="hidden md:inline">Compartir</span>
        </button>

        <button
            id="reset-btn"
            class="text-slate-500 hover:text-indigo-600 text-sm font-bold flex items-center gap-1 bg-white px-3 py-1.5 rounded-lg border border-slate-200 shadow-sm transition-all whitespace-nowrap"
        >
            <Icon name="mdi:arrow-left" class="text-lg" />
            <span class="hidden sm:inline">Volver / Nuevo</span>
            <span class="sm:hidden">Volver</span>
        </button>
    </div>

    <!-- SETUP VIEW -->
    <div
        id="setup-view"
        class="flex flex-col items-center justify-center flex-grow transition-opacity duration-500 gap-8"
    >
        <div class="grid md:grid-cols-2 gap-8 w-full max-w-4xl items-start">
            <!-- LEFT: NEW TOURNAMENT -->
            <div
                class="bg-white p-8 rounded-3xl shadow-xl shadow-indigo-100 w-full border border-indigo-50"
            >
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-black text-slate-800 mb-2">Nuevo Torneo</h2>
                    <p class="text-slate-500 text-sm">
                        Configura y genera tu cuadro de competición.
                    </p>
                </div>

                <!-- Tournament Name -->
                <div class="mb-6">
                    <label
                        class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 ml-1"
                        >Nombre del Torneo</label
                    >
                    <input
                        type="text"
                        id="tournament-name-input"
                        placeholder="Ej. Torneo de Verano"
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500 transition-all font-medium text-slate-700"
                    />
                </div>

                <!-- Add Player -->
                <div class="mb-6">
                    <label
                        class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 ml-1"
                        >Añadir Participantes</label
                    >
                    <div class="flex gap-2">
                        <input
                            type="text"
                            id="new-player-input"
                            placeholder="Nombre... o varios separados por comas"
                            class="flex-grow bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                        />
                        <button
                            id="add-player-btn"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-3 rounded-xl font-bold transition-transform active:scale-95 flex items-center justify-center"
                            title="Añadir Jugador"
                            aria-label="Añadir Jugador"
                        >
                            <Icon name="mdi:plus" class="text-3xl" />
                        </button>
                    </div>
                </div>

                <!-- Player List -->
                <div class="mb-4">
                    <h3
                        class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 flex justify-between"
                    >
                        <span>Jugadores (<span id="player-count">0</span>)</span>
                        <button
                            id="clear-players-btn"
                            class="text-red-400 hover:text-red-500 text-[10px] hidden"
                            >Borrar Todo</button
                        >
                    </h3>
                    <ul
                        id="player-list"
                        class="flex flex-col gap-2 max-h-[200px] overflow-y-auto no-scrollbar pr-1"
                    >
                        <li
                            class="text-center text-slate-400 italic text-sm py-4 border-2 border-dashed border-slate-100 rounded-xl"
                        >
                            La lista está vacía
                        </li>
                    </ul>
                </div>

                <!-- Shuffle Container (Injected by Renderer) -->
                <div id="shuffle-wrapper" class="mb-4"></div>

                <button
                    id="generate-btn"
                    class="w-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-700 hover:to-violet-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-indigo-500/30 transition-all hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    disabled
                >
                    <Icon name="mdi:tournament" class="text-xl" />
                    Generar Cuadro
                </button>
            </div>

            <!-- RIGHT: HISTORY / LOAD -->
            <div class="flex flex-col gap-6">
                <!-- INFO CARD -->
                <div
                    class="bg-indigo-900 text-white p-6 rounded-3xl shadow-lg relative overflow-hidden"
                >
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-indigo-50 rounded-full mix-blend-overlay filter blur-3xl opacity-50 -translate-y-1/2 translate-x-1/3"
                    >
                    </div>
                    <h3 class="font-bold text-lg mb-2 relative z-10">¿Cómo funciona?</h3>
                    <p class="text-indigo-200 text-sm leading-relaxed relative z-10">
                        Añade participantes, ponle nombre y genera. El sistema creará
                        automáticamente los cruces y gestionará los "Byes" (pases directos) si son
                        impares.
                    </p>
                </div>

                <!-- HISTORY LIST -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex-grow">
                    <h3
                        class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2"
                    >
                        <Icon name="mdi:history" /> Historial
                    </h3>
                    <div
                        id="history-container"
                        class="flex flex-col gap-3 max-h-[300px] overflow-y-auto pr-1"
                    >
                        <!-- History Items Injected Here -->
                        <div class="text-center text-slate-400 text-sm py-8 italic">
                            No hay torneos guardados
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- BRACKET VIEW (Hidden by default) -->
    <div id="bracket-view" class="hidden flex-col flex-grow animate-fade-in h-full relative">
        <!-- Mobile View (< 768px) -->
        <div class="md:hidden">
            <div class="bracket-mobile"></div>
        </div>

        <!-- Desktop View (>= 768px) -->
        <div
            class="hidden md:block flex-grow min-h-[600px] max-h-[80vh] bg-white rounded-3xl border border-slate-100 shadow-sm desktop-bracket-container relative overflow-auto cursor-grab active:cursor-grabbing"
        >
            <div
                class="absolute -top-20 -right-20 w-64 h-64 bg-indigo-50 rounded-full mix-blend-multiply filter blur-3xl opacity-50 pointer-events-none"
            >
            </div>
            <div
                class="absolute -bottom-20 -left-20 w-64 h-64 bg-emerald-50 rounded-full mix-blend-multiply filter blur-3xl opacity-50 pointer-events-none"
            >
            </div>
        </div>

        <!-- Hint for desktop -->
        <div
            class="hidden md:flex absolute bottom-4 right-8 bg-white/80 backdrop-blur px-3 py-1 rounded-full text-xs text-slate-400 border border-slate-100 shadow-sm pointer-events-none"
        >
            <Icon name="mdi:hand-back-right" class="mr-1" /> Arrastra para mover
        </div>
    </div>
</div>

<script>
    import { TournamentController } from "./tournament.controller";

    // Initialize logic when DOM is ready
    document.addEventListener("DOMContentLoaded", () => {
        new TournamentController();
    });
</script>
