---
import { Icon } from "astro-icon/components";
---

<div class="max-w-4xl mx-auto px-2 py-6 md:px-4 md:py-12">
    <div
        class="bg-white dark:bg-zinc-950 rounded-[3rem] shadow-2xl border border-slate-100 dark:border-zinc-800 overflow-hidden"
    >
        <div class="grid grid-cols-1 lg:grid-cols-12">
            <div class="lg:col-span-7 p-10 md:p-16 space-y-12 bg-white dark:bg-zinc-950">
                <div class="space-y-2">
                    <h2 class="text-3xl font-black text-slate-900 dark:text-white tracking-tight">
                        Cálculo de Rocío
                    </h2>
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">
                        Parámetros Ambientales
                    </p>
                </div>

                <div class="space-y-12">
                    <div class="space-y-6 group">
                        <div class="flex justify-between items-baseline">
                            <label
                                for="temperature"
                                class="text-[10px] font-black text-purple-600 dark:text-purple-400 uppercase tracking-[0.2em] flex items-center gap-2"
                            >
                                <Icon name="mdi:thermometer" class="w-4 h-4" />
                                Temperatura
                            </label>
                            <span
                                class="text-2xl font-black text-slate-900 dark:text-white tabular-nums"
                                id="tempValue">22°C</span
                            >
                        </div>
                        <input
                            type="range"
                            id="temperature"
                            min="0"
                            max="50"
                            step="0.5"
                            value="22"
                            class="w-full h-2 bg-slate-100 dark:bg-zinc-800 rounded-full appearance-none cursor-pointer accent-purple-500"
                        />
                        <div class="flex gap-2 justify-end">
                            <button
                                class="w-10 h-10 flex items-center justify-center bg-slate-50 dark:bg-zinc-900 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-xl transition-all border border-slate-100 dark:border-zinc-800 text-slate-400 hover:text-purple-600"
                                onclick="document.getElementById('temperature').stepDown(); document.getElementById('temperature').dispatchEvent(new Event('input'))"
                            >
                                <Icon name="mdi:minus" class="w-5 h-5" />
                            </button>
                            <button
                                class="w-10 h-10 flex items-center justify-center bg-slate-50 dark:bg-zinc-900 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-xl transition-all border border-slate-100 dark:border-zinc-800 text-slate-400 hover:text-purple-600"
                                onclick="document.getElementById('temperature').stepUp(); document.getElementById('temperature').dispatchEvent(new Event('input'))"
                            >
                                <Icon name="mdi:plus" class="w-5 h-5" />
                            </button>
                        </div>
                    </div>

                    <div class="space-y-6 group">
                        <div class="flex justify-between items-baseline">
                            <label
                                for="humidity"
                                class="text-[10px] font-black text-blue-600 dark:text-blue-400 uppercase tracking-[0.2em] flex items-center gap-2"
                            >
                                <Icon name="mdi:water-percent" class="w-4 h-4" />
                                Humedad
                            </label>
                            <span
                                class="text-2xl font-black text-slate-900 dark:text-white tabular-nums"
                                id="humValue">55%</span
                            >
                        </div>
                        <input
                            type="range"
                            id="humidity"
                            min="10"
                            max="95"
                            step="1"
                            value="55"
                            class="w-full h-2 bg-slate-100 dark:bg-zinc-800 rounded-full appearance-none cursor-pointer accent-blue-500"
                        />
                        <div class="flex gap-2 justify-end">
                            <button
                                class="w-10 h-10 flex items-center justify-center bg-slate-50 dark:bg-zinc-900 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-xl transition-all border border-slate-100 dark:border-zinc-800 text-slate-400 hover:text-blue-600"
                                onclick="document.getElementById('humidity').stepDown(); document.getElementById('humidity').dispatchEvent(new Event('input'))"
                            >
                                <Icon name="mdi:minus" class="w-5 h-5" />
                            </button>
                            <button
                                class="w-10 h-10 flex items-center justify-center bg-slate-50 dark:bg-zinc-900 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-xl transition-all border border-slate-100 dark:border-zinc-800 text-slate-400 hover:text-blue-600"
                                onclick="document.getElementById('humidity').stepUp(); document.getElementById('humidity').dispatchEvent(new Event('input'))"
                            >
                                <Icon name="mdi:plus" class="w-5 h-5" />
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div
                id="resultCard"
                class="lg:col-span-5 p-10 md:p-16 flex flex-col justify-center items-center text-center space-y-8 bg-slate-50 dark:bg-zinc-900/30 border-l border-slate-100 dark:border-zinc-900 transition-all duration-700"
            >
                <div class="space-y-1">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">
                        Punto de Rocío
                    </p>
                    <p
                        id="dewPointValue"
                        class="text-8xl font-black text-slate-900 dark:text-white tabular-nums tracking-tighter"
                    >
                        --
                    </p>
                    <p class="text-2xl font-black text-slate-300 dark:text-zinc-700">°C</p>
                </div>

                <div class="space-y-6">
                    <div
                        id="riskBadge"
                        class="inline-block px-8 py-2.5 rounded-full text-xs font-black uppercase tracking-widest border transition-all duration-300 shadow-sm"
                    >
                        Calculando...
                    </div>

                    <p
                        id="riskDescription"
                        class="text-sm font-medium text-slate-500 dark:text-zinc-400 leading-relaxed max-w-[240px]"
                    >
                        Estamos analizando los datos para darte la precisión que necesitas.
                    </p>
                </div>

                <div class="pt-8 border-t border-slate-200 dark:border-zinc-800 w-full">
                    <p
                        class="text-[9px] font-bold text-slate-400 uppercase leading-loose tracking-widest"
                    >
                        Evita el moho <br /> controlando la condensación
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    #temperature::-webkit-slider-thumb {
        border: 4px solid white;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }
    #humidity::-webkit-slider-thumb {
        border: 4px solid white;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }
</style>

<script>
    import { DewPointCalculator } from "../../../lib/utilidades/dew-point-calculator/DewPoint";

    const tempInput = document.getElementById("temperature") as HTMLInputElement;
    const humInput = document.getElementById("humidity") as HTMLInputElement;
    const tempValue = document.getElementById("tempValue");
    const humValue = document.getElementById("humValue");
    const dewPointDisplay = document.getElementById("dewPointValue");
    const riskBadge = document.getElementById("riskBadge");
    const riskDescription = document.getElementById("riskDescription");
    const resultCard = document.getElementById("resultCard");

    function update() {
        const t = parseFloat(tempInput.value);
        const h = parseFloat(humInput.value);

        if (tempValue) tempValue.textContent = `${t}°C`;
        if (humValue) humValue.textContent = `${h}%`;

        const dp = DewPointCalculator.calculate(t, h);
        const risk = DewPointCalculator.getMoldRisk(t, dp);

        if (dewPointDisplay) dewPointDisplay.textContent = `${dp}°C`;

        const config = {
            low: {
                bg: "bg-emerald-500/10 dark:bg-emerald-500/20",
                text: "text-emerald-700 dark:text-emerald-400",
                label: "Riesgo Bajo",
                border: "border-emerald-500/20",
                desc: "Tus paredes están a salvo. El aire está seco y saludable.",
            },
            medium: {
                bg: "bg-amber-500/10 dark:bg-amber-500/20",
                text: "text-amber-700 dark:text-amber-400",
                label: "Riesgo Moderado",
                border: "border-amber-500/20",
                desc: "Vigila las esquinas y ventanas al amanecer.",
            },
            high: {
                bg: "bg-orange-500/10 dark:bg-orange-500/20",
                text: "text-orange-700 dark:text-orange-400",
                label: "Riesgo Alto",
                border: "border-orange-500/20",
                desc: "Condensación inminente. Ventila la habitación ahora.",
            },
            extreme: {
                bg: "bg-red-500/10 dark:bg-red-500/20",
                text: "text-red-700 dark:text-red-400",
                label: "Peligro Extremo",
                border: "border-red-500/20",
                desc: "Condensación activa. Riesgo de moho negro estructural.",
            },
        };

        const style = config[risk];

        if (riskBadge) {
            riskBadge.className = `px-6 py-2 rounded-full text-xs font-bold uppercase tracking-tighter border transition-all duration-300 ${style.bg} ${style.text} ${style.border}`;
            riskBadge.textContent = style.label;
        }

        if (riskDescription) {
            riskDescription.textContent = style.desc;
        }

        if (resultCard) {
            resultCard.classList.forEach((c) => {
                if (
                    c.startsWith("border-emerald-") ||
                    c.startsWith("border-amber-") ||
                    c.startsWith("border-orange-") ||
                    c.startsWith("border-red-")
                ) {
                    resultCard.classList.remove(c);
                }
            });
            const colorName = style.text.split("-")[1];
            resultCard.classList.add(`border-${colorName}-500/20`);
        }
    }

    tempInput?.addEventListener("input", update);
    humInput?.addEventListener("input", update);

    update();
</script>
