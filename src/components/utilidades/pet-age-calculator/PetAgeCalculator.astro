---
import { Icon } from "astro-icon/components";
---

<div class="w-full max-w-4xl mx-auto space-y-8">
    <div
        class="bg-white dark:bg-slate-900 rounded-[3rem] p-8 md:p-12 shadow-2xl border-4 border-amber-100 dark:border-slate-800 relative overflow-hidden"
    >
        <div
            class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 bg-amber-50 dark:bg-amber-900/10 rounded-full blur-3xl opacity-50 pointer-events-none"
        >
        </div>
        <div
            class="absolute bottom-0 left-0 -ml-16 -mb-16 w-64 h-64 bg-rose-50 dark:bg-rose-900/10 rounded-full blur-3xl opacity-50 pointer-events-none"
        >
        </div>

        <div class="relative z-10">
            
            <div class="text-center mb-10">
                <h2 class="text-3xl font-black text-slate-800 dark:text-white mb-2 font-display">
                    Calculadora de Edad Peluda
                </h2>
                <p class="text-slate-500 dark:text-slate-400 font-medium">
                    Descubre la etapa vital de tu mejor amigo
                </p>
            </div>

            
            <div class="mb-8 max-w-lg mx-auto">
                <label for="pet-name" class="sr-only">Nombre de tu mascota</label>
                <div class="relative">
                    <input
                        type="text"
                        id="pet-name"
                        placeholder="Nombre de tu mascota (Opcional)"
                        class="w-full text-center bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 rounded-2xl py-3 px-4 text-lg font-bold text-slate-700 dark:text-slate-200 placeholder-slate-400 focus:outline-none focus:border-rose-400 focus:ring-2 focus:ring-rose-200 transition-all shadow-sm"
                    />
                    <div
                        class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"
                    >
                        <Icon name="mdi:pencil" class="w-5 h-5 opacity-50" />
                    </div>
                </div>
            </div>

            
            <div class="grid grid-cols-2 gap-6 mb-10 max-w-lg mx-auto">
                <button
                    class="pet-type-btn active group relative flex flex-col items-center justify-center p-6 rounded-3xl border-2 transition-all duration-300 gap-4"
                    data-type="dog"
                >
                    <div
                        class="icon-container w-20 h-20 bg-blue-100 dark:bg-blue-900/40 text-blue-500 rounded-full flex items-center justify-center text-4xl group-hover:scale-110 transition-transform duration-300"
                    >
                        <Icon name="mdi:dog-side" class="w-10 h-10" />
                    </div>
                    <span
                        class="font-bold text-lg text-slate-700 dark:text-slate-200 group-hover:text-blue-500 transition-colors"
                        >Perro</span
                    >
                    <div
                        class="absolute inset-0 border-2 border-blue-500/0 rounded-3xl transition-all duration-300 group-hover:border-blue-200"
                    >
                    </div>
                </button>

                <button
                    class="pet-type-btn group relative flex flex-col items-center justify-center p-6 rounded-3xl border-2 transition-all duration-300 gap-4"
                    data-type="cat"
                >
                    <div
                        class="icon-container w-20 h-20 bg-orange-100 dark:bg-orange-900/40 text-orange-500 rounded-full flex items-center justify-center text-4xl group-hover:scale-110 transition-transform duration-300"
                    >
                        <Icon name="mdi:cat" class="w-10 h-10" />
                    </div>
                    <span
                        class="font-bold text-lg text-slate-700 dark:text-slate-200 group-hover:text-orange-500 transition-colors"
                        >Gato</span
                    >
                    <div
                        class="absolute inset-0 border-2 border-orange-500/0 rounded-3xl transition-all duration-300 group-hover:border-orange-200"
                    >
                    </div>
                </button>
            </div>

            
            <div id="dog-size-selector" class="mb-12 animate-fade-in">
                <label
                    class="flex justify-center items-center gap-2 text-sm font-black text-slate-400 uppercase tracking-widest mb-6"
                >
                    <Icon name="mdi:ruler" class="text-lg w-5 h-5" />
                    Tamaño del Perrete
                </label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button
                        class="size-btn active p-4 rounded-2xl border-2 flex flex-col items-center gap-3 transition-all hover:-translate-y-1"
                        data-size="small"
                    >
                        <Icon name="mdi:dog-side" class="w-6 h-6 opacity-50 icon-target" />
                        <div class="text-center">
                            <span class="block text-sm font-bold text-slate-700 dark:text-white"
                                >Peque</span
                            >
                            <span
                                class="block text-[10px] bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded-full mt-1 text-slate-500 font-bold"
                                >&lt; 9kg</span
                            >
                        </div>
                    </button>
                    <button
                        class="size-btn p-4 rounded-2xl border-2 flex flex-col items-center gap-3 transition-all hover:-translate-y-1"
                        data-size="medium"
                    >
                        <Icon name="mdi:dog-side" class="w-8 h-8 opacity-60 icon-target" />
                        <div class="text-center">
                            <span class="block text-sm font-bold text-slate-700 dark:text-white"
                                >Mediano</span
                            >
                            <span
                                class="block text-[10px] bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded-full mt-1 text-slate-500 font-bold"
                                >10-22kg</span
                            >
                        </div>
                    </button>
                    <button
                        class="size-btn p-4 rounded-2xl border-2 flex flex-col items-center gap-3 transition-all hover:-translate-y-1"
                        data-size="large"
                    >
                        <Icon name="mdi:dog-side" class="w-10 h-10 opacity-70 icon-target" />
                        <div class="text-center">
                            <span class="block text-sm font-bold text-slate-700 dark:text-white"
                                >Grande</span
                            >
                            <span
                                class="block text-[10px] bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded-full mt-1 text-slate-500 font-bold"
                                >23-40kg</span
                            >
                        </div>
                    </button>
                    <button
                        class="size-btn p-4 rounded-2xl border-2 flex flex-col items-center gap-3 transition-all hover:-translate-y-1"
                        data-size="giant"
                    >
                        <Icon name="mdi:dog-side" class="w-12 h-12 opacity-80 icon-target" />
                        <div class="text-center">
                            <span class="block text-sm font-bold text-slate-700 dark:text-white"
                                >Gigante</span
                            >
                            <span
                                class="block text-[10px] bg-slate-100 dark:bg-slate-800 px-2 py-0.5 rounded-full mt-1 text-slate-500 font-bold"
                                >&gt; 41kg</span
                            >
                        </div>
                    </button>
                </div>
            </div>

            
            <div class="mb-12 bg-slate-50 dark:bg-slate-800/50 p-8 rounded-3xl">
                <label
                    class="flex justify-center items-center gap-2 text-sm font-black text-slate-400 uppercase tracking-widest mb-8"
                >
                    <Icon name="mdi:cake-variant" class="text-lg text-pink-500 w-5 h-5" />
                    ¿Cuántos años tiene?
                </label>

                <div class="flex flex-col items-center gap-6">
                    <div class="relative w-full px-4">
                        <input
                            type="range"
                            id="age-slider"
                            min="1"
                            max="20"
                            step="1"
                            value="5"
                            class="w-full h-4 bg-slate-200 rounded-full appearance-none cursor-pointer dark:bg-slate-700 accent-rose-500"
                        />
                        <div
                            class="flex justify-between text-xs font-bold text-slate-400 mt-2 px-1"
                        >
                            <span>1 año</span>
                            <span>10 años</span>
                            <span>20 años</span>
                        </div>
                    </div>

                    <div
                        class="flex items-center gap-3 bg-white dark:bg-slate-800 px-6 py-3 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 transform hover:scale-105 transition-transform cursor-default"
                    >
                        <span
                            id="age-display"
                            class="text-4xl font-black text-slate-800 dark:text-white">5</span
                        >
                        <div class="flex flex-col leading-none">
                            <span class="text-xs font-bold text-slate-400 uppercase">Años</span>
                            <span class="text-xs font-bold text-slate-400 uppercase">Reales</span>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="perspective-1000">
                <div
                    id="result-card"
                    class="relative bg-gradient-to-br from-rose-400 to-orange-400 rounded-[2.5rem] p-8 md:p-10 text-white shadow-2xl shadow-rose-500/30 overflow-hidden transform transition-all duration-500 hover:rotate-x-2"
                >
                    <div class="absolute top-0 right-0 p-8 opacity-20 transform rotate-12">
                        <Icon name="mdi:paw" class="w-44 h-44" />
                    </div>
                    <div class="absolute bottom-0 left-0 p-4 opacity-10">
                        <Icon name="mdi:heart" class="w-32 h-32" />
                    </div>

                    <div
                        class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-8"
                    >
                        <div class="text-center md:text-left flex-1">
                            <p
                                class="text-rose-100 font-bold text-lg mb-1 flex items-center justify-center md:justify-start gap-2"
                            >
                                <Icon name="mdi:magic-staff" class="w-5 h-5" />
                                Edad Humana Mágica <span id="result-pet-name" class="hidden"
                                    >de <span class="name-val"></span></span
                                >
                            </p>
                            <div class="flex items-baseline justify-center md:justify-start gap-3">
                                <span
                                    id="human-age"
                                    class="text-8xl font-black tracking-tighter drop-shadow-lg"
                                    >36</span
                                >
                                <span class="text-3xl font-bold opacity-90">años</span>
                            </div>
                            <div
                                class="mt-4 inline-flex items-center gap-2 bg-white/20 backdrop-blur-md px-4 py-2 rounded-full border border-white/20"
                            >
                                <Icon name="mdi:stars" class="w-5 h-5" />
                                <span id="life-stage" class="font-bold"
                                    >Adulto en su mejor momento</span
                                >
                            </div>
                        </div>

                        <div
                            class="bg-white/10 backdrop-blur-sm p-6 rounded-2xl border border-white/20 flex-1 w-full md:w-auto"
                        >
                            <div class="flex items-start gap-4">
                                <div
                                    class="bg-white text-rose-500 p-3 rounded-xl flex-shrink-0 shadow-lg"
                                >
                                    <Icon name="mdi:calendar-check" class="w-6 h-6" />
                                </div>
                                <div>
                                    <p
                                        class="text-xs text-rose-100 uppercase tracking-widest font-bold mb-1"
                                    >
                                        Próximo Hito
                                    </p>
                                    <p id="next-milestone" class="font-bold text-lg leading-tight">
                                        Senior (7 años)
                                    </p>
                                    <p
                                        class="text-xs text-rose-100 mt-2 opacity-80 leading-relaxed"
                                    >
                                        ¡No olvides sus chequeos regulares!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="mt-8 flex justify-center">
                <button
                    id="share-btn"
                    class="bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 px-6 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-white dark:hover:bg-slate-700 hover:text-rose-500 dark:hover:text-rose-400 shadow-sm border border-slate-200 dark:border-slate-700 transition-all active:scale-95"
                >
                    <Icon name="mdi:share-variant" class="w-5 h-5" />
                    <span id="share-text">Compartir Resultado</span>
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    @keyframes bounce-sm {
        0%,
        100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-5px);
        }
    }

    .pet-type-btn {
        background-color: #fff;
        border-color: #f1f5f9;
        cursor: pointer;
    }
    :global(.dark) .pet-type-btn {
        background-color: #1e293b;
        border-color: #334155;
    }

    .pet-type-btn.active[data-type="dog"] {
        border-color: #3b82f6;
        background-color: #eff6ff;
        box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.15);
    }
    :global(.dark) .pet-type-btn.active[data-type="dog"] {
        background-color: rgba(30, 58, 138, 0.4);
        border-color: #3b82f6;
    }

    .pet-type-btn.active[data-type="cat"] {
        border-color: #f97316;
        background-color: #fff7ed;
        box-shadow: 0 10px 25px -5px rgba(249, 115, 22, 0.15);
    }
    :global(.dark) .pet-type-btn.active[data-type="cat"] {
        background-color: rgba(124, 45, 18, 0.4);
        border-color: #f97316;
    }

    .pet-type-btn.active .icon-container {
        transform: scale(1.1) rotate(5deg);
        filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
    }

    .size-btn {
        background-color: white;
        border-color: #f1f5f9;
        opacity: 0.6;
        transform: scale(0.95);
        cursor: pointer;
    }
    :global(.dark) .size-btn {
        background-color: #1e293b;
        border-color: #334155;
    }

    .size-btn.active {
        border-color: #f43f5e;
        background-color: #fff1f2;
        opacity: 1;
        transform: scale(1);
        box-shadow: 0 4px 12px rgba(244, 63, 94, 0.15);
    }
    :global(.dark) .size-btn.active {
        background-color: rgba(136, 19, 55, 0.3);
        border-color: #f43f5e;
    }

    .size-btn.active .icon-target {
        color: #f43f5e;
        opacity: 1 !important;
        animation: bounce-sm 2s infinite;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 32px;
        width: 32px;
        border-radius: 50%;
        background: #f43f5e;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="white" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8"/></svg>');
        background-repeat: no-repeat;
        background-position: center;
        cursor: grab;
        margin-top: -12px;
        box-shadow: 0 4px 6px rgba(244, 63, 94, 0.3);
        transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    input[type="range"]::-webkit-slider-thumb:active {
        transform: scale(1.2);
        cursor: grabbing;
    }

    input[type="range"]::-webkit-slider-runnable-track {
        width: 100%;
        height: 8px;
        cursor: pointer;
        background: linear-gradient(90deg, #fecdd3 0%, #f43f5e 100%);
        border-radius: 9999px;
    }
    :global(.dark) input[type="range"]::-webkit-slider-runnable-track {
        background: linear-gradient(90deg, #881337 0%, #e11d48 100%);
    }

    .perspective-1000 {
        perspective: 1000px;
    }
    #result-card {
        transform-style: preserve-3d;
    }
    #result-pet-name:not(.hidden) {
        display: inline;
    }
    .name-val {
        color: #fff;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-decoration: underline;
        text-decoration-color: rgba(255, 255, 255, 0.4);
    }
</style>

<script>
    class PetAgeCalculator {
        
        private petBtns = document.querySelectorAll(".pet-type-btn");
        private sizeBtns = document.querySelectorAll(".size-btn");
        private dogSizeSelector = document.getElementById("dog-size-selector");
        private ageSlider = document.getElementById("age-slider") as HTMLInputElement;
        private ageDisplay = document.getElementById("age-display");
        private humanAgeDisplay = document.getElementById("human-age");
        private lifeStageDisplay = document.getElementById("life-stage");
        private nextMilestoneDisplay = document.getElementById("next-milestone");

        
        private petNameInput = document.getElementById("pet-name") as HTMLInputElement;
        private resultPetNameSpan = document.getElementById("result-pet-name");
        private nameValSpan = document.querySelector(".name-val");
        private shareBtn = document.getElementById("share-btn");
        private shareText = document.getElementById("share-text");

        
        private petType: "dog" | "cat" = "dog";
        private dogSize: "small" | "medium" | "large" | "giant" = "small";
        private age: number = 5;
        private petName: string = "";

        constructor() {
            this.loadFromURL();
            this.initEvents();
            this.update();
        }

        private loadFromURL() {
            const params = new URLSearchParams(window.location.search);

            
            const name = params.get("name");
            if (name) {
                this.petName = name;
                if (this.petNameInput) this.petNameInput.value = name;
            }

            
            const type = params.get("type");
            if (type === "dog" || type === "cat") {
                this.petType = type;
                
                this.petBtns.forEach((b) => {
                    const t = (b as HTMLElement).dataset.type;
                    if (t === type) b.classList.add("active");
                    else b.classList.remove("active");
                });

                
                if (this.dogSizeSelector) {
                    this.dogSizeSelector.style.display = type === "dog" ? "block" : "none";
                }
            }

            
            const size = params.get("size");
            if (size && ["small", "medium", "large", "giant"].includes(size)) {
                this.dogSize = size as any;
                this.sizeBtns.forEach((b) => {
                    const s = (b as HTMLElement).dataset.size;
                    if (s === size) b.classList.add("active");
                    else b.classList.remove("active");
                });
            }

            
            const age = params.get("age");
            if (age) {
                const parsedAge = parseInt(age);
                if (!isNaN(parsedAge) && parsedAge >= 1 && parsedAge <= 20) {
                    this.age = parsedAge;
                    if (this.ageSlider) this.ageSlider.value = parsedAge.toString();
                    if (this.ageDisplay) this.ageDisplay.textContent = parsedAge.toString();
                }
            }
        }

        private initEvents() {
            
            if (this.petNameInput) {
                this.petNameInput.addEventListener("input", (e) => {
                    this.petName = (e.target as HTMLInputElement).value;
                    this.update();
                });
            }

            
            this.petBtns.forEach((btn) => {
                btn.addEventListener("click", (e) => {
                    const target = e.currentTarget as HTMLElement;
                    this.petType = target.dataset.type as "dog" | "cat";

                    this.petBtns.forEach((b) => b.classList.remove("active"));
                    target.classList.add("active");

                    
                    if (this.dogSizeSelector) {
                        if (this.petType === "dog") {
                            this.dogSizeSelector.style.display = "block";
                        } else {
                            this.dogSizeSelector.style.display = "none";
                        }
                    }

                    this.update();
                });
            });

            
            this.sizeBtns.forEach((btn) => {
                btn.addEventListener("click", (e) => {
                    const target = e.currentTarget as HTMLElement;
                    this.dogSize = target.dataset.size as any;

                    this.sizeBtns.forEach((b) => b.classList.remove("active"));
                    target.classList.add("active");

                    this.update();
                });
            });

            
            if (this.ageSlider) {
                this.ageSlider.addEventListener("input", () => {
                    this.age = parseInt(this.ageSlider.value);
                    if (this.ageDisplay) this.ageDisplay.textContent = this.age.toString();
                    this.update();
                });
            }

            
            if (this.shareBtn) {
                this.shareBtn.addEventListener("click", () => {
                    this.shareResult();
                });
            }
        }

        private shareResult() {
            const params = new URLSearchParams();
            if (this.petName) params.set("name", this.petName);
            params.set("type", this.petType);
            if (this.petType === "dog") params.set("size", this.dogSize);
            params.set("age", this.age.toString());

            const newUrl = `${window.location.origin}${window.location.pathname}?${params.toString()}`;

            navigator.clipboard.writeText(newUrl).then(() => {
                if (this.shareText) this.shareText.textContent = "¡Enlace Copiado!";
                if (this.shareBtn) {
                    this.shareBtn.classList.add(
                        "bg-green-100",
                        "text-green-600",
                        "border-green-200"
                    );
                    this.shareBtn.classList.remove("bg-slate-100", "text-slate-600");
                }

                setTimeout(() => {
                    if (this.shareText) this.shareText.textContent = "Compartir Resultado";
                    if (this.shareBtn) {
                        this.shareBtn.classList.remove(
                            "bg-green-100",
                            "text-green-600",
                            "border-green-200"
                        );
                        this.shareBtn.classList.add("bg-slate-100", "text-slate-600");
                    }
                }, 2000);
            });
        }

        private calculateHumanAge(): number {
            if (this.petType === "cat") {
                if (this.age === 1) return 15;
                if (this.age === 2) return 24;
                return 24 + (this.age - 2) * 4;
            } else {
                let humanAge = 0;
                if (this.age === 1) return 15;
                if (this.age === 2) return 24;

                const base = 24;
                const yearsAfterTwo = this.age - 2;

                switch (this.dogSize) {
                    case "small":
                        humanAge = base + yearsAfterTwo * 5;
                        break;
                    case "medium":
                        humanAge = base + yearsAfterTwo * 6;
                        break;
                    case "large":
                        humanAge = base + yearsAfterTwo * 7;
                        break;
                    case "giant":
                        humanAge = base + yearsAfterTwo * 8;
                        break;
                }

                return Math.floor(humanAge);
            }
        }

        private getLifeStage(humanAge: number): string {
            if (humanAge < 15) return "Cachorrito Juguguetón";
            if (humanAge < 24) return "Adolescente Rebelde";
            if (humanAge < 60) return "Adulto en su Mejor Momento";
            if (humanAge < 80) return "Señor(a) Distinguido(a)";
            return "Abuelito(a) Sabio(a)";
        }

        private getNextMilestone(): string {
            const humanAge = this.calculateHumanAge();
            if (humanAge < 15) return "Adolescencia (1 año)";
            if (humanAge < 24) return "Adultez Plena (2 años)";
            if (humanAge < 60) return "Edad Senior (7-9 años)";
            return "Geriatría (Cuidar mucho)";
        }

        private update() {
            const humanAge = this.calculateHumanAge();

            if (this.humanAgeDisplay) {
                
                this.animateValue(
                    this.humanAgeDisplay,
                    parseInt(this.humanAgeDisplay.textContent || "0"),
                    humanAge,
                    400
                );
            }

            if (this.lifeStageDisplay) {
                this.lifeStageDisplay.textContent = this.getLifeStage(humanAge);
            }

            if (this.nextMilestoneDisplay) {
                this.nextMilestoneDisplay.textContent = this.getNextMilestone();
            }

            
            if (this.resultPetNameSpan && this.nameValSpan) {
                if (this.petName.trim() !== "") {
                    this.resultPetNameSpan.classList.remove("hidden");
                    this.nameValSpan.textContent = this.petName;
                } else {
                    this.resultPetNameSpan.classList.add("hidden");
                }
            }
        }

        private animateValue(obj: HTMLElement, start: number, end: number, duration: number) {
            let startTimestamp: number | null = null;
            const step = (timestamp: number) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start).toString();
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }
    }

    
    document.addEventListener("DOMContentLoaded", () => {
        new PetAgeCalculator();
    });

    if (document.readyState === "complete") {
        new PetAgeCalculator();
    }
</script>
```
