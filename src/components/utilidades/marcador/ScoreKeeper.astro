---

---

<div class="w-full max-w-7xl mx-auto select-none p-2 md:p-6" id="scoreboard-app">
    <!-- Configuration Header -->
    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
        <!-- Native Sport Selector -->
        <div class="relative w-full max-w-md">
            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-5 h-5 text-indigo-500"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><circle cx="12" cy="12" r="10"></circle><path
                        d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path
                        d="M2 12h20"></path></svg
                >
            </div>
            <select
                id="sport-select"
                class="w-full appearance-none bg-white dark:bg-slate-800 text-slate-900 dark:text-white font-bold text-lg py-3 pl-10 pr-12 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all cursor-pointer"
            >
                <!-- Options populated by JS -->
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none">
                <svg
                    class="w-5 h-5 text-slate-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    ><path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 9l-7 7-7-7"></path></svg
                >
            </div>
        </div>

        <!-- Global Actions -->
        <div class="flex gap-2">
            <button
                id="btn-swap"
                class="flex items-center gap-2 px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 font-bold text-sm transition-colors"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-4 h-4"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><path d="M7 16V4M7 4L3 8M7 4L11 8"></path><path
                        d="M17 8V20M17 20L21 16M17 20L13 16"></path></svg
                >
                <span class="hidden sm:inline">Cambiar Lado</span>
            </button>
            <button
                id="btn-reset"
                class="px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-lg hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 font-bold text-sm transition-colors"
                title="Reiniciar"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="w-5 h-5"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path></svg
                >
            </button>
        </div>
    </div>

    <!-- Scoreboard Grid -->
    <div
        class="grid grid-cols-1 md:grid-cols-2 gap-4 h-[calc(100vh-12rem)] min-h-[500px] md:h-[600px]"
    >
        <!-- Widget Team A -->
        <div
            class="score-widget relative flex flex-col bg-blue-500/5 dark:bg-blue-500/10 rounded-[2rem] border-4 border-blue-100 dark:border-blue-900/30 overflow-hidden group"
        >
            <!-- Header (Name & Serve) -->
            <div
                class="relative z-20 flex justify-between items-start p-4 md:p-6 pointer-events-auto"
            >
                <input
                    type="text"
                    value="LOCAL"
                    class="w-2/3 bg-transparent text-xl md:text-2xl font-black tracking-wider text-blue-900/50 dark:text-blue-100/50 uppercase focus:text-blue-600 dark:focus:text-blue-400 focus:outline-none transition-colors"
                />
                <div
                    id="serve-a"
                    class="w-6 h-6 rounded-full bg-yellow-400 opacity-0 shadow-lg border-2 border-white dark:border-slate-900 transition-all duration-300 scale-0"
                >
                </div>
            </div>

            <!-- Main Score Area -->
            <div class="relative flex-1 flex items-center justify-center -mt-8 md:-mt-0">
                <!-- Main Value -->
                <div
                    id="score-a"
                    class="text-[8rem] sm:text-[10rem] md:text-[13rem] font-black text-blue-600 dark:text-blue-500 leading-none tracking-tighter tabular-nums transition-transform duration-100 z-10"
                >
                    0
                </div>

                <!-- Touch Layer (Dynamic based on increments) -->
                <div
                    id="touch-layer-a"
                    class="absolute inset-0 z-20 grid grid-cols-1 gap-2 p-4 pt-24 opacity-0 hover:opacity-10 transition-opacity"
                >
                    <!-- Buttons injected by JS -->
                </div>
            </div>

            <!-- Stats Bar (Sets/Games) -->
            <div
                id="stats-a"
                class="relative z-30 hidden flex justify-center gap-4 mb-2 pointer-events-auto animate-in slide-in-from-bottom-4 fade-in duration-300"
            >
                <div class="flex flex-col items-center">
                    <span
                        class="text-[0.65rem] font-bold text-blue-400 uppercase tracking-widest mb-1"
                        >Sets</span
                    >
                    <div
                        class="flex items-center gap-2 bg-white dark:bg-slate-800 px-2 py-1 rounded-full shadow-sm border border-blue-100 dark:border-blue-900/50"
                    >
                        <button
                            class="w-8 h-8 flex items-center justify-center text-blue-600 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full"
                            onclick="window.game.adjSet('A', -1)">-</button
                        >
                        <span id="sets-a" class="text-lg font-bold w-4 text-center">0</span>
                        <button
                            class="w-8 h-8 flex items-center justify-center text-blue-600 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full"
                            onclick="window.game.adjSet('A', 1)">+</button
                        >
                    </div>
                </div>
                <div class="flex flex-col items-center">
                    <span
                        class="text-[0.65rem] font-bold text-blue-400 uppercase tracking-widest mb-1"
                        >Juegos</span
                    >
                    <div
                        class="flex items-center gap-2 bg-white dark:bg-slate-800 px-2 py-1 rounded-full shadow-sm border border-blue-100 dark:border-blue-900/50"
                    >
                        <button
                            class="w-8 h-8 flex items-center justify-center text-blue-600 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full"
                            onclick="window.game.adjGame('A', -1)">-</button
                        >
                        <span id="games-a" class="text-lg font-bold w-4 text-center">0</span>
                        <button
                            class="w-8 h-8 flex items-center justify-center text-blue-600 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full"
                            onclick="window.game.adjGame('A', 1)">+</button
                        >
                    </div>
                </div>
            </div>

            <!-- Controls Footer -->
            <div
                class="relative z-30 flex justify-between items-end p-4 md:p-6 pointer-events-auto"
            >
                <button
                    class="w-12 h-12 rounded-2xl bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex flex-col items-center justify-center gap-1 hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors"
                    onclick="window.game.setServe('A')"
                    title="Saque"
                >
                    <div class="w-2 h-2 rounded-full bg-current"></div>
                    <span class="text-[0.5rem] font-bold uppercase">Saque</span>
                </button>

                <!-- Subtract / Correction -->
                <button
                    class="w-16 h-16 rounded-full bg-white dark:bg-slate-800 shadow-xl border-4 border-blue-50 dark:border-blue-900/20 text-blue-500 dark:text-blue-400 text-3xl font-bold flex items-center justify-center active:scale-95 transition-transform"
                    onclick="window.game.adjScore('A', -1)"
                >
                    ‚àí
                </button>
            </div>
        </div>

        <!-- Widget Team B -->
        <div
            class="score-widget relative flex flex-col bg-rose-500/5 dark:bg-rose-500/10 rounded-[2rem] border-4 border-rose-100 dark:border-rose-900/30 overflow-hidden group"
        >
            <!-- Header -->
            <div
                class="relative z-20 flex justify-between items-start p-4 md:p-6 pointer-events-auto"
            >
                <!-- Service Ball (Left for B to mirror A layout visually if wanted, but standard is near numbering. Put Right for B) -->
                <div class="flex-1"></div>
                <!-- Spacer to push input right -->
                <input
                    type="text"
                    value="VISITANTE"
                    class="w-2/3 bg-transparent text-xl md:text-2xl font-black tracking-wider text-rose-900/50 dark:text-rose-100/50 uppercase focus:text-rose-600 dark:focus:text-rose-400 focus:outline-none transition-colors text-right"
                />
                <div
                    id="serve-b"
                    class="absolute left-6 top-6 w-6 h-6 rounded-full bg-yellow-400 opacity-0 shadow-lg border-2 border-white dark:border-slate-900 transition-all duration-300 scale-0"
                >
                </div>
            </div>

            <!-- Main Score Area -->
            <div class="relative flex-1 flex items-center justify-center -mt-8 md:-mt-0">
                <div
                    id="score-b"
                    class="text-[8rem] sm:text-[10rem] md:text-[13rem] font-black text-rose-600 dark:text-rose-500 leading-none tracking-tighter tabular-nums transition-transform duration-100 z-10"
                >
                    0
                </div>
                <!-- Touch Layer -->
                <div
                    id="touch-layer-b"
                    class="absolute inset-0 z-20 grid grid-cols-1 gap-2 p-4 pt-24 opacity-0 hover:opacity-10 transition-opacity"
                >
                </div>
            </div>

            <!-- Stats Bar -->
            <div
                id="stats-b"
                class="relative z-30 hidden flex justify-center gap-4 mb-2 pointer-events-auto animate-in slide-in-from-bottom-4 fade-in duration-300"
            >
                <div class="flex flex-col items-center">
                    <span
                        class="text-[0.65rem] font-bold text-rose-400 uppercase tracking-widest mb-1"
                        >Sets</span
                    >
                    <div
                        class="flex items-center gap-2 bg-white dark:bg-slate-800 px-2 py-1 rounded-full shadow-sm border border-rose-100 dark:border-rose-900/50"
                    >
                        <button
                            class="w-8 h-8 flex items-center justify-center text-rose-600 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full"
                            onclick="window.game.adjSet('B', -1)">-</button
                        >
                        <span id="sets-b" class="text-lg font-bold w-4 text-center">0</span>
                        <button
                            class="w-8 h-8 flex items-center justify-center text-rose-600 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full"
                            onclick="window.game.adjSet('B', 1)">+</button
                        >
                    </div>
                </div>
                <div class="flex flex-col items-center">
                    <span
                        class="text-[0.65rem] font-bold text-rose-400 uppercase tracking-widest mb-1"
                        >Juegos</span
                    >
                    <div
                        class="flex items-center gap-2 bg-white dark:bg-slate-800 px-2 py-1 rounded-full shadow-sm border border-rose-100 dark:border-rose-900/50"
                    >
                        <button
                            class="w-8 h-8 flex items-center justify-center text-rose-600 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full"
                            onclick="window.game.adjGame('B', -1)">-</button
                        >
                        <span id="games-b" class="text-lg font-bold w-4 text-center">0</span>
                        <button
                            class="w-8 h-8 flex items-center justify-center text-rose-600 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full"
                            onclick="window.game.adjGame('B', 1)">+</button
                        >
                    </div>
                </div>
            </div>

            <!-- Controls Footer -->
            <div
                class="relative z-30 flex justify-between items-end p-4 md:p-6 pointer-events-auto"
            >
                <button
                    class="w-16 h-16 rounded-full bg-white dark:bg-slate-800 shadow-xl border-4 border-rose-50 dark:border-rose-900/20 text-rose-500 dark:text-rose-400 text-3xl font-bold flex items-center justify-center active:scale-95 transition-transform"
                    onclick="window.game.adjScore('B', -1)"
                >
                    ‚àí
                </button>
                <button
                    class="w-12 h-12 rounded-2xl bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400 flex flex-col items-center justify-center gap-1 hover:bg-rose-200 dark:hover:bg-rose-900/50 transition-colors"
                    onclick="window.game.setServe('B')"
                    title="Saque"
                >
                    <div class="w-2 h-2 rounded-full bg-current"></div>
                    <span class="text-[0.5rem] font-bold uppercase">Saque</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Winner Modal -->
    <div
        id="winner-modal"
        class="hidden fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-300"
    >
        <div
            class="bg-white dark:bg-slate-900 rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl border-2 border-white/10 transform transition-all scale-100"
        >
            <div class="mb-4 text-6xl animate-bounce">üèÜ</div>
            <h2 class="text-3xl font-black text-slate-900 dark:text-white mb-2">¬°VICTORIA!</h2>
            <p
                id="winner-name"
                class="text-xl font-bold text-indigo-500 mb-8 uppercase tracking-widest break-all"
            >
                LOCAL
            </p>

            <div class="space-y-3">
                <button
                    id="btn-modal-reset"
                    class="w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-indigo-500/30 transition-all active:scale-95"
                >
                    Nueva Partida
                </button>
                <button
                    id="btn-modal-continue"
                    class="w-full py-4 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-xl font-bold transition-all active:scale-95"
                >
                    Continuar Jugando
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    import { SPORTS } from "../../../lib/marcador/sports";
    import type { SportConfig, ScoreType } from "../../../lib/marcador/sports";

    class GameManager {
        currentSport: SportConfig;

        scoreA = 0;
        scoreB = 0;
        setsA = 0;
        setsB = 0;
        gamesA = 0;
        gamesB = 0;

        isTieBreak = false;

        server: "A" | "B" | null = null;
        pointsSinceServeChange = 0;
        hasShownWin = false;

        ui = {
            select: document.getElementById("sport-select") as HTMLSelectElement,
            scoreA: document.getElementById("score-a"),
            scoreB: document.getElementById("score-b"),
            touchLayerA: document.getElementById("touch-layer-a"),
            touchLayerB: document.getElementById("touch-layer-b"),
            statsA: document.getElementById("stats-a"),
            statsB: document.getElementById("stats-b"),
            setsA: document.getElementById("sets-a"),
            setsB: document.getElementById("sets-b"),
            gamesA: document.getElementById("games-a"),
            gamesB: document.getElementById("games-b"),
            serveA: document.getElementById("serve-a"),
            serveB: document.getElementById("serve-b"),
            modal: document.getElementById("winner-modal"),
            winnerName: document.getElementById("winner-name"),
        };

        constructor() {
            this.currentSport = SPORTS.simple;

            Object.values(SPORTS).forEach((sport) => {
                const opt = document.createElement("option");
                opt.value = sport.id;
                opt.text = sport.name;
                this.ui.select.appendChild(opt);
            });

            this.ui.select.addEventListener("change", (e) => {
                const id = (e.target as HTMLSelectElement)
                    .value as import("../../../lib/marcador/sports").SportId;
                this.setSport(id);
            });

            document.getElementById("btn-reset")?.addEventListener("click", () => {
                if (confirm("¬øReiniciar marcador?")) this.reset();
            });
            document.getElementById("btn-swap")?.addEventListener("click", () => this.swap());

            document.getElementById("btn-modal-reset")?.addEventListener("click", () => {
                this.reset();
                this.ui.modal?.classList.add("hidden");
            });
            document.getElementById("btn-modal-continue")?.addEventListener("click", () => {
                this.ui.modal?.classList.add("hidden");
            });

            this.setSport("simple");
            (window as any).game = this;
        }

        setSport(id: string) {
            this.currentSport =
                SPORTS[id as import("../../../lib/marcador/sports").SportId] || SPORTS.simple;
            this.reset();
            this.updateLayout();
        }

        updateLayout() {
            const setupLayer = (layer: HTMLElement | null, team: "A" | "B") => {
                if (!layer) return;
                layer.innerHTML = "";
                const incs = this.currentSport.increments;

                if (incs.length === 1) {
                    const btn = document.createElement("button");
                    btn.className = "w-full h-full cursor-pointer focus:outline-none";
                    btn.ariaLabel = `Sumar ${incs[0]}`;
                    btn.onclick = () => this.addScore(team, incs[0]);
                    layer.appendChild(btn);
                } else {
                    layer.classList.remove("grid-cols-1");

                    // Improved Mobile/Desktop handling
                    // Mobile: Always visible at bottom, clean buttons.
                    // Desktop: Hover to reveal.
                    layer.className =
                        "absolute inset-0 z-20 flex flex-col justify-end p-4 gap-2 opacity-100 md:opacity-0 md:hover:opacity-100 transition-opacity bg-transparent pointer-events-none md:pointer-events-auto";

                    layer.style.gridTemplateRows = "none";

                    incs.forEach((val) => {
                        const btn = document.createElement("button");
                        // Glassy, high contrast buttons
                        // pointer-events-auto needed because parent is pointer-events-none (to let clicks pass through to score if needed in empty space)
                        btn.className = `
                            flex-none h-14 w-full flex items-center justify-center 
                            text-2xl font-black 
                            bg-white/20 dark:bg-slate-900/30 
                            text-slate-900 dark:text-white
                            hover:bg-white/40 dark:hover:bg-slate-800/50
                            rounded-xl shadow-sm border border-white/20 dark:border-white/10
                            transition-all active:scale-95 pointer-events-auto
                        `;
                        btn.innerText = `+${val}`;
                        btn.onclick = (e) => {
                            e.stopPropagation();
                            this.addScore(team, val);
                        };
                        layer.appendChild(btn);
                    });
                }
            };

            setupLayer(this.ui.touchLayerA, "A");
            setupLayer(this.ui.touchLayerB, "B");

            const showStats = this.currentSport.hasSets || this.currentSport.hasGames;
            if (showStats) {
                this.ui.statsA?.classList.remove("hidden");
                this.ui.statsB?.classList.remove("hidden");
            } else {
                this.ui.statsA?.classList.add("hidden");
                this.ui.statsB?.classList.add("hidden");
            }
        }

        checkWinCondition() {
            if (this.hasShownWin) return;
            if (!this.currentSport.maxScore) return;

            const max = this.currentSport.maxScore;
            const winBy = this.currentSport.winBy || 1;

            let winner: "A" | "B" | null = null;

            if (this.scoreA >= max && this.scoreA >= this.scoreB + winBy) winner = "A";
            if (this.scoreB >= max && this.scoreB >= this.scoreA + winBy) winner = "B";

            if (winner) this.triggerWin(winner);
        }

        triggerWin(winner: "A" | "B") {
            this.hasShownWin = true;

            const inputs = document.querySelectorAll('input[type="text"]');
            let name = winner === "A" ? "LOCAL" : "VISITANTE";
            if (inputs.length === 2) {
                const el = inputs[winner === "A" ? 0 : 1] as HTMLInputElement;
                if (el.value.trim()) name = el.value;
            }

            if (this.ui.winnerName) this.ui.winnerName.innerText = name;
            this.ui.modal?.classList.remove("hidden");
        }

        reset() {
            this.scoreA = 0;
            this.scoreB = 0;
            this.setsA = 0;
            this.setsB = 0;
            this.gamesA = 0;
            this.gamesB = 0;
            this.isTieBreak = false;
            this.pointsSinceServeChange = 0;
            this.hasShownWin = false;
            this.ui.modal?.classList.add("hidden");
            this.render();
        }

        addScore(team: "A" | "B", val: number) {
            if (this.currentSport.type === "tennis") {
                this.handleTennisPoint(team);
            } else {
                if (team === "A") this.scoreA += val;
                else this.scoreB += val;

                this.animate(team === "A" ? this.ui.scoreA : this.ui.scoreB);
                this.checkWinCondition();

                if (this.currentSport.serviceRotationPoints && this.server) {
                    this.pointsSinceServeChange++;
                    let limit = this.currentSport.serviceRotationPoints;

                    if (
                        this.currentSport.id === "pingpong" &&
                        this.scoreA >= 10 &&
                        this.scoreB >= 10
                    ) {
                        limit = 1;
                    }

                    if (this.pointsSinceServeChange >= limit) {
                        this.swapServe();
                    }
                }
            }
            this.render();
        }

        handleTennisPoint(winner: "A" | "B") {
            this.animate(winner === "A" ? this.ui.scoreA : this.ui.scoreB);

            if (this.isTieBreak) {
                if (winner === "A") this.scoreA++;
                else this.scoreB++;

                const totalPoints = this.scoreA + this.scoreB;
                if (totalPoints % 2 === 1) {
                    this.swapServe();
                }

                const wScore = winner === "A" ? this.scoreA : this.scoreB;
                const lScore = winner === "A" ? this.scoreB : this.scoreA;

                if (wScore >= 7 && wScore >= lScore + 2) {
                    this.winSet(winner);
                }
            } else {
                const wScore = winner === "A" ? this.scoreA : this.scoreB;
                const lScore = winner === "A" ? this.scoreB : this.scoreA;

                if (wScore === 3 && lScore < 3) {
                    this.winGame(winner);
                } else if (wScore === 3 && lScore === 3) {
                    if (winner === "A") this.scoreA = 4;
                    else this.scoreB = 4;
                } else if (wScore === 4) {
                    this.winGame(winner);
                } else if (lScore === 4) {
                    this.scoreA = 3;
                    this.scoreB = 3;
                } else {
                    if (winner === "A") this.scoreA++;
                    else this.scoreB++;
                }
            }
        }

        winGame(winner: "A" | "B") {
            this.scoreA = 0;
            this.scoreB = 0;

            let gA = this.gamesA;
            let gB = this.gamesB;

            if (winner === "A") gA++;
            else gB++;

            this.swapServe();

            if (gA === 6 && gB <= 4) {
                this.gamesA = gA;
                this.winSet("A");
                return;
            }
            if (gB === 6 && gA <= 4) {
                this.gamesB = gB;
                this.winSet("B");
                return;
            }

            if (gA === 7 && gB === 5) {
                this.gamesA = gA;
                this.winSet("A");
                return;
            }
            if (gB === 7 && gA === 5) {
                this.gamesB = gB;
                this.winSet("B");
                return;
            }

            if (gA === 6 && gB === 6) {
                this.gamesA = 6;
                this.gamesB = 6;
                this.isTieBreak = true;
                this.render();
                return;
            }

            this.gamesA = gA;
            this.gamesB = gB;
        }

        winSet(winner: "A" | "B") {
            if (winner === "A") this.setsA++;
            else this.setsB++;

            this.gamesA = 0;
            this.gamesB = 0;
            this.scoreA = 0;
            this.scoreB = 0;
            this.isTieBreak = false;

            this.swapServe();
        }

        swapServe() {
            if (!this.server) return;
            this.server = this.server === "A" ? "B" : "A";
            this.pointsSinceServeChange = 0;
        }

        adjScore(team: "A" | "B", val: number) {
            if (team === "A") this.scoreA = Math.max(0, this.scoreA + val);
            else this.scoreB = Math.max(0, this.scoreB + val);
            this.render();
        }

        adjSet(team: "A" | "B", val: number) {
            if (team === "A") this.setsA = Math.max(0, this.setsA + val);
            else this.setsB = Math.max(0, this.setsB + val);
            this.render();
        }

        adjGame(team: "A" | "B", val: number) {
            if (team === "A") this.gamesA = Math.max(0, this.gamesA + val);
            else this.gamesB = Math.max(0, this.gamesB + val);
            this.render();
        }

        setServe(team: "A" | "B") {
            this.server = team;
            this.pointsSinceServeChange = 0;
            this.render();
        }

        swap() {
            [this.scoreA, this.scoreB] = [this.scoreB, this.scoreA];
            [this.setsA, this.setsB] = [this.setsB, this.setsA];
            [this.gamesA, this.gamesB] = [this.gamesB, this.gamesA];
            if (this.server) this.server = this.server === "A" ? "B" : "A";

            const inputs = document.querySelectorAll('input[type="text"]');
            if (inputs.length === 2) {
                const i1 = inputs[0] as HTMLInputElement;
                const i2 = inputs[1] as HTMLInputElement;
                const tmp = i1.value;
                i1.value = i2.value;
                i2.value = tmp;
            }
            this.render();
        }

        animate(el: HTMLElement | null) {
            if (!el) return;
            el.classList.add("scale-110");
            setTimeout(() => el.classList.remove("scale-110"), 100);
        }

        getTennisLabel(val: number) {
            if (this.isTieBreak) return val;
            return ["0", "15", "30", "40", "AD"][val] || val;
        }

        render() {
            if (this.currentSport.type === "tennis") {
                if (this.ui.scoreA)
                    this.ui.scoreA.innerText = this.getTennisLabel(this.scoreA).toString();
                if (this.ui.scoreB)
                    this.ui.scoreB.innerText = this.getTennisLabel(this.scoreB).toString();

                if (this.isTieBreak) {
                    this.ui.scoreA?.classList.add("text-orange-500");
                    this.ui.scoreB?.classList.add("text-orange-500");
                } else {
                    this.ui.scoreA?.classList.remove("text-orange-500");
                    this.ui.scoreB?.classList.remove("text-orange-500");
                }
            } else {
                if (this.ui.scoreA) this.ui.scoreA.innerText = this.scoreA.toString();
                if (this.ui.scoreB) this.ui.scoreB.innerText = this.scoreB.toString();
                this.ui.scoreA?.classList.remove("text-orange-500");
                this.ui.scoreB?.classList.remove("text-orange-500");
            }

            if (this.ui.setsA) this.ui.setsA.innerText = this.setsA.toString();
            if (this.ui.setsB) this.ui.setsB.innerText = this.setsB.toString();
            if (this.ui.gamesA) this.ui.gamesA.innerText = this.gamesA.toString();
            if (this.ui.gamesB) this.ui.gamesB.innerText = this.gamesB.toString();

            const showServeA = this.server === "A";
            const showServeB = this.server === "B";

            if (this.ui.serveA) {
                this.ui.serveA.style.opacity = showServeA ? "1" : "0";
                this.ui.serveA.style.transform = showServeA ? "scale(1)" : "scale(0)";
            }
            if (this.ui.serveB) {
                this.ui.serveB.style.opacity = showServeB ? "1" : "0";
                this.ui.serveB.style.transform = showServeB ? "scale(1)" : "scale(0)";
            }
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        new GameManager();
    });
</script>
