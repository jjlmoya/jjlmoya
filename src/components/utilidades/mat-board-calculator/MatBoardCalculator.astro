---
import { Icon } from "astro-icon/components";
---

<div
    class="w-full max-w-6xl mx-auto bg-white border border-gray-200 rounded-3xl shadow-2xl overflow-hidden animate-fade-in-up"
>
    <div class="grid grid-cols-1 lg:grid-cols-12 md:divide-x divide-gray-200">
        <div class="col-span-1 lg:col-span-4 p-8 space-y-8 bg-gray-50/50">
            <div class="space-y-2">
                <h2 class="text-2xl font-bold text-slate-900 flex items-center gap-2">
                    <Icon name="mdi:settings-outline" class="w-6 h-6 text-indigo-600" />
                    Dimensiones
                </h2>
                <p class="text-slate-500 text-sm">Introduce las medidas en centímetros.</p>
            </div>

            <div class="space-y-6">
                <div class="space-y-4">
                    <div class="flex items-center gap-2 text-indigo-700 font-medium">
                        <Icon name="mdi:crop-free" class="w-5 h-5" />
                        <span>Tamaño del Marco</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative group">
                            <label
                                for="frame-width"
                                class="block text-xs text-slate-500 mb-1 ml-1 group-focus-within:text-indigo-600 transition-colors"
                            >
                                Ancho (cm)
                            </label>
                            <input
                                type="number"
                                id="frame-width"
                                value="40"
                                min="0"
                                step="0.1"
                                class="w-full bg-white border border-gray-300 rounded-xl px-4 py-3 text-slate-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-mono text-lg"
                            />
                        </div>
                        <div class="relative group">
                            <label
                                for="frame-height"
                                class="block text-xs text-slate-500 mb-1 ml-1 group-focus-within:text-indigo-600 transition-colors"
                            >
                                Alto (cm)
                            </label>
                            <input
                                type="number"
                                id="frame-height"
                                value="50"
                                min="0"
                                step="0.1"
                                class="w-full bg-white border border-gray-300 rounded-xl px-4 py-3 text-slate-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-mono text-lg"
                            />
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="flex items-center gap-2 text-pink-700 font-medium">
                        <Icon name="mdi:image-outline" class="w-5 h-5" />
                        <span>Tamaño de la Obra</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative group">
                            <label
                                for="art-width"
                                class="block text-xs text-slate-500 mb-1 ml-1 group-focus-within:text-pink-600 transition-colors"
                            >
                                Ancho (cm)
                            </label>
                            <input
                                type="number"
                                id="art-width"
                                value="28"
                                min="0"
                                step="0.1"
                                class="w-full bg-white border border-gray-300 rounded-xl px-4 py-3 text-slate-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pink-500/20 focus:border-pink-500 transition-all font-mono text-lg"
                            />
                        </div>
                        <div class="relative group">
                            <label
                                for="art-height"
                                class="block text-xs text-slate-500 mb-1 ml-1 group-focus-within:text-pink-600 transition-colors"
                            >
                                Alto (cm)
                            </label>
                            <input
                                type="number"
                                id="art-height"
                                value="38"
                                min="0"
                                step="0.1"
                                class="w-full bg-white border border-gray-300 rounded-xl px-4 py-3 text-slate-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pink-500/20 focus:border-pink-500 transition-all font-mono text-lg"
                            />
                        </div>
                    </div>
                </div>

                <div class="pt-4 border-t border-gray-200">
                    <label class="flex items-center justify-between cursor-pointer group">
                        <div class="flex flex-col">
                            <span
                                class="text-slate-900 font-medium group-hover:text-indigo-600 transition-colors"
                                >Bottom Weighting</span
                            >
                            <span class="text-xs text-slate-500"
                                >Aplica más margen inferior para equilibrio visual</span
                            >
                        </div>
                        <div class="relative">
                            <input
                                type="checkbox"
                                id="bottom-weighting"
                                class="sr-only peer"
                                checked
                            />
                            <div
                                class="w-14 h-8 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-indigo-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-7 after:w-7 after:transition-all peer-checked:bg-indigo-600"
                            >
                            </div>
                        </div>
                    </label>
                </div>

                <div
                    id="offset-control"
                    class="pt-2 border-t border-gray-200 transition-all duration-300 overflow-hidden max-h-0 opacity-0"
                >
                    <div class="relative group">
                        <label
                            for="offset-percent"
                            class="block text-xs text-slate-500 mb-1 ml-1 group-focus-within:text-indigo-600 transition-colors"
                        >
                            Desplazamiento (%)
                        </label>
                        <div class="flex items-center gap-4">
                            <input
                                type="range"
                                id="offset-range"
                                min="1"
                                max="20"
                                value="5"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                            />
                            <span id="offset-value" class="font-mono text-slate-700 w-12 text-right"
                                >5%</span
                            >
                        </div>
                    </div>
                </div>
            </div>

            <div
                id="error-msg"
                class="hidden p-4 bg-red-100 border border-red-200 text-red-700 text-sm rounded-xl flex items-start gap-3"
            >
                <Icon name="mdi:alert-circle" class="w-5 h-5 flex-shrink-0 mt-0.5" />
                <span>El tamaño de la obra debe ser menor que el marco.</span>
            </div>
        </div>

        <div
            class="col-span-1 lg:col-span-8 bg-gray-100 p-8 sm:p-12 relative flex flex-col justify-center items-center min-h-[500px]"
        >
            <div
                class="absolute inset-0 pointer-events-none opacity-[0.05]"
                style="background-image: radial-gradient(circle at 1px 1px, black 1px, transparent 0); background-size: 20px 20px;"
            >
            </div>

            <div
                id="frame-container"
                class="relative shadow-2xl transition-all duration-700 ease-[cubic-bezier(0.34,1.56,0.64,1)] bg-white shadow-black/20"
                style="aspect-ratio: 40/50; height: 100%; max-height: 60vh;"
            >
                <div
                    class="absolute inset-0 bg-[#e5e5e5] shadow-inner transition-colors duration-500"
                >
                </div>

                <div
                    id="art-container"
                    class="absolute bg-white shadow-lg overflow-hidden transition-all duration-700 ease-[cubic-bezier(0.34,1.56,0.64,1)] flex items-center justify-center text-center p-4"
                >
                    <div
                        class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/canvas-orange.png')]"
                    >
                    </div>
                    <span
                        class="relative z-10 text-gray-400 font-serif italic text-lg sm:text-2xl select-none"
                        >Tu Obra</span
                    >

                    <div class="absolute inset-0 pointer-events-none">
                        <div
                            class="absolute bottom-2 left-0 right-0 flex items-center justify-between px-2 opacity-50"
                        >
                            <div class="h-3 w-[1px] bg-black"></div>
                            <div class="h-[1px] bg-black flex-1 mx-2 relative">
                                <span
                                    id="visual-art-w"
                                    class="absolute -top-4 left-1/2 -translate-x-1/2 text-[10px] text-black font-mono"
                                    >28cm</span
                                >
                            </div>
                            <div class="h-3 w-[1px] bg-black"></div>
                        </div>

                        <div
                            class="absolute top-0 bottom-0 right-2 flex flex-col items-center justify-between py-2 opacity-50"
                        >
                            <div class="w-3 h-[1px] bg-black"></div>
                            <div class="w-[1px] bg-black flex-1 my-2 relative">
                                <span
                                    id="visual-art-h"
                                    class="absolute -left-4 top-1/2 -translate-y-1/2 -rotate-90 text-[10px] text-black font-mono"
                                    >38cm</span
                                >
                            </div>
                            <div class="w-3 h-[1px] bg-black"></div>
                        </div>
                    </div>
                </div>

                <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-full pb-2">
                    <div class="flex flex-col items-center animate-fade-in text-indigo-500">
                        <span class="text-xs uppercase tracking-widest opacity-70">Superior</span>
                        <span id="border-top-val" class="font-mono text-xl font-bold">6.00</span>
                        <span class="text-[10px] opacity-50">cm</span>
                    </div>
                </div>

                <div class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full pt-2">
                    <div class="flex flex-col items-center animate-fade-in text-indigo-500">
                        <span class="text-[10px] opacity-50">cm</span>
                        <span id="border-bottom-val" class="font-mono text-xl font-bold">6.00</span>
                        <span class="text-xs uppercase tracking-widest opacity-70">Inferior</span>
                    </div>
                </div>

                <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-full pr-4">
                    <div class="flex flex-col items-end animate-fade-in text-pink-500">
                        <span class="text-xs uppercase tracking-widest opacity-70">Izq</span>
                        <span id="border-left-val" class="font-mono text-xl font-bold">6.00</span>
                        <span class="text-[10px] opacity-50">cm</span>
                    </div>
                </div>

                <div class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-full pl-4">
                    <div class="flex flex-col items-start animate-fade-in text-pink-500">
                        <span class="text-xs uppercase tracking-widest opacity-70">Der</span>
                        <span id="border-right-val" class="font-mono text-xl font-bold">6.00</span>
                        <span class="text-[10px] opacity-50">cm</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const inputs = {
        frameW: document.getElementById("frame-width") as HTMLInputElement,
        frameH: document.getElementById("frame-height") as HTMLInputElement,
        artW: document.getElementById("art-width") as HTMLInputElement,
        artH: document.getElementById("art-height") as HTMLInputElement,
        weighted: document.getElementById("bottom-weighting") as HTMLInputElement,
        offsetRange: document.getElementById("offset-range") as HTMLInputElement,
    };

    const visuals = {
        frameContainer: document.getElementById("frame-container") as HTMLElement,
        artContainer: document.getElementById("art-container") as HTMLElement,
        topVal: document.getElementById("border-top-val") as HTMLElement,
        bottomVal: document.getElementById("border-bottom-val") as HTMLElement,
        leftVal: document.getElementById("border-left-val") as HTMLElement,
        rightVal: document.getElementById("border-right-val") as HTMLElement,
        visualArtW: document.getElementById("visual-art-w") as HTMLElement,
        visualArtH: document.getElementById("visual-art-h") as HTMLElement,
        errorMsg: document.getElementById("error-msg") as HTMLElement,
        offsetControl: document.getElementById("offset-control") as HTMLElement,
        offsetValue: document.getElementById("offset-value") as HTMLElement,
    };

    function calculate() {
        const fw = parseFloat(inputs.frameW.value) || 0;
        const fh = parseFloat(inputs.frameH.value) || 0;
        const aw = parseFloat(inputs.artW.value) || 0;
        const ah = parseFloat(inputs.artH.value) || 0;
        const weighted = inputs.weighted.checked;
        const offsetPercent = parseFloat(inputs.offsetRange.value) / 100;

        if (aw >= fw || ah >= fh || fw <= 0 || fh <= 0) {
            visuals.errorMsg.classList.remove("hidden");
            return;
        }
        visuals.errorMsg.classList.add("hidden");

        const totalWDiff = fw - aw;
        const totalHDiff = fh - ah;

        const left = totalWDiff / 2;
        const right = totalWDiff / 2;

        let top, bottom;

        if (weighted) {
            const offset = fh * offsetPercent;

            top = totalHDiff / 2 - offset;
            bottom = totalHDiff / 2 + offset;
        } else {
            top = totalHDiff / 2;
            bottom = totalHDiff / 2;
        }

        visuals.topVal.innerText = top.toFixed(2);
        visuals.bottomVal.innerText = bottom.toFixed(2);
        visuals.leftVal.innerText = left.toFixed(2);
        visuals.rightVal.innerText = right.toFixed(2);

        visuals.frameContainer.style.aspectRatio = `${fw}/${fh}`;

        const artWPercent = (aw / fw) * 100;
        const artHPercent = (ah / fh) * 100;

        visuals.artContainer.style.width = `${artWPercent}%`;
        visuals.artContainer.style.height = `${artHPercent}%`;

        const topPercent = (top / fh) * 100;
        const leftPercent = (left / fw) * 100;

        visuals.artContainer.style.top = `${topPercent}%`;
        visuals.artContainer.style.left = `${leftPercent}%`;

        visuals.visualArtW.innerText = `${aw}cm`;
        visuals.visualArtH.innerText = `${ah}cm`;

        if (weighted) {
            visuals.offsetControl.classList.remove("max-h-0", "opacity-0");
            visuals.offsetControl.classList.add("max-h-20", "opacity-100");
        } else {
            visuals.offsetControl.classList.add("max-h-0", "opacity-0");
            visuals.offsetControl.classList.remove("max-h-20", "opacity-100");
        }
        visuals.offsetValue.innerText = `${inputs.offsetRange.value}%`;
    }

    Object.values(inputs).forEach((input) => {
        input.addEventListener("input", calculate);
        input.addEventListener("change", calculate);
    });

    calculate();
</script>
