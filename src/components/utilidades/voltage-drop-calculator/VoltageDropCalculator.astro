---
import { Icon } from "astro-icon/components";
---

<div class="max-w-3xl mx-auto px-4 py-12">
    
    <div
        class="bg-white dark:bg-slate-900 rounded-3xl shadow-2xl border border-slate-200 dark:border-slate-800 overflow-hidden ring-1 ring-slate-900/5 dark:ring-white/10 relative"
    >
        
        <div class="relative bg-slate-900 text-white p-8 md:p-10 overflow-hidden">
            
            <div
                id="hero-pulse"
                class="absolute top-0 right-0 w-[500px] h-[500px] bg-indigo-500/20 rounded-full blur-[100px] -translate-y-1/2 translate-x-1/2 transition-colors duration-700"
            >
            </div>

            <div class="relative z-10 flex flex-col md:flex-row justify-between items-end gap-6">
                <div>
                    <div class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-2">
                        Caída de Tensión Total
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span
                            id="hero-drop-v"
                            class="text-6xl font-black tracking-tight leading-none">0.45</span
                        >
                        <span class="text-2xl font-medium text-slate-500">Volts</span>
                    </div>
                    <div class="mt-4 flex items-center gap-3">
                        <div
                            id="status-pill"
                            class="px-3 py-1 rounded-full bg-green-500/20 border border-green-500/50 text-green-400 text-xs font-bold uppercase tracking-wide flex items-center gap-2 transition-all"
                        >
                            <span class="w-1.5 h-1.5 rounded-full bg-green-400"></span>
                            <span id="status-text">Excelente</span>
                        </div>
                        <div class="text-sm font-medium text-slate-400">
                            <span id="hero-drop-p" class="text-white">3.75</span>% pérdida
                        </div>
                    </div>
                </div>

                
                <div
                    class="bg-white/5 border border-white/10 rounded-2xl p-4 min-w-[160px] backdrop-blur-sm flex flex-col justify-center"
                >
                    <div class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">
                        Eficiencia
                    </div>
                    <div class="flex items-baseline gap-1 mb-2">
                        <span class="text-3xl font-bold text-white tracking-tight" id="hero-eff"
                            >96.2</span
                        >
                        <span class="text-sm font-medium text-slate-400">%</span>
                    </div>

                    
                    <div class="w-full h-2 bg-slate-700/50 rounded-full overflow-hidden flex">
                        <div
                            id="hero-bar-eff"
                            class="h-full bg-green-400 transition-all duration-500"
                            style="width: 96%"
                        >
                        </div>
                        <div class="h-full bg-red-500/50 flex-1 transition-all duration-500"></div>
                    </div>
                </div>
            </div>
        </div>

        
        <div class="p-6 md:p-8 space-y-8 bg-slate-50 dark:bg-slate-900/50">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <div
                    class="bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700"
                >
                    <label
                        class="block text-xs font-bold text-slate-400 uppercase tracking-wide mb-3"
                        >Voltaje</label
                    >
                    <div class="flex bg-slate-100 dark:bg-slate-900 rounded-xl p-1 relative">
                        
                        <div
                            id="voltage-bg"
                            class="absolute top-1 left-1 w-[32%] h-[calc(100%-8px)] bg-white dark:bg-slate-700 rounded-lg shadow-sm transition-all duration-300"
                        >
                        </div>

                        <button
                            class="volt-btn flex-1 relative z-10 py-2 text-sm font-bold text-slate-700 dark:text-slate-300 transition-colors"
                            data-val="12">12V</button
                        >
                        <button
                            class="volt-btn flex-1 relative z-10 py-2 text-sm font-bold text-slate-500 transition-colors hover:text-slate-700 dark:hover:text-slate-200"
                            data-val="24">24V</button
                        >
                        <button
                            class="volt-btn flex-1 relative z-10 py-2 text-sm font-bold text-slate-500 transition-colors hover:text-slate-700 dark:hover:text-slate-200"
                            data-val="230">230V</button
                        >
                    </div>
                </div>

                
                <div
                    class="bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700"
                >
                    <label
                        class="block text-xs font-bold text-slate-400 uppercase tracking-wide mb-3"
                        >Material</label
                    >
                    <div class="flex gap-4">
                        <label class="flex-1 cursor-pointer">
                            <input
                                type="radio"
                                name="material"
                                value="copper"
                                checked
                                class="peer sr-only"
                            />
                            <div
                                class="h-10 flex items-center justify-center gap-2 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 transition-all peer-checked:border-amber-500 peer-checked:bg-amber-50 dark:peer-checked:bg-amber-900/20 peer-checked:text-amber-700 dark:peer-checked:text-amber-400 group hover:bg-white"
                            >
                                <span class="w-3 h-3 rounded-full bg-amber-600"></span>
                                <span class="text-sm font-bold">Cobre</span>
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input
                                type="radio"
                                name="material"
                                value="aluminum"
                                class="peer sr-only"
                            />
                            <div
                                class="h-10 flex items-center justify-center gap-2 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 transition-all peer-checked:border-slate-500 peer-checked:bg-slate-100 dark:peer-checked:bg-slate-700 peer-checked:text-slate-900 dark:peer-checked:text-white group hover:bg-white"
                            >
                                <span class="w-3 h-3 rounded-full bg-slate-400"></span>
                                <span class="text-sm font-bold">Alum.</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            
            <div class="grid grid-cols-1 gap-6">
                
                <div
                    class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 flex flex-col md:flex-row items-center gap-6"
                >
                    <div
                        class="w-full md:w-auto shrink-0 flex items-center justify-between md:justify-start gap-4 min-w-[180px]"
                    >
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wide"
                            >Carga</label
                        >
                        <div class="flex rounded-lg bg-slate-100 dark:bg-slate-900 p-1">
                            <button
                                class="mode-btn px-3 py-1 rounded-md text-xs font-bold bg-white dark:bg-slate-700 shadow-sm text-slate-900 dark:text-white transition"
                                data-mode="watts">W</button
                            >
                            <button
                                class="mode-btn px-3 py-1 rounded-md text-xs font-bold text-slate-500 hover:text-slate-900 dark:hover:text-white transition"
                                data-mode="amps">A</button
                            >
                        </div>
                    </div>

                    <div class="flex-1 w-full relative group">
                        <div class="flex items-center gap-4">
                            <input
                                type="number"
                                id="load-val"
                                class="w-20 bg-transparent text-2xl font-black text-right border-0 border-b-2 border-slate-200 focus:border-indigo-500 focus:ring-0 p-0 text-slate-900 dark:text-white"
                                value="60"
                            />
                            <span id="load-unit-label" class="text-sm font-bold text-slate-400 mt-2"
                                >Watts</span
                            >
                        </div>
                    </div>
                </div>

                
                <div
                    class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700"
                >
                    <div class="flex justify-between mb-4">
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wide"
                            >Longitud del Cable (Ida)</label
                        >
                        <span class="text-sm font-bold text-indigo-600 dark:text-indigo-400"
                            ><span id="len-display">10</span> metros</span
                        >
                    </div>
                    <div class="relative h-6 flex items-center">
                        <input
                            type="range"
                            id="length-slider"
                            min="1"
                            max="100"
                            step="1"
                            value="10"
                            class="w-full absolute z-20 opacity-0 cursor-pointer h-full"
                        />
                        <div
                            class="w-full h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden"
                        >
                            <div
                                id="len-track"
                                class="h-full bg-indigo-500 w-[10%] transition-all duration-75"
                            >
                            </div>
                        </div>
                        <div
                            id="len-thumb"
                            class="absolute h-6 w-6 bg-white border-2 border-indigo-500 rounded-full shadow-md z-10 pointer-events-none transition-all duration-75 left-[10%] -translate-x-1/2 flex items-center justify-center"
                        >
                            <div class="w-1.5 h-1.5 bg-indigo-500 rounded-full"></div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div
                class="bg-white dark:bg-slate-800 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700"
            >
                <div class="flex justify-between items-center mb-4">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-wide"
                        >Sección (Grosor)</label
                    >
                    <span
                        id="section-info"
                        class="text-xs font-medium text-slate-500 bg-slate-100 dark:bg-slate-900 px-2 py-1 rounded"
                        >Recomendado</span
                    >
                </div>

                <div class="relative group">
                    
                    <div
                        class="absolute left-0 top-0 bottom-0 w-12 bg-gradient-to-r from-white dark:from-slate-800 to-transparent z-20 pointer-events-none rounded-l-2xl"
                    >
                    </div>
                    <div
                        class="absolute right-0 top-0 bottom-0 w-12 bg-gradient-to-l from-white dark:from-slate-800 to-transparent z-20 pointer-events-none rounded-r-2xl"
                    >
                    </div>

                    <div
                        class="flex gap-4 overflow-x-auto py-4 px-12 scrollbar-hide snap-x cursor-grab active:cursor-grabbing"
                        id="gauge-scroll"
                    >
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>

<script is:inline>
    
    const SECTIONS = [
        { val: 0.5, label: "0.5", fill: 6 },
        { val: 0.75, label: "0.75", fill: 8 },
        { val: 1.0, label: "1.0", fill: 10 },
        { val: 1.5, label: "1.5", fill: 12 },
        { val: 2.5, label: "2.5", fill: 16 },
        { val: 4.0, label: "4.0", fill: 20 },
        { val: 6.0, label: "6.0", fill: 24 },
        { val: 10.0, label: "10", fill: 28 },
        { val: 16.0, label: "16", fill: 32 },
        { val: 25.0, label: "25", fill: 36 },
        { val: 35.0, label: "35", fill: 40 },
        { val: 50.0, label: "50", fill: 44 },
    ];

    const state = {
        voltage: 12,
        load: 60,
        isWatts: true,
        length: 10,
        section: 1.5,
        material: "copper",
    };

    
    function init() {
        renderGauges();
        bindEvents();
        update();
    }

    function renderGauges() {
        const container = document.getElementById("gauge-scroll");
        if (!container) return;

        container.innerHTML = SECTIONS.map(
            (s) => `
            <label class="relative flex-shrink-0 cursor-pointer group snap-center">
                <input type="radio" name="section" value="${s.val}" class="peer sr-only" ${s.val === 1.5 ? "checked" : ""}>
                <div class="w-16 h-24 rounded-full bg-slate-50 dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-700 flex flex-col items-center justify-end pb-3 transition-all peer-checked:border-indigo-500 peer-checked:bg-white dark:peer-checked:bg-slate-800 peer-checked:shadow-lg peer-checked:-translate-y-2 group-hover:border-indigo-300">
                    
                    
                    <div class="mb-auto mt-4 w-full flex justify-center items-center h-12">
                         <div class="rounded-full bg-gradient-to-br from-amber-400 to-amber-600 shadow-inner wire-circle transition-colors" 
                              style="width: ${s.fill}px; height: ${s.fill}px"></div>
                    </div>

                    <span class="text-sm font-bold text-slate-500 peer-checked:text-indigo-600">${s.label}</span>
                    <span class="text-[10px] text-slate-400">mm²</span>
                </div>
            </label>
        `
        ).join("");
    }

    function bindEvents() {
        
        const voltBtns = document.querySelectorAll(".volt-btn");
        const voltBg = document.getElementById("voltage-bg");
        voltBtns.forEach((btn, idx) => {
            btn.addEventListener("click", () => {
                state.voltage = parseFloat(btn.dataset.val);
                
                if (voltBg) voltBg.style.left = `${idx * 33.3 + 1}%`;

                
                voltBtns.forEach(
                    (b) =>
                        (b.className =
                            "volt-btn flex-1 relative z-10 py-2 text-sm font-bold text-slate-500 transition-colors hover:text-slate-700 dark:hover:text-slate-200")
                );
                btn.className =
                    "volt-btn flex-1 relative z-10 py-2 text-sm font-bold text-slate-700 dark:text-slate-300 transition-colors";

                update();
            });
        });

        
        const loadInput = document.getElementById("load-val");
        if (loadInput)
            loadInput.addEventListener("input", (e) => {
                state.load = parseFloat(e.target.value) || 0;
                update();
            });

        
        const modeBtns = document.querySelectorAll(".mode-btn");
        modeBtns.forEach((btn) => {
            btn.addEventListener("click", () => {
                state.isWatts = btn.dataset.mode === "watts";
                
                modeBtns.forEach((b) => {
                    if (b.dataset.mode === btn.dataset.mode) {
                        b.className =
                            "mode-btn px-3 py-1 rounded-md text-xs font-bold bg-white dark:bg-slate-700 shadow-sm text-slate-900 dark:text-white transition";
                    } else {
                        b.className =
                            "mode-btn px-3 py-1 rounded-md text-xs font-bold text-slate-500 hover:text-slate-900 dark:hover:text-white transition";
                    }
                });
                document.getElementById("load-unit-label").innerText = state.isWatts
                    ? "Watts"
                    : "Amps";
                update();
            });
        });

        
        const lenSlider = document.getElementById("length-slider");
        if (lenSlider) {
            lenSlider.addEventListener("input", (e) => {
                state.length = parseFloat(e.target.value);

                const percent = ((state.length - 1) / 99) * 100;
                document.getElementById("len-track").style.width = percent + "%";
                document.getElementById("len-thumb").style.left = percent + "%";
                document.getElementById("len-display").innerText = state.length;
                update();
            });
        }

        
        const scrollBox = document.getElementById("gauge-scroll");
        if (scrollBox) {
            scrollBox.addEventListener("change", (e) => {
                if (e.target.name === "section") {
                    state.section = parseFloat(e.target.value);
                    update();
                }
            });
        }

        
        document.querySelectorAll('input[name="material"]').forEach((r) => {
            r.addEventListener("change", (e) => {
                state.material = e.target.value;
                update();
            });
        });
    }

    function update() {
        const { voltage, load, isWatts, length, section, material } = state;
        const current = isWatts && voltage > 0 ? load / voltage : load;
        const rho = material === "aluminum" ? 0.028 : 0.0178;

        const dropV = (2 * length * current * rho) / section;
        const dropP = voltage > 0 ? (dropV / voltage) * 100 : 0;
        const destV = Math.max(0, voltage - dropV);

        
        document.getElementById("hero-drop-v").innerText = dropV.toFixed(2);
        document.getElementById("hero-drop-p").innerText = dropP.toFixed(2);

        
        const keptP = Math.max(0, 100 - dropP);
        const heroEff = document.getElementById("hero-eff");
        const heroBarEff = document.getElementById("hero-bar-eff");

        if (heroEff) heroEff.innerText = keptP.toFixed(1);
        if (heroBarEff) heroBarEff.style.width = keptP + "%";

        
        updateStatus(dropP);
        updateWireVisuals(material);
    }

    function updateStatus(p) {
        const pill = document.getElementById("status-pill");
        const txt = document.getElementById("status-text");
        const pulse = document.getElementById("hero-pulse");

        if (p < 3) {
            pill.className =
                "px-3 py-1 rounded-full bg-green-500/20 border border-green-500/50 text-green-400 text-xs font-bold uppercase tracking-wide flex items-center gap-2";
            pill.querySelector("span").className = "w-1.5 h-1.5 rounded-full bg-green-400";
            txt.innerText = "Excelente";
            pulse.className =
                "absolute top-0 right-0 w-[500px] h-[500px] bg-indigo-500/20 rounded-full blur-[100px] -translate-y-1/2 translate-x-1/2 transition-colors duration-700";
        } else if (p < 5) {
            pill.className =
                "px-3 py-1 rounded-full bg-amber-500/20 border border-amber-500/50 text-amber-400 text-xs font-bold uppercase tracking-wide flex items-center gap-2";
            pill.querySelector("span").className = "w-1.5 h-1.5 rounded-full bg-amber-400";
            txt.innerText = "Aceptable";
            pulse.className =
                "absolute top-0 right-0 w-[500px] h-[500px] bg-amber-500/10 rounded-full blur-[100px] -translate-y-1/2 translate-x-1/2 transition-colors duration-700";
        } else {
            pill.className =
                "px-3 py-1 rounded-full bg-red-500/20 border border-red-500/50 text-red-400 text-xs font-bold uppercase tracking-wide flex items-center gap-2";
            pill.querySelector("span").className =
                "w-1.5 h-1.5 rounded-full bg-red-400 animate-pulse";
            txt.innerText = "Crítico";
            pulse.className =
                "absolute top-0 right-0 w-[500px] h-[500px] bg-red-500/20 rounded-full blur-[100px] -translate-y-1/2 translate-x-1/2 transition-colors duration-700";
        }
    }

    function updateWireVisuals(material) {
        
        const circles = document.querySelectorAll(".wire-circle");
        circles.forEach((c) => {
            if (material === "aluminum") {
                c.className =
                    "rounded-full bg-gradient-to-br from-slate-300 to-slate-500 shadow-inner wire-circle transition-colors";
            } else {
                c.className =
                    "rounded-full bg-gradient-to-br from-amber-400 to-amber-600 shadow-inner wire-circle transition-colors";
            }
        });
    }

    init();
</script>
