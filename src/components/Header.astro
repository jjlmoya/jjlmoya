---
const pathname = new URL(Astro.request.url).pathname;
const currentPath = pathname.slice(1);

interface Props {
    className?: string;
}

const { className = "" } = Astro.props;
---

<nav
    class={`fixed top-0 w-full z-[100] bg-neutral-950/90 backdrop-blur-md border-b border-white/10 transition-all duration-300 ${className}`}
    id="main-nav"
>
    <div
        class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center relative z-[100] text-white"
    >
        <a
            href="/"
            class="text-xl font-bold tracking-tighter hover:text-[var(--color-accent)] transition-colors"
            >jjlmoya</a
        >

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center gap-6">
            <a
                href="/proyectos/"
                class={`text-sm font-medium text-white ${currentPath.startsWith("proyectos") ? "text-[var(--color-accent)] nav-active" : ""} hover:text-[var(--color-accent)] transition-colors`}
                aria-current={currentPath.startsWith("proyectos") ? "page" : undefined}
                data-astro-prefetch>proyectos</a
            >
            <a
                href="/conceptos/"
                class={`text-sm font-medium text-white ${currentPath.startsWith("conceptos") ? "text-[var(--color-accent)] nav-active" : ""} hover:text-[var(--color-accent)] transition-colors`}
                aria-current={currentPath.startsWith("conceptos") ? "page" : undefined}
                data-astro-prefetch>conceptos</a
            >
            <a
                href="/utilidades/"
                class={`text-sm font-medium text-white ${currentPath.startsWith("utilidades") ? "text-[var(--color-accent)] nav-active" : ""} hover:text-[var(--color-accent)] transition-colors`}
                aria-current={currentPath.startsWith("utilidades") ? "page" : undefined}
                data-astro-prefetch>utilidades</a
            >
            <a
                href="/gamebob/"
                class={`text-sm font-medium text-white ${currentPath.startsWith("gamebob") ? "text-[var(--color-accent)] nav-active" : ""} hover:text-[var(--color-accent)] transition-colors`}
                aria-current={currentPath.startsWith("gamebob") ? "page" : undefined}
                data-astro-prefetch>gamebob</a
            >
        </div>

        <!-- Mobile Menu Button (High Contrast) -->
        <button
            id="menu-toggle"
            class="md:hidden relative w-10 h-10 flex flex-col justify-center items-center gap-1.5 group z-[100]"
            aria-label="Abrir MenÃº"
        >
            <span class="w-6 h-0.5 bg-current transition-all duration-300 origin-center line-1"
            ></span>
            <span class="w-6 h-0.5 bg-current transition-all duration-300 origin-center line-2"
            ></span>
        </button>
    </div>

    <!-- Premium Full-Screen Overlay -->
    <div
        id="mobile-menu-overlay"
        class="fixed top-0 left-0 w-screen h-screen z-[90] pointer-events-none opacity-0 transition-opacity duration-500"
    >
        <div class="absolute inset-0 bg-white/95 dark:bg-black/95 backdrop-blur-xl"></div>

        <div class="relative h-full flex flex-col justify-center items-center gap-8 p-8">
            <a href="/proyectos/" class="menu-link" style="--delay: 0.1s">
                <span class="link-number">01</span>
                <span class="link-text">Proyectos</span>
            </a>
            <a href="/conceptos/" class="menu-link" style="--delay: 0.2s">
                <span class="link-number">02</span>
                <span class="link-text">Conceptos</span>
            </a>
            <a href="/utilidades/" class="menu-link" style="--delay: 0.3s">
                <span class="link-number">03</span>
                <span class="link-text">Utilidades</span>
            </a>
            <a href="/gamebob/" class="menu-link" style="--delay: 0.4s">
                <span class="link-number">04</span>
                <span class="link-text">GameBob</span>
            </a>
        </div>
    </div>
</nav>

<style>
    /* Menu Toggle Animation */
    :global(body.menu-open) .line-1 {
        transform: translateY(4px) rotate(45deg);
    }
    :global(body.menu-open) .line-2 {
        transform: translateY(-4px) rotate(-45deg);
    }

    /* Prevent Scroll */
    :global(html.menu-open),
    :global(body.menu-open) {
        overflow: hidden;
    }

    /* Overlay Visibility */
    :global(body.menu-open) #mobile-menu-overlay {
        opacity: 1;
        pointer-events: auto;
    }

    /* Link Styles */
    .menu-link {
        display: flex;
        align-items: baseline;
        gap: 1rem;
        text-decoration: none;
        color: #1a1a1a;
        overflow: hidden;
        opacity: 0;
        transform: translateY(20px);
        transition:
            opacity 0.5s ease,
            transform 0.5s ease;
        transition-delay: var(--delay);
    }

    :global(.dark) .menu-link {
        color: #ffffff;
    }

    :global(body.menu-open) .menu-link {
        opacity: 1;
        transform: translateY(0);
    }

    .link-number {
        font-size: 0.875rem;
        color: var(--color-accent);
        font-weight: 400;
    }

    .link-text {
        font-size: 3rem;
        font-weight: 400;
        letter-spacing: -0.02em;
        transition: transform 0.3s ease;
    }

    .menu-link:hover .link-text {
        transform: translateX(10px);
        font-style: italic;
    }

    @media (max-height: 600px) {
        .link-text {
            font-size: 2rem;
        }
    }
</style>

<script>
    function setupMenu() {
        const menuToggle = document.getElementById("menu-toggle");
        const body = document.body;
        const html = document.documentElement;
        const menuLinks = document.querySelectorAll(".menu-link");

        if (!menuToggle) return;

        // Clone to remove existing listeners
        const newToggle = menuToggle.cloneNode(true);
        menuToggle.parentNode?.replaceChild(newToggle, menuToggle);

        newToggle.addEventListener("click", (e) => {
            e.stopPropagation(); // Prevent bubbling issues
            body.classList.toggle("menu-open");
            html.classList.toggle("menu-open");
        });

        menuLinks.forEach((link) => {
            link.addEventListener("click", () => {
                body.classList.remove("menu-open");
                html.classList.remove("menu-open");
            });
        });
    }

    // Initialize on load
    setupMenu();

    // Re-initialize on Astro page swaps
    document.addEventListener("astro:page-load", setupMenu);
</script>
