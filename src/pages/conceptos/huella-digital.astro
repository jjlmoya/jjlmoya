---
export const prerender = true;
import Layout from "../../layouts/Layout.astro";
import MuralGrid from "../../components/conceptos/huella-digital/MuralGrid.astro";
import BureaucraticStats from "../../components/conceptos/huella-digital/BureaucraticStats.astro";
import UserIdentity from "../../components/conceptos/huella-digital/UserIdentity.astro";
import AuditInspector from "../../components/conceptos/huella-digital/AuditInspector.astro";
import storedViews from "../../data/stored-views.json";

const internalReports = [
    {
        id: "EXP-001/ALPHA",
        title: "Usted emana, nosotros archivamos",
        sections: [
            {
                subtitle: "I. El Goteo de la Existencia",
                content:
                    "Estar aquí no es una elección consciente, es una fuga. Como esa persiana que no cierra bien o el goteo de un grifo en mitad de la noche, su navegador está filtrando pedazos de su identidad técnica. No se asuste, es un proceso natural. Su terminal está conversando con el mío en un lenguaje de metadatos que usted ni siquiera sabía que hablaba. En jjlmoya.es, simplemente hemos puesto un cubo debajo para recoger esas gotas y catalogarlas con cariño administrativo.",
            },
            {
                subtitle: "II. La Democracia del Píxel",
                content:
                    "Al entrar en este nodo, su currículum, sus traumas infantiles y su marca favorita de café pierden toda relevancia. Para el Registro Central de Huellas, usted es el Sujeto SR-XXXX. Es liberador, ¿verdad? Ser solo una frecuencia cromática en un mural infinito. Aquí no hay jerarquías, solo hay hashes. Su color no es 'bonito' ni 'feo'; es técnicamente inevitable.",
            },
        ],
    },
    {
        id: "EXP-002/BETA",
        title: "La Ética del Censo Invisible",
        sections: [
            {
                subtitle: "I. Honestidad Burocrática",
                content:
                    "La mayoría de las webs le roban los datos por la espalda para venderle zapatillas. Nosotros se los robamos a la cara para que vea lo bonito que queda su rastro junto al de un desconocido de Kuala Lumpur. Es un contrato de transparencia: nosotros vigilamos, pero le dejamos ver cómo lo hacemos. El archivo es público porque la soledad compartida es la única que tiene sentido en el silicio.",
            },
            {
                subtitle: "II. El Placer de la Insignificancia",
                content:
                    "¿Qué es un solo dato en un mar de millones? La libertad definitiva. Usted es parte del 40% que usa Chrome, del 15% que navega desde el móvil mientras finge que trabaja. En la estadística está el refugio. Aquí, ser 'uno más' no es un fracaso, es la confirmación de que usted, efectivamente, existe y está conectado.",
            },
        ],
    },
    {
        id: "EXP-003/GAMMA",
        title: "El Legado del Metadato",
        sections: [
            {
                subtitle: "I. Arqueología del Ahora",
                content:
                    "Su resolución de pantalla hoy será una antigüedad mañana. Estamos construyendo una cápsula del tiempo hecha de configuraciones de software. Dentro de diez años, alguien verá su tono de azul y dirá: 'Vaya, así es como vibraba la red en 2025'. Usted no está visitando una web; está dejando un fósil digital para las generaciones que vendrán después del próximo gran apagón.",
            },
            {
                subtitle: "II. El Derecho a Persistir",
                content:
                    "Frente a la tiranía de lo efímero, donde todo desaparece en 24 horas, nosotros ofrecemos la inmortalidad del log. Su huella no se borra. Es una marca de agua en la infraestructura de mi vida. Gracias por pasar, por emanar y por permitirnos archivarle. El trámite ha sido un éxito.",
            },
        ],
    },
];
---

<Layout
    title="REGISTRO CENTRAL DE HUELLAS // ARCHIVO NACIONAL"
    description="Expediente burocrático-artístico sobre la persistencia técnica involuntaria. Archivo Nacional de Metadatos."
    image="/images/concepts/huella_digital_og.webp"
    bodyClass="!bg-[#f4f1ea] text-[#1a1a1a] font-sans selection:bg-black selection:text-white"
    showBackground={false}
    mainClass="pt-0 px-0"
>
    <style is:global>
        body {
            background-color: #f4f1ea !important;
        }
    </style>

    <div
        class="fixed inset-0 pointer-events-none opacity-[0.08] z-50 bg-[url('https://grainy-gradients.vercel.app/noise.svg')]"
    >
    </div>

    <main class="min-h-screen bg-[#f4f1ea] flex flex-col items-center">
        <header
            class="w-full max-w-6xl mt-16 px-8 py-8 border-b-4 border-black bg-white/40 relative overflow-hidden"
        >
            <div
                class="flex flex-col md:flex-row justify-center md:justify-between items-center md:items-end text-center md:text-left gap-8 md:gap-12 relative z-10"
            >
                <div class="space-y-4 md:space-y-6">
                    <div class="flex items-center justify-center md:justify-start gap-3">
                        <div class="w-3 h-3 md:w-4 md:h-4 bg-black"></div>
                        <span
                            class="text-[9px] md:text-[11px] font-mono font-black tracking-[0.4em] uppercase"
                            >Registro Nacional de Presencias Involuntarias</span
                        >
                    </div>
                    <h1
                        class="text-[14vw] sm:text-7xl md:text-[9vw] font-black tracking-tighter uppercase leading-[0.9] italic group cursor-default"
                    >
                        La Huella<br /><span
                            class="text-transparent border-text-black font-light opacity-80 group-hover:opacity-100 transition-opacity"
                            >Digital</span
                        >
                    </h1>
                </div>

                <div class="flex flex-col items-center gap-4">
                    <div
                        class="relative w-24 h-24 md:w-32 md:h-32 flex items-center justify-center"
                    >
                        <div
                            class="absolute inset-0 rounded-full border-2 border-dashed border-black/20 animate-[spin_20s_linear_infinite]"
                        >
                        </div>
                        <div class="text-center">
                            <span
                                id="total-census"
                                class="text-3xl md:text-5xl font-black font-mono leading-none tracking-tighter"
                                >----</span
                            >
                            <p
                                class="text-[7px] md:text-[8px] font-mono font-bold uppercase mt-1 opacity-40"
                            >
                                Sujetos
                            </p>
                        </div>
                    </div>
                    <div
                        class="px-4 py-1 bg-black text-white text-[9px] font-mono font-bold uppercase tracking-widest"
                    >
                        Estado: Operativo
                    </div>
                </div>
            </div>
        </header>

        <MuralGrid />

        <BureaucraticStats />

        <UserIdentity />

        <section class="w-full max-w-6xl px-6 md:px-8 py-16 md:py-32 lg:py-48 bg-[#f4f1ea]">
            <div class="space-y-16 md:space-y-32 lg:space-y-48">
                {
                    internalReports.map((report, idx) => (
                        <article class="grid grid-cols-1 lg:grid-cols-12 gap-10 md:gap-20 relative group">
                            <div class="lg:col-span-4 relative lg:sticky lg:top-48 self-start space-y-6 md:space-y-8">
                                <div class="flex items-center gap-4 pb-4 border-b-2 border-black/10">
                                    <span class="text-xs font-mono font-black bg-black text-white px-2 py-0.5">
                                        {report.id}
                                    </span>
                                    <span class="text-[9px] font-mono font-bold uppercase opacity-30">
                                        Informe Confidencial
                                    </span>
                                </div>
                                <h3 class="text-3xl md:text-5xl font-black tracking-tighter uppercase leading-tight italic group-hover:translate-x-2 transition-transform duration-500">
                                    {report.title}
                                </h3>
                                <div class="w-16 h-1 bg-black" />
                            </div>

                            <div class="lg:col-span-8 space-y-12 md:space-y-24">
                                {report.sections.map((section) => (
                                    <div class="space-y-6 md:space-y-8">
                                        <h4 class="text-sm font-mono font-black uppercase tracking-widest border-l-4 border-black pl-4">
                                            {section.subtitle}
                                        </h4>
                                        <p class="text-xl md:text-3xl font-serif leading-[1.6] text-black/80 first-letter:text-5xl md:first-letter:text-6xl first-letter:font-black first-letter:mr-3 first-letter:float-left first-letter:leading-none">
                                            {section.content}
                                        </p>
                                    </div>
                                ))}
                            </div>

                            {idx < internalReports.length - 1 && (
                                <div class="absolute -bottom-16 md:-bottom-24 lg:-bottom-32 left-0 w-full flex items-center gap-4 opacity-10">
                                    <div class="h-[1px] flex-grow bg-black" />
                                    <div class="w-2 h-2 bg-black rotate-45" />
                                    <div class="h-[1px] flex-grow bg-black" />
                                </div>
                            )}
                        </article>
                    ))
                }
            </div>

            <div
                class="mt-16 pt-8 md:pt-32 border-t-8 border-black flex flex-col items-center gap-8 text-center"
            >
                <div class="space-y-4 md:space-y-6">
                    <p
                        class="text-4xl md:text-[8vw] font-black italic tracking-tighter uppercase leading-none"
                    >
                        El Eco de su Paso
                    </p>
                    <p
                        class="text-[8px] md:text-xs font-mono font-bold tracking-[0.5em] md:tracking-[1em] text-black/30 uppercase"
                    >
                        La memoria del archivo es ahora su memoria
                    </p>
                </div>

                <div
                    class="max-w-2xl bg-white p-8 md:p-12 border-2 border-black shadow-[10px_10px_0px_rgba(0,0,0,0.05)] md:shadow-[20px_20px_0px_rgba(0,0,0,0.05)] space-y-8 md:space-y-10"
                >
                    <p class="text-lg md:text-xl font-serif leading-relaxed italic text-black/60">
                        "Usted ya no es un visitante; ahora es parte del código que sostiene este
                        experimento. Su rastro es la tinta invisible que dibuja nuestra historia
                        colectiva."
                    </p>
                    <div class="flex flex-col md:flex-row items-center justify-center gap-8">
                        <a
                            href="/conceptos/"
                            class="group relative inline-block px-12 md:px-16 py-4 md:py-6 bg-black text-white text-xs font-bold tracking-[0.4em] uppercase transition-all hover:-translate-y-1 active:translate-y-1"
                        >
                            Salir del Archivo
                            <div
                                class="absolute inset-0 border-2 border-black translate-x-2 translate-y-2 md:translate-x-3 md:translate-y-3 -z-10 group-hover:translate-x-0 group-hover:translate-y-0 transition-transform bg-white/50"
                            >
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <footer
            class="w-full bg-[#050505] text-white/40 py-8 px-8 border-t border-white/5 relative overflow-hidden"
        >
            <div
                class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6 font-mono text-[9px] font-bold uppercase tracking-[0.4em]"
            >
                <div class="flex items-center gap-6">
                    <div
                        id="footer-user-color"
                        class="w-3 h-3 bg-white transition-colors duration-1000"
                    >
                    </div>
                    <span id="footer-user-id" class="text-white">SR-XXXX</span>
                    <span class="opacity-30 self-center">|</span>
                    <span class="italic">Registro de Permanencia Automático</span>
                </div>

                <div class="flex gap-8 opacity-60">
                    <span id="screen-res">0X0</span>
                    <span id="nav-lang">ES</span>
                    <span id="current-time">00:00:00</span>
                </div>

                <div class="flex items-center gap-4 text-white/20">
                    <span>Involuntaria</span>
                    <div class="w-1 h-1 bg-white/10 rounded-full"></div>
                    <span>Inevitable</span>
                    <div class="w-1 h-1 bg-white/10 rounded-full"></div>
                    <span>Infinita</span>
                </div>
            </div>
        </footer>
    </main>

    <AuditInspector />
</Layout>

<script define:vars={{ storedViews }}>
    const APPS_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbzKush6FWrPSw4U5QGWsdbUAePGSDuMgmG-TCoZsA0nLTYkBAFaRksZ8MuPGoOCAUG29Q/exec";

    async function initBureaucraticExperience() {
        const totalEl = document.getElementById("total-census");
        const resEl = document.getElementById("screen-res");
        const langEl = document.getElementById("nav-lang");
        const timeEl = document.getElementById("current-time");

        if (resEl) resEl.textContent = `${window.screen.width}X${window.screen.height}`;
        if (langEl) langEl.textContent = `${navigator.language.toUpperCase()}`;
        setInterval(() => {
            if (timeEl)
                timeEl.textContent = `${new Date().toISOString().split("T")[1].split(".")[0]}`;
        }, 1000);

        function stringToColor(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            let color = "#";
            for (let i = 0; i < 3; i++) {
                const value = (hash >> (i * 8)) & 0xff;
                color += ("00" + value.toString(16)).substr(-2);
            }
            return color;
        }

        const platform = navigator.userAgent;
        const myColor = stringToColor(platform + navigator.language);
        const myId = "SR-" + Math.random().toString(36).substr(2, 5).toUpperCase();

        let localData = JSON.parse(localStorage.getItem("jjlmoya_footprint_v5") || "{}");
        if (!localData.id) {
            localData = { id: myId, color: myColor, sent: false };
            localStorage.setItem("jjlmoya_footprint_v5", JSON.stringify(localData));
        }

        const footerId = document.getElementById("footer-user-id");
        const footerColor = document.getElementById("footer-user-color");
        if (footerId) footerId.textContent = localData.id;
        if (footerColor) footerColor.style.backgroundColor = localData.color;

        document.querySelectorAll("p, span, h1, h2, h3, h4").forEach((el) => {
            if (el.textContent && el.textContent.includes("SR-XXXX")) {
                el.textContent = el.textContent.replaceAll("SR-XXXX", localData.id);
            }
        });

        window.dispatchEvent(new CustomEvent("user-id-ready", { detail: localData }));

        async function registerVisit() {
            if (localData.sent) return;
            try {
                await fetch(APPS_SCRIPT_URL, {
                    method: "POST",
                    body: JSON.stringify({
                        id: localData.id,
                        color: localData.color,
                        path: window.location.pathname,
                        ua: platform,
                    }),
                });
                localData.sent = true;
                localStorage.setItem("jjlmoya_footprint_v5", JSON.stringify(localData));
            } catch (e) {
                console.error("Failed to register visit", e);
            }
        }

        registerVisit();

        const footprintMap = new Map();

        function addFootprints(data) {
            if (!Array.isArray(data)) return;
            data.forEach((f) => {
                if (f && f[0]) footprintMap.set(f[0], f);
            });
            broadcast();
        }

        function broadcast() {
            const sortedData = Array.from(footprintMap.values()).sort((a, b) => a[0] - b[0]);
            window.footprints = sortedData;
            window.dispatchEvent(new CustomEvent("footprints-updated", { detail: sortedData }));
            if (totalEl) totalEl.textContent = sortedData.length.toString().padStart(4, "0");
        }

        addFootprints(storedViews);

        try {
            const response = await fetch(APPS_SCRIPT_URL);
            const liveData = await response.json();
            addFootprints(liveData);
        } catch (err) {
            console.error("Live fetch failed", err);
        }
    }

    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initBureaucraticExperience);
    } else {
        setTimeout(initBureaucraticExperience, 100);
    }
</script>

<style>
    .border-text-black {
        -webkit-text-stroke: 1px black;
    }
</style>
