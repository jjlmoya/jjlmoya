---
export const prerender = true;
import SEO from "../../../components/SEO.astro";
import { Icon } from "astro-icon/components";
---

<!doctype html>
<html lang="es" class="bg-[#F8FAFC] overflow-hidden select-none">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
        />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap"
            rel="stylesheet"
        />
        <SEO
            title="IMPERIO DE DEUDA"
            description="El simulador definitivo de expansión urbana y gestión de deuda."
        />

        <style is:global>
            :root {
                --primary: #0f172a;
                --accent: #3b82f6;
                --success: #10b981;
                --danger: #ef4444;
                --gold: #f59e0b;
                --bg: #f8fafc;
            }

            * {
                box-sizing: border-box;
                -webkit-font-smoothing: antialiased;
                margin: 0;
                padding: 0;
            }

            body {
                font-family: "Outfit", sans-serif;
                background: var(--bg);
                color: var(--primary);
                height: 100dvh;
                width: 100vw;
                display: flex;
                justify-content: center;
                overflow: hidden;
                -webkit-tap-highlight-color: transparent;
            }

            .phone-container {
                width: 100%;
                max-width: 480px;
                height: 100%;
                display: flex;
                flex-direction: column;
                position: relative;
                background: white;
            }

            .master-hud {
                padding: 4px 12px;
                background: white;
                z-index: 100;
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 12px;
                border-bottom: 1px solid #f1f5f9;
                height: 38px;
            }

            .counter-group {
                display: flex;
                align-items: center;
                gap: 6px;
            }

            .val-debt {
                font-size: 0.95rem;
                font-weight: 950;
                color: var(--danger);
            }

            .growth-tag {
                font-size: 8px;
                font-weight: 800;
                color: #ef4444;
                background: #fee2e2;
                padding: 1px 4px;
                border-radius: 4px;
                font-family: monospace;
            }

            .sub-stats {
                display: flex;
                gap: 8px;
                align-items: center;
            }

            .stat-pill {
                display: flex;
                flex-direction: column;
                justify-content: center;
                gap: 0px;
                white-space: nowrap;
                min-width: 65px;
            }

            .pill-label {
                font-size: 8px;
                font-weight: 800;
                color: #94a3b8;
                text-transform: uppercase;
                line-height: 1;
                margin-bottom: 1px;
            }

            .pill-val {
                font-size: 0.9rem;
                font-weight: 900;
                color: var(--primary);
                line-height: 1;
                display: flex;
                align-items: center;
            }

            .passives-tray {
                height: 28px;
                background: rgba(255, 255, 255, 0.7);
                backdrop-filter: blur(8px);
                border-bottom: 1px solid #f1f5f9;
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 0 12px;
                overflow-x: auto;
                z-index: 90;
            }
            .p-icon-chip {
                width: 20px;
                height: 20px;
                background: white;
                border-radius: 6px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
                flex-shrink: 0;
                border: 1px solid #e2e8f0;
            }

            .city-engine {
                flex-grow: 1;
                position: relative;
                background: #cbd5e1;
                overflow: hidden;
                min-height: 40vh;
                touch-action: none;
            }

            .city-engine::-webkit-scrollbar {
                display: none;
            }

            #buildings-layer {
                position: absolute;
                inset: 0;
                z-index: 50;
                pointer-events: none;
                transform-origin: 0 0;
            }

            #city-map {
                position: absolute;
                width: 4000px;
                height: 4000px;
                background-color: #cbd5e1;
                background-image:
                    linear-gradient(rgba(255, 255, 255, 0.4) 2px, transparent 2px),
                    linear-gradient(90deg, rgba(255, 255, 255, 0.4) 2px, transparent 2px);
                background-size: 80px 80px;
                transform-origin: 0 0;
            }

            .zoom-controls {
                position: absolute;
                right: 16px;
                top: 50px;
                display: flex;
                flex-direction: column;
                gap: 8px;
                z-index: 150;
            }

            .zoom-btn {
                width: 36px;
                height: 36px;
                background: white;
                border: 1px solid #e2e8f0;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--primary);
                font-size: 20px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                cursor: pointer;
            }

            .management-drawer {
                flex-grow: 1;
                background: white;
                border-radius: 24px 24px 0 0;
                margin-top: -24px;
                z-index: 200;
                box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.1);
                padding: 16px;
                display: flex;
                flex-direction: column;
                gap: 12px;
                position: relative;
                min-height: 0;
            }

            .grid-slot {
                transition: background 0.15s ease-out;
            }

            .grid-slot.preview-ok {
                background: rgba(59, 130, 246, 0.5) !important;
                box-shadow: inset 0 0 0 2px rgba(59, 130, 246, 0.8);
            }

            .grid-slot.preview-error {
                background: rgba(239, 68, 68, 0.5) !important;
                box-shadow: inset 0 0 0 2px rgba(239, 68, 68, 0.8);
            }

            .building-placed {
                animation: spawnPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            }

            .tab-bar {
                display: flex;
                background: #f1f5f9;
                padding: 3px;
                border-radius: 12px;
                margin-bottom: 12px;
            }

            .map-gradient {
                position: absolute;
                inset: 0;
                background: radial-gradient(
                    circle at 50% 50%,
                    transparent 20%,
                    rgba(248, 250, 252, 0.4) 100%
                );
                pointer-events: none;
            }

            .building-spot {
                position: absolute;
                width: 32px;
                height: 32px;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(4px);
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                border: 1.5px solid var(--accent);
                cursor: pointer;
                z-index: 50;
                animation: spawnPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                transition: all 0.2s ease;
            }

            .spot-icon {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
                height: 100%;
                color: var(--accent);
            }

            @keyframes spawnPop {
                0% {
                    transform: scale(0) translateY(20px);
                    opacity: 0;
                }
                100% {
                    transform: scale(1) translateY(0);
                    opacity: 1;
                }
            }

            .drawer-handle {
                width: 40px;
                height: 4px;
                background: #e2e8f0;
                border-radius: 2px;
                margin: 0 auto 10px;
            }

            .biz-scroller {
                flex-grow: 1;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                gap: 10px;
                padding-bottom: 20px;
            }

            .biz-item {
                background: #f8fafc;
                padding: 12px;
                border-radius: 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                cursor: pointer;
                border: 1px solid #f1f5f9;
                transition: all 0.2s ease;
            }

            .biz-item.locked {
                opacity: 0.3;
                filter: grayscale(1);
                pointer-events: none;
            }
            .biz-item:not(.locked):hover {
                border-color: var(--accent);
                background: white;
            }

            .biz-thumb {
                width: 48px;
                height: 48px;
                background: white;
                border-radius: 14px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                margin-right: 16px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            }

            .biz-body h4 {
                font-size: 14px;
                font-weight: 800;
            }
            .biz-body p {
                font-size: 10px;
                color: #64748b;
                font-weight: 600;
            }

            .biz-meta {
                text-align: right;
            }
            .biz-cost {
                font-size: 14px;
                font-weight: 900;
                color: var(--success);
            }
            .biz-lvl {
                font-size: 9px;
                font-weight: 800;
                color: #94a3b8;
                text-transform: uppercase;
            }

            .money-pop {
                position: absolute;
                font-weight: 900;
                color: var(--success);
                pointer-events: none;
                z-index: 300;
                animation: moneyRise 0.8s ease-out forwards;
            }

            @keyframes moneyRise {
                0% {
                    transform: translateY(0) scale(1);
                    opacity: 1;
                }
                100% {
                    transform: translateY(-120px) scale(1.5);
                    opacity: 0;
                }
            }

            #passives-bar {
                display: flex;
                gap: 8px;
                overflow-x: auto;
                padding: 4px 0;
            }

            .p-chip {
                background: var(--accent);
                color: white;
                font-size: 9px;
                font-weight: 900;
                padding: 4px 12px;
                border-radius: 50px;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                flex-shrink: 0;
                animation: slideIn 0.3s ease-out;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: scale(0.8);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }

            .tab-bar {
                display: flex;
                background: #f1f5f9;
                padding: 4px;
                border-radius: 14px;
                margin-bottom: 20px;
            }
            .tab-btn {
                flex: 1;
                padding: 8px;
                border: none;
                background: transparent;
                font-size: 11px;
                font-weight: 800;
                color: #64748b;
                border-radius: 10px;
                cursor: pointer;
                text-transform: uppercase;
                letter-spacing: 0.1em;
                transition: all 0.2s;
            }
            .tab-btn.active {
                background: white;
                color: var(--accent);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            }

            .biz-item.active-p {
                border-color: var(--accent);
                background: rgba(37, 99, 235, 0.02);
            }

            .p-buy-btn {
                background: #f1f5f9;
                border: 1px solid #e2e8f0;
                padding: 4px 10px;
                border-radius: 8px;
                font-size: 9px;
                font-weight: 900;
                color: var(--accent);
                cursor: pointer;
                transition: all 0.2s;
                margin-top: 4px;
            }
            .p-buy-btn.active {
                background: var(--accent);
                color: white;
                border-color: var(--accent);
                box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
            }
            .p-buy-btn.disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .lvl-up-btn {
                background: var(--success);
                color: white;
                border: none;
                padding: 6px 12px;
                border-radius: 10px;
                font-size: 10px;
                font-weight: 900;
                cursor: pointer;
                transition: all 0.2s;
                margin-top: 4px;
            }
            .lvl-up-btn:active {
                transform: scale(0.95);
            }
            .lvl-up-btn.disabled {
                background: #e2e8f0;
                color: #94a3b8;
                cursor: not-allowed;
            }

            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="phone-container">
            <header class="master-hud">
                <div class="counter-group">
                    <div id="debt-count-val" class="val-debt">1.00B</div>
                    <div id="debt-growth-val" class="growth-tag">+0.1%/s</div>
                </div>

                <div class="sub-stats">
                    <div class="stat-pill">
                        <span class="pill-label">Cash</span>
                        <span id="bank-count-val" class="pill-val">0</span>
                    </div>
                    <div class="stat-pill">
                        <span class="pill-label">Renta</span>
                        <span id="income-count-val" class="pill-val">+0/s</span>
                    </div>
                </div>
            </header>

            <div id="passives-icons-bar" class="passives-tray scrollbar-hide"></div>

            <main class="city-engine" id="city-viewport">
                <div id="city-map"></div>
                <div id="buildings-layer"></div>

                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="Game.ui.zoom(1.2)">+</button>
                    <button class="zoom-btn" onclick="Game.ui.zoom(0.8)">-</button>
                    <button class="zoom-btn" onclick="Game.ui.centerMap()">⌖</button>
                </div>
            </main>

            <div
                id="action-hint"
                class="absolute bottom-10 left-1/2 -translate-x-1/2 z-20 pointer-events-none opacity-50"
            >
                <div
                    class="px-4 py-2 bg-white/80 backdrop-blur rounded-full text-[10px] font-black uppercase tracking-widest text-slate-400 border border-slate-200"
                >
                    Clica en la ciudad para extraer fondos
                </div>
            </div>

            <footer class="management-drawer">
                <div class="drawer-handle"></div>

                <div class="tab-bar">
                    <button class="tab-btn active" data-tab="biz" onclick="setTab('biz')"
                        >Distritos</button
                    >
                    <button class="tab-btn" data-tab="passives" onclick="setTab('passives')"
                        >Protocolos</button
                    >
                    <button class="tab-btn" data-tab="ops" onclick="setTab('ops')"
                        >Operaciones</button
                    >
                </div>

                <div class="flex justify-between items-center mb-1">
                    <div class="flex items-center gap-2">
                        <Icon name="mdi:office-building-cog" class="w-3 h-3 text-slate-400" />
                        <span class="label-tag" style="margin:0; font-size: 8px;"
                            >Sistema de Activos</span
                        >
                    </div>
                    <span
                        id="biz-summary"
                        class="label-tag"
                        style="color: var(--accent); font-size: 8px;">0 Sedes</span
                    >
                </div>

                <div id="biz-list-ui" class="biz-scroller scrollbar-hide"></div>
            </footer>
        </div>

        <script>
            import { GameEngine } from "../../../lib/games/imperio-deuda/engine/GameEngine.js";
            import { gameConfig } from "../../../lib/games/imperio-deuda/data/config.js";
            import { gamePassives } from "../../../lib/games/imperio-deuda/data/passives.js";

            const Game = new GameEngine();
            Game.init({ ...gameConfig, passives: gamePassives });

            (window as any).Game = Game;

            const script = document.createElement("script");
            script.src = "https://code.iconify.design/3/3.1.0/iconify.min.js";
            document.head.appendChild(script);
        </script>
    </body>
</html>
