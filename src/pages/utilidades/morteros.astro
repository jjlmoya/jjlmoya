---
import Layout from "../../layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import VitruvianColumn from "../../components/utilidades/morteros/VitruvianColumn.astro";
import MaterialControls from "../../components/utilidades/morteros/MaterialControls.astro";
import LivingWall from "../../components/utilidades/morteros/LivingWall.astro";
import GranulometrySection from "../../components/utilidades/morteros/GranulometrySection.astro";
import EducationalSection from "../../components/utilidades/morteros/EducationalSection.astro";
import "../../styles/morteros.css";
---

<Layout
    title="La Calculadora Vitruvio"
    description="Herramienta interactiva de cálculo inverso basada en los tratados de Vitrubio. Descubre cuánto muro puedes restaurar con tus materiales."
>
    <div class="vitruvian-container">
        <!-- Background -->
        <div class="vitruvian-bg"></div>

        <!-- Header -->
        <div class="vitruvian-header">
            <a href="/utilidades/" class="back-link">
                <Icon name="mdi:arrow-left" class="w-4 h-4" />
                volver a utilidades
            </a>
            <h1 class="vitruvian-title">La Calculadora Vitruvio</h1>
            <p class="vitruvian-subtitle">
                El arte de la proporción según el Libro VII. Descubre cuánto muro puedes restaurar
                con los materiales que tienes.
            </p>
        </div>

        <!-- Main Three-Panel Layout -->
        <div class="vitruvian-canvas">
            <!-- LEFT PANEL: Roman Column Selector -->
            <VitruvianColumn />

            <!-- CENTER PANEL: Material Bodegón -->
            <MaterialControls />

            <!-- RIGHT PANEL: The Living Wall -->
            <LivingWall />
        </div>

        <!-- GRANULOMETRY INFORMATION SECTION -->
        <GranulometrySection />

        <!-- EDUCATIONAL SECTION: Vitruvius and Mortar Science -->
        <EducationalSection />
    </div>

    <script>
        import { MortarController } from "../../lib/morteros/MortarController";

        // Initialize controller
        function init() {
            console.log("Initializing MortarController...");
            try {
                new MortarController();
                console.log("MortarController initialized successfully.");
            } catch (e) {
                console.error("Error initializing MortarController:", e);
            }
        }

        // Support both standard load and View Transitions (if added later)
        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", init);
        } else {
            init();
        }

        document.addEventListener("astro:page-load", init);
    </script>
</Layout>
