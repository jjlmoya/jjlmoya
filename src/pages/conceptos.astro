---
import Layout from "../layouts/Layout.astro";
import { Icon } from 'astro-icon/components';

const concepts = [
  {
    id: "inflacion",
    title: "INFLACIÓN",
    subtitle: "Erosión de Valor",
    href: "/conceptos/inflacion",
    icon: "mdi:finance",
    color: "255, 215, 0", // Gold
    desc: "Visualiza cómo el tiempo devora el dinero."
  },
  {
    id: "biblioteca",
    title: "BIBLIOTECA",
    subtitle: "Datos Vitales",
    href: "/conceptos/biblioteca",
    icon: "mdi:bookshelf",
    color: "255, 100, 100", // Red/Pink
    desc: "Tu existencia convertida en catálogo."
  },
  {
    id: "evolucion",
    title: "EVOLUCIÓN",
    subtitle: "Alquimia del Caos",
    href: "/conceptos/evolucion",
    icon: "mdi:dna",
    color: "147, 51, 234", // Purple
    desc: "Combina para crear monstruosidades que luchan"
  }
];
---

<Layout title="Conceptos | jjlmoya" bodyClass="bg-black text-white" showBackground={false} mainClass="p-0" headerClass="text-white mix-blend-difference">
  <div class="relative w-full min-h-screen overflow-x-hidden bg-black selection:bg-white/20">
    
    <!-- The Canvas: Stardust -->
    <canvas id="stardust" class="fixed inset-0 z-0 opacity-60"></canvas>

    <!-- Vignette -->
    <div class="fixed inset-0 z-10 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_0%,#000000_120%)]"></div>
    
    <!-- Content Layer -->
    <div class="relative z-20 w-full min-h-screen flex flex-col items-center justify-center p-4 md:p-6 py-24 md:py-6">
      
      <header class="absolute top-8 md:top-12 left-0 w-full text-center pointer-events-none mix-blend-difference z-30">
        <h1 class="text-[10px] md:text-xs font-mono tracking-[0.8em] text-white/40 uppercase">Colección Experimental</h1>
      </header>

      <div class="flex flex-col md:flex-row gap-6 md:gap-12 items-center justify-center w-full max-w-4xl">
        {concepts.map((concept) => (
          <a 
            href={concept.href} 
            class="concept-card group relative w-full max-w-xs h-80 md:h-96 flex flex-col transition-transform duration-500 hover:scale-[1.02]"
            data-color={concept.color}
          >
            <!-- Breathing Glow Background (Always visible) -->
            <div 
                class="absolute inset-0 rounded-2xl opacity-20 blur-[50px] animate-pulse-slow"
                style={`background-color: rgb(${concept.color})`}
            ></div>

            <!-- Card Surface -->
            <div class="relative w-full h-full bg-neutral-900/80 backdrop-blur-xl border border-white/10 rounded-2xl overflow-hidden flex flex-col justify-between shadow-2xl">
                
                <!-- Continuous Shimmer Effect -->
                <div class="absolute inset-0 z-0 overflow-hidden">
                    <div class="absolute top-0 -left-[100%] w-[200%] h-full bg-gradient-to-r from-transparent via-white/5 to-transparent skew-x-12 animate-shimmer"></div>
                </div>

                <!-- Content -->
                <div class="relative z-10 flex flex-col items-center justify-center p-8 text-center min-h-[280px] md:min-h-[320px]">
                    <!-- Icon -->
                    <div class="mb-6 p-4 rounded-full bg-white/5 border border-white/5 shadow-[0_0_30px_rgba(0,0,0,0.5)]">
                        <Icon name={concept.icon} class="w-10 h-10 md:w-12 md:h-12 text-white/90 drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]" />
                    </div>
                    
                    <h2 class="text-2xl md:text-3xl font-bold text-white tracking-tight mb-2">{concept.title}</h2>
                    <p class="text-[10px] font-mono text-white/50 tracking-[0.2em] uppercase mb-4">{concept.subtitle}</p>
                    
                    <div class="w-8 h-[1px] bg-white/20 mb-4"></div>

                    <p class="text-sm text-white/60 leading-relaxed font-light">
                        {concept.desc}
                    </p>
                </div>

                <!-- Bottom Status Bar -->
                <div class="relative z-10 py-3 px-6 bg-black/20 border-t border-white/5 flex justify-between items-center flex-shrink-0">
                    <div class="flex gap-1">
                        <div class="w-1 h-1 rounded-full bg-white/40"></div>
                        <div class="w-1 h-1 rounded-full bg-white/20"></div>
                        <div class="w-1 h-1 rounded-full bg-white/10"></div>
                    </div>
                    <span class="text-[9px] font-mono uppercase tracking-widest text-white/30 group-hover:text-white/60 transition-colors">Iniciar Sistema</span>
                </div>
            </div>
          </a>
        ))}
      </div>

    </div>
  </div>
</Layout>

<style>
    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    .animate-shimmer {
        animation: shimmer 3s infinite linear;
    }
    @keyframes pulse-slow {
        0%, 100% { opacity: 0.15; }
        50% { opacity: 0.3; }
    }
    .animate-pulse-slow {
        animation: pulse-slow 4s ease-in-out infinite;
    }
</style>

<script>
  // Stardust Effect
  const canvas = document.getElementById('stardust') as HTMLCanvasElement;
  const ctx = canvas.getContext('2d');
  
  let width = 0;
  let height = 0;
  let particles: Star[] = [];
  let mouse = { x: 0, y: 0 };
  // Default to a neutral blueish-white for the background dust
  let targetColor = { r: 200, g: 220, b: 255 }; 
  let currentColor = { ...targetColor };

  const PARTICLE_COUNT = 200;

  class Star {
    x: number;
    y: number;
    z: number;
    size: number;
    baseAlpha: number;

    constructor() {
      this.x = Math.random() * width;
      this.y = Math.random() * height;
      this.z = Math.random() * 2 + 0.5;
      this.size = Math.random() * 1.5;
      this.baseAlpha = Math.random() * 0.5 + 0.1;
    }

    update() {
      const moveX = (mouse.x - width / 2) * 0.01 * (1/this.z);
      const moveY = (mouse.y - height / 2) * 0.01 * (1/this.z);
      this.y -= 0.1 * (1/this.z); 
      
      if (this.y < 0) this.y = height;
      if (this.x < 0) this.x = width;
      if (this.x > width) this.x = 0;
    }

    draw(offsetX: number, offsetY: number) {
      if (!ctx) return;
      const drawX = this.x + offsetX * (1/this.z);
      const drawY = this.y + offsetY * (1/this.z);
      ctx.fillStyle = `rgba(${Math.round(currentColor.r)}, ${Math.round(currentColor.g)}, ${Math.round(currentColor.b)}, ${this.baseAlpha})`;
      ctx.beginPath();
      ctx.arc(drawX, drawY, this.size * (1/this.z), 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function init() {
    resize();
    particles = [];
    for (let i = 0; i < PARTICLE_COUNT; i++) {
      particles.push(new Star());
    }
    animate();
  }

  function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  }

  function animate() {
    if (!ctx) return;
    ctx.clearRect(0, 0, width, height);

    currentColor.r += (targetColor.r - currentColor.r) * 0.05;
    currentColor.g += (targetColor.g - currentColor.g) * 0.05;
    currentColor.b += (targetColor.b - currentColor.b) * 0.05;

    const offsetX = (mouse.x - width / 2) * 0.05;
    const offsetY = (mouse.y - height / 2) * 0.05;

    particles.forEach(p => {
      p.update();
      p.draw(offsetX, offsetY);
    });

    requestAnimationFrame(animate);
  }

  window.addEventListener('resize', () => {
    resize();
    init();
  });

  window.addEventListener('mousemove', (e) => {
    mouse.x = e.clientX;
    mouse.y = e.clientY;
  });

  // Change stardust color on card interaction
  const cards = document.querySelectorAll('.concept-card');
  cards.forEach(card => {
    card.addEventListener('mouseenter', () => {
      const color = card.getAttribute('data-color');
      if (color) {
        const [r, g, b] = color.split(',').map(Number);
        targetColor = { r, g, b };
      }
    });

    card.addEventListener('mouseleave', () => {
      targetColor = { r: 200, g: 220, b: 255 };
    });
  });

  init();
</script>
