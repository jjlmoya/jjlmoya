---
import Layout from "../layouts/Layout.astro";
import { Icon } from "astro-icon/components";

const concepts = [
    {
        id: "inflacion",
        title: "INFLACIÓN",
        subtitle: "Erosión de Valor",
        href: "/conceptos/inflacion/",
        icon: "mdi:finance",
        color: "255, 215, 0",
        desc: "Visualiza cómo el tiempo devora el dinero.",
    },
    {
        id: "biblioteca",
        title: "BIBLIOTECA",
        subtitle: "Datos Vitales",
        href: "/conceptos/biblioteca/",
        icon: "mdi:bookshelf",
        color: "255, 100, 100",
        desc: "Tu existencia convertida en catálogo.",
    },
];
---

<Layout
    title="Conceptos"
    bodyClass="bg-neutral-950 text-white"
    showBackground={false}
    mainClass="p-0"
>
    <!-- Background Art -->
    <div class="fixed inset-0 z-0 bg-neutral-950">
        <div
            class="absolute inset-0 bg-[radial-gradient(circle_at_50%_0%,rgba(255,255,255,0.05),transparent_70%)]"
        >
        </div>
        <canvas id="stardust" class="absolute inset-0 opacity-30"></canvas>
    </div>

    <div class="relative z-10 min-h-screen flex flex-col items-center justify-center p-6">
        <header class="mb-20 text-center">
            <h1 class="text-5xl md:text-7xl font-light tracking-tight text-white mb-6">
                Conceptos
            </h1>
            <div class="w-16 h-[1px] bg-white/30 mx-auto mb-6"></div>
            <p
                class="text-base md:text-lg font-serif italic text-white/60 max-w-2xl mx-auto leading-relaxed"
            >
                Aterrizando ideas vagas que tengo en la cabeza, dándoles cuerpo y forma para que
                todo el mundo sea capaz de comprenderlo. ¡Incluso yo!
            </p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl w-full px-4">
            {
                concepts.map((concept) => (
                    <a
                        href={concept.href}
                        class="concept-card group relative block w-full max-w-sm mx-auto overflow-hidden bg-neutral-900/40 border border-white/10 transition-all duration-500 hover:bg-neutral-900/60"
                        data-color={concept.color}
                    >
                        {/* Subtle Permanent Glow */}
                        <div
                            class="absolute inset-0 opacity-10"
                            style={`background: radial-gradient(circle at center, rgb(${concept.color}), transparent 70%);`}
                        />

                        <div class="relative h-full flex flex-col items-center justify-center p-8 text-center min-h-[400px]">
                            {/* Icon */}
                            <div class="mb-8 text-white/80">
                                <Icon name={concept.icon} class="w-16 h-16 drop-shadow-2xl" />
                            </div>

                            {/* Text Content */}
                            <div class="flex flex-col items-center">
                                <h2 class="text-2xl font-light tracking-widest text-white mb-3 uppercase">
                                    {concept.title}
                                </h2>
                                <p class="text-[10px] font-mono uppercase tracking-[0.3em] text-white/40 mb-6">
                                    {concept.subtitle}
                                </p>

                                <div class="w-12 h-[1px] bg-white/20 mb-6" />

                                <p class="font-serif text-lg text-white/70 italic leading-relaxed">
                                    "{concept.desc}"
                                </p>
                            </div>
                        </div>

                        {/* Elegant Border Frame */}
                        <div class="absolute inset-4 border border-white/5 pointer-events-none" />
                    </a>
                ))
            }
        </div>
    </div>
</Layout>

<script>
    document.addEventListener("astro:page-load", () => {
        // Stardust Effect
        const canvas = document.getElementById("stardust") as HTMLCanvasElement;
        if (!canvas) return;

        const ctx = canvas.getContext("2d");

        let width = 0;
        let height = 0;
        let particles: Star[] = [];
        let mouse = { x: 0, y: 0 };
        // Default to a neutral elegant white/blue
        let targetColor = { r: 220, g: 220, b: 230 };
        let currentColor = { ...targetColor };

        const PARTICLE_COUNT = 150; // Slightly reduced for elegance

        class Star {
            x: number;
            y: number;
            z: number;
            size: number;
            baseAlpha: number;

            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.z = Math.random() * 2 + 0.5;
                this.size = Math.random() * 1.5;
                this.baseAlpha = Math.random() * 0.4 + 0.1;
            }

            update() {
                this.y -= 0.05 * (1 / this.z); // Slower, more majestic movement

                if (this.y < 0) this.y = height;
                if (this.x < 0) this.x = width;
                if (this.x > width) this.x = 0;
            }

            draw(offsetX: number, offsetY: number) {
                if (!ctx) return;
                const drawX = this.x + offsetX * (1 / this.z);
                const drawY = this.y + offsetY * (1 / this.z);
                ctx.fillStyle = `rgba(${Math.round(currentColor.r)}, ${Math.round(currentColor.g)}, ${Math.round(currentColor.b)}, ${this.baseAlpha})`;
                ctx.beginPath();
                ctx.arc(drawX, drawY, this.size * (1 / this.z), 0, Math.PI * 2);
                ctx.fill();
            }
        }

        let animationFrameId: number;

        function init() {
            resize();
            particles = [];
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                particles.push(new Star());
            }
            animate();
        }

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }

        function animate() {
            if (!ctx) return;
            ctx.clearRect(0, 0, width, height);

            currentColor.r += (targetColor.r - currentColor.r) * 0.02;
            currentColor.g += (targetColor.g - currentColor.g) * 0.02;
            currentColor.b += (targetColor.b - currentColor.b) * 0.02;

            const offsetX = (mouse.x - width / 2) * 0.02;
            const offsetY = (mouse.y - height / 2) * 0.02;

            particles.forEach((p) => {
                p.update();
                p.draw(offsetX, offsetY);
            });

            animationFrameId = requestAnimationFrame(animate);
        }

        window.addEventListener("resize", () => {
            resize();
            init();
        });

        window.addEventListener("mousemove", (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        });

        // Change stardust color on card interaction
        const cards = document.querySelectorAll(".concept-card");
        cards.forEach((card) => {
            card.addEventListener("mouseenter", () => {
                const color = card.getAttribute("data-color");
                if (color) {
                    const [r, g, b] = color.split(",").map(Number);
                    targetColor = { r, g, b };
                }
            });

            card.addEventListener("mouseleave", () => {
                targetColor = { r: 220, g: 220, b: 230 };
            });
        });

        init();

        // Cleanup function to stop animation when leaving the page
        document.addEventListener(
            "astro:before-swap",
            () => {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }
            },
            { once: true }
        );
    });
</script>
